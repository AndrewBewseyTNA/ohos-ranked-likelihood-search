!function(l,m){"use strict";var o,u={};function c(){var t,e=m.v.visualisations[m.v.currentTool];t=e&&e.inputControl?e.inputControl.width:e&&e.taxonSelect?e.taxonSelect.width:230,l("#tombioOnsMenu").css("width",t),window.matchMedia(o).matches||(-1<m.v.includedVisualisations.indexOf(m.v.currentTool)?(l("ons-splitter-content").css("left",t),l("ons-splitter-side").show()):(l("ons-splitter-content").css("left","0px"),l("ons-splitter-side").hide())),-1<m.v.includedVisualisations.indexOf(m.v.currentTool)&&window.matchMedia(o).matches?l("#tombioUiInputToolbarButton").show():l("#tombioUiInputToolbarButton").hide()}m.gui.main={fn:{}},m.gui.main.setSelectedTool=function(t){},m.gui.main.resizeControlsAndTaxa=function(){},m.gui.main.init=function(){l("#tombiod3vis").html(""),l("<div>").attr("id","tombioOnsHiddenVisualisation").hide().appendTo("#tombiod3vis"),l("<div>").attr("id","tombioOnsHiddenControls").hide().appendTo("#tombiod3vis"),m.gui.main.divVis="#tombioOnsHiddenVisualisation",m.gui.main.divInput="#tombioOnsHiddenControls",l("<div>").attr("id","tombioOns").appendTo(l("#tombiod3vis"));var t="";t+='<ons-navigator swipeable id="tombioOnsNavigator" page="tombioOnsSelectTemplate"></ons-navigator>',t+='<template id="tombioOnsSelectTemplate">',t+='<ons-page id="tombioOnsToolSelect">',t+="<ons-toolbar>",t+='<div class="center">'+m.d.kbmetadata.title+"</div>",t+="</ons-toolbar>",t+='<ons-list id="tombioOnsTools"></ons-list>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisualisationTemplate">',t+='<ons-page id="tombioOnsVisualisation">',t+="<ons-splitter>",t+='<ons-splitter-side id="tombioOnsMenu" side="left" collapse="'+(o="(max-width: 979px)")+'" swipeable>',t+='<ons-page id="tombioOnsVisInput">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-back-button id="tombioUiSideMenuBackButton" ></ons-back-button>',t+="</div>",t+='<div class="center"><ons-icon icon="md-keyboard" size="30px" style="color: #1e88e5; margin-top: 7px"></ons-icon></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsVisInputDiv"></div>',t+="</ons-page>",t+="</ons-splitter-side>",t+='<ons-splitter-content id="content" page="tombioOnsVisDisplayTemplate"></ons-splitter-content>',t+="</ons-splitter>",t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisDisplayTemplate">',t+='<ons-page id="tombioOnsVisDisplay">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-toolbar-button id="tombioUiInputToolbarButton" onclick="tombiovis.gui.main.openMenu()">',t+='<ons-icon icon="md-keyboard"></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+='<div class="right">',t+='<ons-toolbar-button id="tombioUiFullscreenMenuButton" onclick="tombiovis.gui.main.fn.requestFullscreen()">',t+='<ons-icon icon="md-fullscreen"></ons-icon>',t+="</ons-toolbar-button>",t+='<ons-toolbar-button id="tombioUiExitFullscreenMenuButton" onclick="tombiovis.gui.main.fn.exitFullscreen()" style="display: none">',t+='<ons-icon icon="md-fullscreen-exit"></ons-icon>',t+="</ons-toolbar-button>",t+='<ons-toolbar-button id="tombioUiContextMenuButton" onclick="tombiovis.gui.main.openContext()">',t+='<ons-icon icon="md-more-vert"></ons-icon>',t+="</ons-toolbar-button>",t+='<ons-toolbar-button onclick="tombiovis.gui.main.popPage()">',t+='<ons-icon icon="md-menu"></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+='<div id="tombioOnsVisName" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsVisDisplayDiv"></div>',t+='<div id="tombioOnsOtherInfoDiv"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsDialogTemplate">',t+='<ons-page id="tombioOnsDialog">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div id="tombioOnsDialogTitle" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsDialogContent" style="margin: 1em"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsContextTemplate">',t+='<ons-page id="tombioOnsContext">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div class="center">Context menu</div>',t+="</ons-toolbar>",t+='<ons-list id="tombioOnsContextContent"></ons-list>',t+="</ons-page>",t+="</template>",l("#tombioOns").append(l(t)),m.gui.main.openMenu=function(){document.getElementById("tombioOnsMenu").open()},m.gui.main.openContext=function(){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsContextTemplate").then(function(){!function(){var t=[];for(var e in m.gui.main.contextMenu.items){var o=!0;-1==m.gui.main.contextMenu.visContexts[e].indexOf(m.v.currentTool)&&(o=!1),m.gui.main.contextMenu.guiContexts[e]&&-1==m.gui.main.contextMenu.guiContexts[e].indexOf(m.opts.gui)&&(o=!1),o&&(m.gui.main.contextMenu.items[e].on("click",m.gui.main.popPage),m.gui.main.contextMenu.items[e].on("click",m.gui.main.contextMenu.functions[e]),t.push(m.gui.main.contextMenu.items[e]))}l("#tombioOnsContextContent").html(""),l("#tombioOnsContextContent").append(t)}()})},m.gui.main.popPage=function(){document.querySelector("#tombioOnsNavigator").popPage().then(function(){}).catch(function(){})},document.addEventListener("init",function(t){var e=t.target;"tombioOnsToolSelect"===e.id?m.gui.main.createUIControls(!0):"tombioOnsVisDisplay"===e.id?(l("#tombioOnsVisDisplayDiv").append(l("#tombioOnsHiddenVisualisation")),l("#tombioOnsHiddenVisualisation").show()):"tombioOnsVisInput"===e.id&&(l("#tombioOnsVisInputDiv").append(l("#tombioOnsHiddenControls")),l("#tombioOnsHiddenControls").show(),document.querySelector("#tombioUiSideMenuBackButton").onClick=function(t){document.getElementById("tombioOnsMenu").close()})}),document.addEventListener("destroy",function(t){"tombioOnsVisualisation"===t.target.id&&(l("#tombioOnsHiddenVisualisation").hide(),l("#tombiod3vis").append(l("#tombioOnsHiddenVisualisation")),l("#tombioOnsHiddenControls").hide(),l("#tombiod3vis").append(l("#tombioOnsHiddenControls")))}),document.addEventListener("show",function(t){t.target}),document.addEventListener("hide",function(t){t.target}),ons.orientation.on("change",function(){c(),function(){0<l("#tombioOnsFullDetailsTab3").length&&l("#tombioNbnMapImage").css("height",l("#tombioOnsFullDetailsTab3").height()-10);0<l("#tombioOnsFullDetailsTab2").length&&l(".tombio-galleria-pane").data("galleria").resize({height:l("#tombioOnsFullDetailsTab2").height()})}()}),m.f.checkInterface("guiOnsenUi",m.templates.gui.main,m.gui.main)},m.gui.main.createUIControls=function(){var i=[],n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>';i.push(l('<ons-list-item value="reload" class="html" data-class="reload">'+n+"Reload</ons-list-item>")),n='<div class="left"><ons-icon icon="md-lamp" class="list-item__icon"></ons-icon></div>',i.push(l("<ons-list-header>Visualisations</ons-list-header>")),m.v.includedVisualisations.forEach(function(t,e){var o=l("<ons-list-item>").attr("value",t).attr("data-class","vis").text(m.js.jsFiles[t].toolName);o.append(l(n)),i.push(o)}),i.push(l("<ons-list-header>Help &amp; Information</ons-list-header>")),n='<div class="left"><ons-icon icon="md-info" class="list-item__icon"></ons-icon></div>',i.push(l('<ons-list-item id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info">'+n+"Using the...</ons-list-item>")),i.push(l('<ons-list-item value="kbInfo" class="html" data-class="info">'+n+"About the Knowledge-base</ons-list-item>")),i.push(l('<ons-list-item value="visInfo" class="html" data-class="info">'+n+"About FSC Identikit</ons-list-item>")),i.push(l('<ons-list-item value="tombioCitation" class="html" data-class="info">'+n+"Get citation text</ons-list-item>")),(m.opts.checkKB||m.opts.devel)&&i.push(l("<ons-list-header>For developers</ons-list-header>")),m.opts.checkKB&&(n='<div class="left"><ons-icon icon="md-wrench" class="list-item__icon"></ons-icon></div>',i.push(l('<ons-list-item value="mediaFilesCheck" class="html" data-class="wrench">'+n+"Check media files</ons-list-item>")),m.d.oCharacters.TVK&&i.push(l('<ons-list-item value="tvkCheck" class="html" data-class="wrench">'+n+"Check TVKs</ons-list-item>"))),m.opts.devel&&(n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>',i.push(l('<ons-list-item value="reloadGuiOnsen" class="html" data-class="reload">'+n+"Reload with mobile-first interface</ons-list-item>")),i.push(l('<ons-list-item value="reloadGuiJQuery" class="html" data-class="reload">'+n+"Reload with large format interface</ons-list-item>"))),i.forEach(function(t){"ons-list-item"==t.prop("tagName").toLowerCase()&&(u[t.attr("value")]=t.text(),t.on("click",function(){m.v.selectedTool=t.attr("value"),m.f.visChanged(m.v.selectedTool)}))}),l("#tombioOnsTools").append(i)},m.gui.main.visShow=function(a){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsVisualisationTemplate").then(function(){l("#tombioOnsVisName").text(u[a]),l("#tombioOnsOtherInfoDiv").html(null);var t,e;m.v.visualisations[a];if("tombioCitation"==a&&l("#tombioOnsOtherInfoDiv").html(((e=l("<div>")).append(l("<h3>").text("Citation for FSC Identikit (core software)")),t="This is the reference you can use for the FSC Identikit - in other words the core software.",t+=" The core version number is updated whenever there is a new major release of the core software.",e.append(l("<p>").html(t)),e.append(l("<b>").html(m.f.getCitation(m.d.softwareMetadata,"Software"))),e.append(l("<h3>").text("Citation for last selected visualisation tool")),t="This is the reference you can use for the last selected visualisation tool.",t+=" The tool version number is updated whenever there is a new release of the tool.",t+=" If you cite a tool, there's no need to cite the core software separately since it is implicit.",e.append(l("<p>").html(t)),e.append(l("<b>").html(m.f.getCitation(m.v.visualisations[m.v.lastVis].metadata,"Software",m.d.softwareMetadata.title))),e.append(l("<h3>").text("Citation for knowledge-base")),t="This is the reference you can use for the knowledge-base currently driving the software.",t+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.",e.append(l("<p>").html(t)),e.append(l("<b>").html(m.f.getCitation(m.d.kbmetadata,"Knowledge-base",m.d.softwareMetadata.title))),e)),"mediaFilesCheck"==a&&l("#tombioOnsOtherInfoDiv").html(m.f.createMediaCheckPage()),"tvkCheck"==a&&l("#tombioOnsOtherInfoDiv").html(m.f.createTvkCheckPage()),"kbInfo"==a&&m.f.setKbInfo(l("#tombioOnsOtherInfoDiv")),"visInfo"==a&&m.f.setVisInfo(l("#tombioOnsOtherInfoDiv")),"currentVisInfo"==a&&(l("#tombioOnsOtherInfoDiv").html(""),m.f.setSelectedToolInfo(l("#tombioOnsOtherInfoDiv"))),a!=m.v.currentTool&&(m.v.currentTool&&(m.v.visualisations[m.v.currentTool]?m.v.visualisations[m.v.currentTool].hide():l("#"+m.v.currentTool).hide()),m.v.visualisations[a]?m.v.visualisations[a].show():l("#"+a).show()),m.f.refreshVisualisation(),m.v.currentTool=a,-1<Object.keys(m.v.visualisations).indexOf(a)&&(m.v.lastVis=a,l("#optCurrentVisInfo>div.center").text("Using the "+m.v.visualisations[m.v.lastVis].metadata.title)),-1<m.v.includedVisualisations.indexOf(a)?(l("#tombioOnsVisDisplayDiv").show(),l("#tombioOnsOtherInfoDiv").hide()):(l("#tombioOnsVisDisplayDiv").hide(),l("#tombioOnsOtherInfoDiv").show()),c(),!m.v.initialised&&m.v.visualisations[a]){for(var o={},i=decodeURI(window.location.search.substring(1)).replace(/\+/g," ").split("&"),n=0;n<i.length;n++){var s=i[n].split("=");o[s[0]]=s[1]}m.v.visualisations[a].urlParams(o),m.v.initialised=!0}})},m.gui.main.dialog=function(t,e){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsDialogTemplate").then(function(){l("#tombioOnsDialogTitle").text(t),l("#tombioOnsDialogContent").html(e)})},m.gui.main.createCharacterTooltips=function(t){},m.gui.main.createTaxonToolTips=function(t,e){},m.gui.main.tooltip=function(t){},m.gui.main.showFullDetails=function(t,e,o,i){if(0==l("#tombioOnsFullDetailsTemplate").length){var s="";s+='<template id="tombioOnsFullDetailsTemplate">',s+='<ons-page id="tombioOnsFullDetails">',s+="<ons-toolbar>",s+='<div class="left">',s+="<ons-back-button></ons-back-button>",s+="</div>",s+='<div id="tombioOnsFullDetailsTitle" class="center"></div>',s+="</ons-toolbar>",s+='<ons-tabbar id="tombioOnsFullDetailsTabBar" swipeable position="auto">',s+='<ons-tab page="tombioOnsFullDetailsTab1Template" label="Knowledge" icon="md-grid" active>',s+="</ons-tab>",s+='<ons-tab page="tombioOnsFullDetailsTab2Template" label="Images" icon="md-image">',s+="</ons-tab>",m.d.oCharacters.TVK&&(s+='<ons-tab page="tombioOnsFullDetailsTab3Template" label="NBN Atlas" icon="md-map">',s+="</ons-tab>"),s+='<ons-tab page="tombioOnsFullDetailsTab4Template" label="Info" icon="md-file-text">',s+="</ons-tab>",s+="</ons-tabbar>",s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab1Template">',s+='<ons-page id="tombioOnsFullDetailsTab1">',s+='<div id="tombioOnsFullDetailsTab1Content" style="margin: 1em"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab2Template">',s+='<ons-page id="tombioOnsFullDetailsTab2">',s+='<div id="tombioOnsFullDetailsTab2Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab3Template">',s+='<ons-page id="tombioOnsFullDetailsTab3">',s+='<div id="tombioOnsFullDetailsTab3Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab4Template">',s+='<ons-page id="tombioOnsFullDetailsTab4">',s+='<div id="tombioOnsFullDetailsTab4Content"></div>',s+="</ons-page>",s+="</template>",l("#tombioOns").append(l(s)),document.addEventListener("show",function(t){var e=document.querySelector("#tombioOnsNavigator").topPage.data.taxon,o=document.querySelector("#tombioOnsNavigator").topPage.data.tab;l("#tombioOnsFullDetailsTitle").html("<i>"+e+"</i>"),t.target.matches("#tombioOnsFullDetailsTab1")&&l("#tombioOnsFullDetailsTab1Content").html(m.f.getTaxonCharacterValues(m.d.oTaxa[e])),t.target.matches("#tombioOnsFullDetailsTab2")&&(l("#tombioOnsFullDetailsTab2Content").html(""),l("#tombioOnsFullDetailsTab2Content").attr("data-taxon",e),m.f.addTaxonImagesToContainer({taxon:e,container:l("#tombioOnsFullDetailsTab2Content"),height:l("#tombioOnsFullDetailsTab2").css("height")})),t.target.matches("#tombioOnsFullDetailsTab3")&&(l("#tombioOnsFullDetailsTab3Content").html(""),m.f.addNBNMapToContainer(m.d.oTaxa[e].TVK,l("#tombioOnsFullDetailsTab3Content")),l("#tombioNbnMapImage").css("height",l("#tombioOnsFullDetailsTab3").height()-10)),t.target.matches("#tombioOnsFullDetailsTab4")&&(l("#tombioOnsFullDetailsTab4Content").html(""),function(e,t){var o=l("<div>").css("margin","10px").appendTo(t),i=m.f.getTaxonHtmlFiles(e);if(0==i.length)o.text("No text information files (HTML) are specified in the knowledge-base for this taxon.");else{var n=l("<div>");1<i.length&&(s='<ons-select onchange="tombiovis.gui.main.textFileSelect(event)">',i.forEach(function(t,e){s+='<option value="'+e+'">',s+=t.Caption,s+="</option>"}),s+="</ons-select>",o.html(s)),n.appendTo(o),m.f.addTaxonHtmlToContainer(e,n,0),m.gui.main.textFileSelect=function(t){m.f.addTaxonHtmlToContainer(e,n,t.target.value)}}}(e,l("#tombioOnsFullDetailsTab4Content"))),t.target.matches("#tombioOnsFullDetails")&&o&&document.querySelector("#tombioOnsFullDetailsTabBar").setActiveTab(o)},!1)}document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsFullDetailsTemplate",{data:{taxon:t,tab:e}}).then(function(){})},m.gui.main.contextMenu={items:{},functions:{},visContexts:{},guiContexts:{}},m.gui.main.contextMenu.addItem=function(t,e,o,i,n){if(o&&t in m.gui.main.contextMenu.items&&(m.gui.main.contextMenu.items[t].remove(),delete m.gui.main.contextMenu.items[t],delete m.gui.main.contextMenu.functions[t],delete m.gui.main.contextMenu.visContexts[t],delete m.gui.main.contextMenu.guiContexts[t]),!(t in m.gui.main.contextMenu.items)){var s=l('<ons-list-item><div class="left"><ons-icon icon="md-caret-right" class="list-item__icon"></ons-icon></div>'+t+"</ons-list-item>");m.gui.main.contextMenu.items[t]=s,m.gui.main.contextMenu.visContexts[t]=i,m.gui.main.contextMenu.guiContexts[t]=n,m.gui.main.contextMenu.functions[t]=e}},m.gui.main.contextMenu.removeItem=function(t){t in m.gui.main.contextMenu.items&&(delete m.gui.main.contextMenu.items[t],delete m.gui.main.contextMenu.functions[t],delete m.gui.main.contextMenu.visContexts[t],delete m.gui.main.contextMenu.guiContexts[t])},m.gui.main.fn.requestFullscreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),l("#tombioUiFullscreenMenuButton").hide(),l("#tombioUiExitFullscreenMenuButton").show()},m.gui.main.fn.exitFullscreen=function(){console.log("exit fullscreen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),l("#tombioUiFullscreenMenuButton").show(),l("#tombioUiExitFullscreenMenuButton").hide()}}(jQuery,this.tombiovis.templates.loading?this.tombiovis.templates:this.tombiovis);