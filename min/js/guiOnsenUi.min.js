!function(a,l){"use strict";var i,s={};function e(){var t,o=l.v.visualisations[l.v.currentTool];t=o&&o.inputControl?o.inputControl.width:o&&o.taxonSelect?o.taxonSelect.width:230,a("#tombioOnsMenu").css("width",t),window.matchMedia(i).matches||(-1<l.v.includedVisualisations.indexOf(l.v.currentTool)?(a("ons-splitter-content").css("left",t),a("ons-splitter-side").show()):(a("ons-splitter-content").css("left","0px"),a("ons-splitter-side").hide())),-1<l.v.includedVisualisations.indexOf(l.v.currentTool)&&window.matchMedia(i).matches?a("#tombioUiInputToolbarButton").show():a("#tombioUiInputToolbarButton").hide()}l.gui.main={},l.gui.main.setSelectedTool=function(t){},l.gui.main.resizeControlsAndTaxa=function(){},l.gui.main.init=function(){a("#tombiod3vis").html(""),a("<div>").attr("id","tombioOnsHiddenVisualisation").hide().appendTo("#tombiod3vis"),a("<div>").attr("id","tombioOnsHiddenControls").hide().appendTo("#tombiod3vis"),l.gui.main.divVis="#tombioOnsHiddenVisualisation",l.gui.main.divInput="#tombioOnsHiddenControls",a("<div>").attr("id","tombioOns").appendTo(a("#tombiod3vis"));var t="";t+='<ons-navigator swipeable id="tombioOnsNavigator" page="tombioOnsSelectTemplate"></ons-navigator>',t+='<template id="tombioOnsSelectTemplate">',t+='<ons-page id="tombioOnsToolSelect">',t+="<ons-toolbar>",t+='<div class="center">'+l.d.kbmetadata.title+"</div>",t+="</ons-toolbar>",t+='<ons-list id="tombioOnsTools"></ons-list>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisualisationTemplate">',t+='<ons-page id="tombioOnsVisualisation">',t+="<ons-splitter>",t+='<ons-splitter-side id="tombioOnsMenu" side="left" collapse="'+(i="(max-width: 979px)")+'" swipeable>',t+='<ons-page id="tombioOnsVisInput">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-back-button id="tombioUiSideMenuBackButton" ></ons-back-button>',t+="</div>",t+='<div class="center">Input</div>',t+="</ons-toolbar>",t+='<div id="tombioOnsVisInputDiv"></div>',t+="</ons-page>",t+="</ons-splitter-side>",t+='<ons-splitter-content id="content" page="tombioOnsVisDisplayTemplate"></ons-splitter-content>',t+="</ons-splitter>",t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisDisplayTemplate">',t+='<ons-page id="tombioOnsVisDisplay">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-toolbar-button id="tombioUiInputToolbarButton" onclick="tombiovis.gui.main.openMenu()">',t+='<ons-icon icon="md-keyboard"></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+='<div class="right">',t+='<ons-toolbar-button id="tombioUiContextMenuButton" onclick="tombiovis.gui.main.openContext()">',t+='<ons-icon icon="md-more-vert"></ons-icon>',t+="</ons-toolbar-button>",t+='<ons-toolbar-button onclick="tombiovis.gui.main.popPage()">',t+='<ons-icon icon="md-menu"></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+='<div id="tombioOnsVisName" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsVisDisplayDiv"></div>',t+='<div id="tombioOnsOtherInfoDiv"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsDialogTemplate">',t+='<ons-page id="tombioOnsDialog">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div id="tombioOnsDialogTitle" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsDialogContent" style="margin: 1em"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsContextTemplate">',t+='<ons-page id="tombioOnsContext">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div class="center">Context menu</div>',t+="</ons-toolbar>",t+='<ons-list id="tombioOnsContextContent"></ons-list>',t+="</ons-page>",t+="</template>",a("#tombioOns").append(a(t)),l.gui.main.openMenu=function(){document.getElementById("tombioOnsMenu").open()},l.gui.main.openContext=function(){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsContextTemplate").then(function(){!function(){var t=[];for(var o in l.gui.main.contextMenu.items){var i=!0;-1==l.gui.main.contextMenu.visContexts[o].indexOf(l.v.currentTool)&&(i=!1),l.gui.main.contextMenu.guiContexts[o]&&-1==l.gui.main.contextMenu.guiContexts[o].indexOf(l.opts.gui)&&(i=!1),i&&(l.gui.main.contextMenu.items[o].on("click",l.gui.main.popPage),l.gui.main.contextMenu.items[o].on("click",l.gui.main.contextMenu.functions[o]),t.push(l.gui.main.contextMenu.items[o]))}a("#tombioOnsContextContent").html(""),a("#tombioOnsContextContent").append(t)}()})},l.gui.main.popPage=function(){document.querySelector("#tombioOnsNavigator").popPage().then(function(){console.log("Page popped")}).catch(function(){console.log("Page pop error")})},document.addEventListener("init",function(t){var o=t.target;"tombioOnsToolSelect"===o.id?l.gui.main.createUIControls(!0):"tombioOnsVisDisplay"===o.id?(a("#tombioOnsVisDisplayDiv").append(a("#tombioOnsHiddenVisualisation")),a("#tombioOnsHiddenVisualisation").show()):"tombioOnsVisInput"===o.id&&(a("#tombioOnsVisInputDiv").append(a("#tombioOnsHiddenControls")),a("#tombioOnsHiddenControls").show(),document.querySelector("#tombioUiSideMenuBackButton").onClick=function(t){document.getElementById("tombioOnsMenu").close()})}),document.addEventListener("destroy",function(t){"tombioOnsVisualisation"===t.target.id&&(a("#tombioOnsHiddenVisualisation").hide(),a("#tombiod3vis").append(a("#tombioOnsHiddenVisualisation")),a("#tombioOnsHiddenControls").hide(),a("#tombiod3vis").append(a("#tombioOnsHiddenControls")))}),document.addEventListener("show",function(t){t.target}),document.addEventListener("hide",function(t){t.target}),ons.orientation.on("change",function(){e(),function(){0<a("#tombioOnsFullDetailsTab3").length&&a("#tombioNbnMapImage").css("height",a("#tombioOnsFullDetailsTab3").height()-10);0<a("#tombioOnsFullDetailsTab2").length&&a(".tombio-galleria-pane").data("galleria").resize({height:a("#tombioOnsFullDetailsTab2").height()})}()}),l.f.checkInterface("guiOnsenUi",l.templates.gui.main,l.gui.main)},l.gui.main.createUIControls=function(){var e=[],n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>';e.push(a('<ons-list-item value="reload" class="html" data-class="reload">'+n+"Reload</ons-list-item>")),e.push(a('<ons-list-item value="reloadGuiOnsen" class="html" data-class="reload">'+n+"Reload with mobile-first interface</ons-list-item>")),e.push(a('<ons-list-item value="reloadGuiJQuery" class="html" data-class="reload">'+n+"Reload with large format interface</ons-list-item>")),n='<div class="left"><ons-icon icon="md-lamp" class="list-item__icon"></ons-icon></div>',e.push(a("<ons-list-header>Visualisations</ons-list-header>")),l.v.includedVisualisations.forEach(function(t,o){var i=a("<ons-list-item>").attr("value",t).attr("data-class","vis").text(l.js.jsFiles[t].toolName);i.append(a(n)),e.push(i)}),e.push(a("<ons-list-header>Help &amp; Information</ons-list-header>")),n='<div class="left"><ons-icon icon="md-info" class="list-item__icon"></ons-icon></div>',e.push(a('<ons-list-item id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info">'+n+"Using the...</ons-list-item>")),e.push(a('<ons-list-item value="kbInfo" class="html" data-class="info">'+n+"About the Knowledge-base</ons-list-item>")),e.push(a('<ons-list-item value="visInfo" class="html" data-class="info">'+n+"About FSC Identikit</ons-list-item>")),e.push(a('<ons-list-item value="tombioCitation" class="html" data-class="info">'+n+"Get citation text</ons-list-item>")),e.push(a("<ons-list-header>Other</ons-list-header>")),l.opts.checkKB&&(n='<div class="left"><ons-icon icon="md-wrench" class="list-item__icon"></ons-icon></div>',e.push(a('<ons-list-item value="mediaFilesCheck" class="html" data-class="wrench">'+n+"Check media files</ons-list-item>")),l.d.oCharacters.TVK&&e.push(a('<ons-list-item value="tvkCheck" class="html" data-class="wrench">'+n+"Check TVKs</ons-list-item>"))),e.forEach(function(t){"ons-list-item"==t.prop("tagName").toLowerCase()&&(s[t.attr("value")]=t.text(),t.on("click",function(){l.v.selectedTool=t.attr("value"),l.f.visChanged(l.v.selectedTool)}))}),a("#tombioOnsTools").append(e)},l.gui.main.visShow=function(i){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsVisualisationTemplate").then(function(){a("#tombioOnsVisName").text(s[i]),a("#tombioOnsOtherInfoDiv").html(null);var t,o;l.v.visualisations[i];"tombioCitation"==i&&a("#tombioOnsOtherInfoDiv").html(((o=a("<div>")).append(a("<h3>").text("Citation for FSC Identikit (core software)")),t="This is the reference you can use for the FSC Identikit - in other words the core software.",t+=" The core version number is updated whenever there is a new major release of the core software.",o.append(a("<p>").html(t)),o.append(a("<b>").html(l.f.getCitation(l.d.softwareMetadata,"Software"))),o.append(a("<h3>").text("Citation for last selected visualisation tool")),t="This is the reference you can use for the last selected visualisation tool.",t+=" The tool version number is updated whenever there is a new release of the tool.",t+=" If you cite a tool, there's no need to cite the core software separately since it is implicit.",o.append(a("<p>").html(t)),o.append(a("<b>").html(l.f.getCitation(l.v.visualisations[l.v.lastVis].metadata,"Software",l.d.softwareMetadata.title))),o.append(a("<h3>").text("Citation for knowledge-base")),t="This is the reference you can use for the knowledge-base currently driving the software.",t+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.",o.append(a("<p>").html(t)),o.append(a("<b>").html(l.f.getCitation(l.d.kbmetadata,"Knowledge-base",l.d.softwareMetadata.title))),o)),"mediaFilesCheck"==i&&a("#tombioOnsOtherInfoDiv").html(l.f.createMediaCheckPage()),"tvkCheck"==i&&a("#tombioOnsOtherInfoDiv").html(l.f.createTvkCheckPage()),"kbInfo"==i&&l.f.setKbInfo(a("#tombioOnsOtherInfoDiv")),"visInfo"==i&&l.f.setVisInfo(a("#tombioOnsOtherInfoDiv")),"currentVisInfo"==i&&(a("#tombioOnsOtherInfoDiv").html(""),l.f.setSelectedToolInfo(a("#tombioOnsOtherInfoDiv"))),i!=l.v.currentTool&&(l.v.currentTool&&(l.v.visualisations[l.v.currentTool]?l.v.visualisations[l.v.currentTool].hide():a("#"+l.v.currentTool).hide()),l.v.visualisations[i]?l.v.visualisations[i].show():a("#"+i).show()),l.f.refreshVisualisation(),l.v.currentTool=i,-1<Object.keys(l.v.visualisations).indexOf(i)&&(l.v.lastVis=i,a("#optCurrentVisInfo>div.center").text("Using the "+l.v.visualisations[l.v.lastVis].metadata.title)),-1<l.v.includedVisualisations.indexOf(i)?(a("#tombioOnsVisDisplayDiv").show(),a("#tombioOnsOtherInfoDiv").hide()):(a("#tombioOnsVisDisplayDiv").hide(),a("#tombioOnsOtherInfoDiv").show()),e()})},l.gui.main.dialog=function(t,o){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsDialogTemplate").then(function(){a("#tombioOnsDialogTitle").text(t),a("#tombioOnsDialogContent").html(o)})},l.gui.main.createCharacterTooltips=function(t){},l.gui.main.createTaxonToolTips=function(t,o){},l.gui.main.tooltip=function(t){},l.gui.main.showFullDetails=function(t,o,i,e){if(0==a("#tombioOnsFullDetailsTemplate").length){var s="";s+='<template id="tombioOnsFullDetailsTemplate">',s+='<ons-page id="tombioOnsFullDetails">',s+="<ons-toolbar>",s+='<div class="left">',s+="<ons-back-button></ons-back-button>",s+="</div>",s+='<div id="tombioOnsFullDetailsTitle" class="center"></div>',s+="</ons-toolbar>",s+='<ons-tabbar id="tombioOnsFullDetailsTabBar" swipeable position="auto">',s+='<ons-tab page="tombioOnsFullDetailsTab1Template" label="Knowledge" icon="md-grid" active>',s+="</ons-tab>",s+='<ons-tab page="tombioOnsFullDetailsTab2Template" label="Images" icon="md-image">',s+="</ons-tab>",l.d.oCharacters.TVK&&(s+='<ons-tab page="tombioOnsFullDetailsTab3Template" label="NBN Atlas" icon="md-map">',s+="</ons-tab>"),s+='<ons-tab page="tombioOnsFullDetailsTab4Template" label="Info" icon="md-file-text">',s+="</ons-tab>",s+="</ons-tabbar>",s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab1Template">',s+='<ons-page id="tombioOnsFullDetailsTab1">',s+='<div id="tombioOnsFullDetailsTab1Content" style="margin: 1em"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab2Template">',s+='<ons-page id="tombioOnsFullDetailsTab2">',s+='<div id="tombioOnsFullDetailsTab2Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab3Template">',s+='<ons-page id="tombioOnsFullDetailsTab3">',s+='<div id="tombioOnsFullDetailsTab3Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab4Template">',s+='<ons-page id="tombioOnsFullDetailsTab4">',s+='<div id="tombioOnsFullDetailsTab4Content"></div>',s+="</ons-page>",s+="</template>",a("#tombioOns").append(a(s)),document.addEventListener("show",function(t){var o=document.querySelector("#tombioOnsNavigator").topPage.data.taxon,i=document.querySelector("#tombioOnsNavigator").topPage.data.tab;t.target.matches("#tombioOnsFullDetailsTab1")&&(a("#tombioOnsFullDetailsTitle").html("<i>"+o+"</i>"),a("#tombioOnsFullDetailsTab1Content").html(l.f.getTaxonCharacterValues(l.d.oTaxa[o]))),t.target.matches("#tombioOnsFullDetailsTab2")&&(a("#tombioOnsFullDetailsTab2Content").html(""),a("#tombioOnsFullDetailsTab2Content").attr("data-taxon",o),l.f.addTaxonImagesToContainer({taxon:o,container:a("#tombioOnsFullDetailsTab2Content"),height:a("#tombioOnsFullDetailsTab2").css("height")})),t.target.matches("#tombioOnsFullDetailsTab3")&&(a("#tombioOnsFullDetailsTab3Content").html(""),l.f.addNBNMapToContainer(l.d.oTaxa[o].TVK,a("#tombioOnsFullDetailsTab3Content")),a("#tombioNbnMapImage").css("height",a("#tombioOnsFullDetailsTab3").height()-10)),t.target.matches("#tombioOnsFullDetailsTab4")&&(a("#tombioOnsFullDetailsTab4Content").html(""),function(o,t){var i=a("<div>").css("margin","10px").appendTo(t),e=l.f.getTaxonHtmlFiles(o);if(0==e.length)i.text("No text information files (HTML) are specified in the knowledge-base for this taxon.");else{var n=a("<div>");1<e.length&&(s='<ons-select onchange="tombiovis.gui.main.textFileSelect(event)">',e.forEach(function(t,o){s+='<option value="'+o+'">',s+=t.Caption,s+="</option>"}),s+="</ons-select>",i.html(s)),n.appendTo(i),l.f.addTaxonHtmlToContainer(o,n,0),l.gui.main.textFileSelect=function(t){l.f.addTaxonHtmlToContainer(o,n,t.target.value)}}}(o,a("#tombioOnsFullDetailsTab4Content"))),t.target.matches("#tombioOnsFullDetails")&&i&&document.querySelector("#tombioOnsFullDetailsTabBar").setActiveTab(i)},!1)}document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsFullDetailsTemplate",{data:{taxon:t,tab:o}}).then(function(){})},l.gui.main.contextMenu={items:{},functions:{},visContexts:{},guiContexts:{}},l.gui.main.contextMenu.addItem=function(t,o,i,e,n){if(i&&t in l.gui.main.contextMenu.items&&(l.gui.main.contextMenu.items[t].remove(),delete l.gui.main.contextMenu.items[t],delete l.gui.main.contextMenu.functions[t],delete l.gui.main.contextMenu.visContexts[t],delete l.gui.main.contextMenu.guiContexts[t]),!(t in l.gui.main.contextMenu.items)){var s=a('<ons-list-item><div class="left"><ons-icon icon="md-dot-circle" class="list-item__icon"></ons-icon></div>'+t+"</ons-list-item>");l.gui.main.contextMenu.items[t]=s,l.gui.main.contextMenu.visContexts[t]=e,l.gui.main.contextMenu.guiContexts[t]=n,l.gui.main.contextMenu.functions[t]=o}},l.gui.main.contextMenu.removeItem=function(t){t in l.gui.main.contextMenu.items&&(delete l.gui.main.contextMenu.items[t],delete l.gui.main.contextMenu.functions[t],delete l.gui.main.contextMenu.visContexts[t],delete l.gui.main.contextMenu.guiContexts[t])}}(jQuery,this.tombiovis.templates.loading?this.tombiovis.templates:this.tombiovis);