!function(f,b){"use strict";function s(){for(var i in b.gui.main.contextMenu.items){var e=!0;-1==b.gui.main.contextMenu.visContexts[i].indexOf(b.v.currentTool)&&(e=!1),b.gui.main.contextMenu.guiContexts[i]&&-1==b.gui.main.contextMenu.guiContexts[i].indexOf(b.opts.gui)&&(e=!1),e?b.gui.main.contextMenu.items[i].show():b.gui.main.contextMenu.items[i].hide()}}b.gui.main={},b.gui.main.contextMenu={items:{},visContexts:{},guiContexts:{}},b.gui.main.contextMenu.addItem=function(i,e,t,o,a){if(t&&i in b.gui.main.contextMenu.items&&(b.gui.main.contextMenu.items[i].remove(),delete b.gui.main.contextMenu.items[i],delete b.gui.main.contextMenu.visContexts[i],delete b.gui.main.contextMenu.guiContexts[i]),!(i in b.gui.main.contextMenu.items)){var n=f("<li>").append(f("<div>").text(i).click(e));b.gui.main.contextMenu.menu.append(n),b.gui.main.contextMenu.menu.menu("refresh"),b.gui.main.contextMenu.items[i]=n,b.gui.main.contextMenu.visContexts[i]=o,b.gui.main.contextMenu.guiContexts[i]=a}s()},b.gui.main.contextMenu.removeItem=function(i){i in b.gui.main.contextMenu.items&&(b.gui.main.contextMenu.items[i].remove(),delete b.gui.main.contextMenu.items[i],delete b.gui.main.contextMenu.visContexts[i],delete b.gui.main.contextMenu.guiContexts[i])},b.gui.main.setSelectedTool=function(i){f("#tombioGuiLargeJqueryUiVisualisation").val()!=i&&f("#tombioGuiLargeJqueryUiVisualisation").val(i)},b.gui.main.resizeControlsAndTaxa=function(){if(f("#tombioGuiLargeJqueryUiControls").is(":visible")){var i=f("#tombioGuiLargeJqueryUiControls").width();f("#tombioGuiLargeJqueryUiTaxa").css("margin-left",i+10);var e=f("#tombioGuiLargeJqueryUiControls").height();f("#tombioGuiLargeJqueryUiControlsAndTaxa").css("min-height",e+10)}else f("#tombioGuiLargeJqueryUiTaxa").css("margin-left",0),f("#tombioGuiLargeJqueryUiControlsAndTaxa").css("min-height","0px")},b.gui.main.init=function(){f("#tombiod3vis").html(""),f("#tombiod3vis").css("position","relative"),f("<div>").attr("id","tombioGuiLargeJqueryUi").addClass("needsclick").css("display","none").appendTo("#tombiod3vis"),f("<div style='width: "+window.screen.width+"px'>").attr("id","tombioGuiLargeJqueryUiDeviceWarning").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","tombioGuiLargeJqueryUiDeviceWarningInnerDiv").css("margin","2em").appendTo(f("#tombioGuiLargeJqueryUiDeviceWarning")),f("<p>").text("This Identikit tool is designed for large format devices. If you are working with a small screen or with a touch device, it might not appear or work as intended. We are working to produce a range of 'mobile-first' tools in the latter part of 2018.").appendTo(f("#tombioGuiLargeJqueryUiDeviceWarningInnerDiv")),f("<img>").attr("id","tombioGuiLargeJqueryUiDeviceWarningButton").attr("src",b.opts.tombiopath+"/resources/remove.png").css("position","absolute").css("right","10px").css("top","10px").appendTo(f("#tombioGuiLargeJqueryUiDeviceWarningInnerDiv")),f("#tombioGuiLargeJqueryUiDeviceWarningButton").on("click",function(){f("#tombioGuiLargeJqueryUiDeviceWarning").hide()}),f("<div>").attr("id","tombioGuiLargeJqueryUiFlashDisplay").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),f("<select>").attr("id","tombioGuiLargeJqueryUiVisualisation").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").addClass("tombioNoSelect").attr("id","tombioGuiLargeJqueryUiControlsAndTaxa").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","tombioGuiLargeJqueryUiControls").appendTo("#tombioGuiLargeJqueryUiControlsAndTaxa"),f("<div>").attr("id","tombioGuiLargeJqueryUiTaxa").appendTo("#tombioGuiLargeJqueryUiControlsAndTaxa"),f("<div>").attr("id","currentVisInfo").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","kbInfo").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","visInfo").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","tombioCitation").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","mediaFilesCheck").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),f("<div>").attr("id","tvkCheck").css("display","none").appendTo("#tombioGuiLargeJqueryUi"),b.gui.main.divVis="#tombioGuiLargeJqueryUiTaxa",b.gui.main.divInput="#tombioGuiLargeJqueryUiControls",b.f.checkInterface("guiLargeJqueryUi",b.templates.gui.main,b.gui.main)},b.gui.main.createUIControls=function(){f("#tombioGuiLargeJqueryUi").css("display",""),b.gui.main.contextMenu.menu=f("<ul>").css("white-space","nowrap").appendTo("#tombioGuiLargeJqueryUi").addClass("contextMenu").css("position","absolute").css("display","none").css("z-index",999999),b.gui.main.contextMenu.menu.menu(),f("#tombioGuiLargeJqueryUi").on("contextmenu",function(i){b.gui.main.contextMenu.menu.position({});var e=f(this).parent().offset(),t=i.pageX-e.left,o=i.pageY-e.top;return b.gui.main.contextMenu.menu.css({left:t,top:o}),b.gui.main.contextMenu.menu.show(),!1}),f("#tombioGuiLargeJqueryUi").on("click",function(){b.gui.main.contextMenu.menu.hide()});var o=[];o.push(f('<option value="reload" class="html" data-class="reload">Reload</option>')),o.push(f('<option value="reloadGuiOnsen" class="html" data-class="reload">Reload with mobile-first interface</option>')),o.push(f('<option value="reloadGuiJQuery" class="html" data-class="reload">Reload with large format interface</option>')),b.v.includedVisualisations.forEach(function(i,e){var t=f('<option class="needsclick">').attr("value",i).attr("data-class","vis").addClass("visualisation").text(b.js.jsFiles[i].toolName);o.push(t)}),o.push(f('<option id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info"></option>')),o.push(f('<option value="kbInfo" class="html" data-class="info">About the Knowledge-base</option>')),o.push(f('<option value="visInfo" class="html" data-class="info">About FSC Identikit</option>')),o.push(f('<option value="tombioCitation" class="html" data-class="info">Get citation text</option>')),b.opts.checkKB&&(o.push(f('<option value="mediaFilesCheck" class="html" data-class="wrench">Check media files</option>')),b.d.oCharacters.TVK&&o.push(f('<option value="tvkCheck" class="html" data-class="wrench">Check TVKs</option>'))),o.forEach(function(i){i.attr("value")==b.v.selectedTool&&i.attr("selected","selected")}),f("#tombioGuiLargeJqueryUiVisualisation").append(o),f.widget("custom.iconselectmenu",f.ui.selectmenu,{_renderItem:function(i,e){var t=f("<li>"),o=f("<div>",{text:e.label});return e.disabled&&t.addClass("ui-state-disabled"),f("<span>",{style:e.element.attr("data-style"),class:"ui-icon "+e.element.attr("data-class")}).appendTo(o),t.append(o).appendTo(i)}}),f("#tombioGuiLargeJqueryUiVisualisation").iconselectmenu({change:function(){b.f.visChanged(f("#tombioGuiLargeJqueryUiVisualisation").val())}}).iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),1==b.opts.hideVisDropdown&&f("#tombioGuiLargeJqueryUiVisualisation-button").hide()},b.gui.main.visShow=function(i){var e=b.v.visualisations[i];if("tombioCitation"==i&&f("#tombioCitation").html(b.f.createCitationPage()),"mediaFilesCheck"==i&&f("#mediaFilesCheck").html(b.f.createMediaCheckPage()),"tvkCheck"==i&&f("#tvkCheck").html(b.f.createTvkCheckPage()),"kbInfo"==i&&0==f("#kbInfo").html().length&&b.f.setKbInfo(f("#kbInfo")),"visInfo"==i&&0==f("#visInfo").html().length&&b.f.setVisInfo(f("#visInfo")),"currentVisInfo"==i&&(f("#currentVisInfo").html(""),b.f.setSelectedToolInfo(f("#currentVisInfo"))),console.log("selectedToolName",i),i!=b.v.currentTool&&(b.v.currentTool&&(b.v.visualisations[b.v.currentTool]?b.v.visualisations[b.v.currentTool].hide():f("#"+b.v.currentTool).hide()),b.v.visualisations[i]?b.v.visualisations[i].show():f("#"+i).show()),e?f("#tombioGuiLargeJqueryUiControlsAndTaxa").show():f("#tombioGuiLargeJqueryUiControlsAndTaxa").hide(),b.f.refreshVisualisation(),b.v.currentTool=i,-1<Object.keys(b.v.visualisations).indexOf(i)&&(b.v.lastVis=i,f("#optCurrentVisInfo").text("Using the "+b.v.visualisations[b.v.lastVis].metadata.title),f("#tombioGuiLargeJqueryUiVisualisation").iconselectmenu("refresh")),s(),!b.v.initialised&&b.v.visualisations[i]){for(var t={},o=decodeURI(window.location.search.substring(1)).replace(/\+/g," ").split("&"),a=0;a<o.length;a++){var n=o[a].split("=");t[n[0]]=n[1]}b.v.visualisations[i].urlParams(t),b.v.initialised=!0}},b.gui.main.dialog=function(i,e){f("#tombioGuiDialog").remove(),f("<div>").attr("id","tombioGuiDialog").css("display","none").appendTo(f("#tombioGuiLargeJqueryUi")),f("#tombioGuiDialog").dialog({modal:!1,width:550,height:450,resizable:!0,draggable:!0,autoOpen:!1,show:{effect:"highlight",duration:500},hide:{effect:"fade",duration:250}}),f("#tombioGuiDialog").dialog("option","title",i),f("#tombioGuiDialog").html(e),f("#tombioGuiDialog").dialog("open")},b.gui.main.createCharacterTooltips=function(i){f(i).tooltip({track:!0,items:"span",content:function(){return function(e){var t=f("<div/>"),i=!1;if(b.d.oCharacters[e].HelpShort&&""!=b.d.oCharacters[e].HelpShort){var o=b.d.oCharacters[e].HelpShort;i=!0}else var o=b.d.oCharacters[e].Help;var a,n,s=b.d.media.filter(function(i){if(("image-local"==i.Type||"image-web"==i.Type)&&i.Character==e)return!0}).sort(function(i,e){return Number(i.Priority)-Number(e.Priority)}),r=0,u=0;s.forEach(function(e){var t=!1,o=!1;e.UseFor?e.UseFor.split(",").forEach(function(i){"tip"==i.toLowerCase().trim()&&(o=!e.State),"full"==i.toLowerCase().trim()&&(t=!0)}):(o=!e.State,t=!0),o&&!a?a=e:t&&r++,t&&u++});var l=!1;if(a){(n=f("<figure/>")).addClass("keyInputHelpFigure");var d=f("<img/>",{src:a.URI}).appendTo(n).css("margin-top",2);a.ImageWidth&&d.css("width",a.ImageWidth);f("<figcaption/>",{html:a.Caption}).appendTo(n);if(a.TipStyle&&""!=a.TipStyle){var c=a.TipStyle.split("-"),m=c[0],p=c[1];n.css("width",p+"%"),n.css("float",m),n.css("margin-bottom",5),"right"==m?n.css("margin-left",5):n.css("margin-right",5),l=!0}}var g=[];l&&g.push(n);0<o.length&&g.push(f("<span/>").html(o));!l&&n&&g.push(n);g.forEach(function(i){t.append(i)});var h=b.f.stateValueHelpPresent(b.d.oCharacters[e]),v="";if(i||0<r||0<h.length)var v="(Click for <b>more detailed help</b>.)";else if(a&&0<u)var v="(Click for resizeable help window.)";v&&f("<div/>").css("margin-top",5).css("font-weight","normal").html(v).appendTo(t);return t}(f(this).attr("character"))}})},b.gui.main.createTaxonToolTips=function(i,e){f(i).tooltip({track:!0,items:"text",content:function(){if(e)return b.f.getTaxonTipImage(this.textContent,this)},open:function(i,e){var t=f(i.target);e.tooltip.click(function(){t.tooltip("close")})}})},b.gui.main.tooltip=function(i){f(i).tooltip()},b.gui.main.showFullDetails=function(i,e,t,o){var a;t=void 0!==t?t:0,o=void 0!==o?o:0,e=void 0!==e?e:1;var n=f("<div>").addClass("tombioFullDetailsTabs");n.css("border","none");var s=f("<ul>").appendTo(n);s.append("<li><a href='#tabs-1'>Knowledge-base</a></li>"),s.append("<li><a href='#tabs-2'>Images</a></li>"),b.d.oCharacters.TVK&&s.append("<li><a href='#tabs-4'>NBN map</a></li>"),s.append("<li><a href='#tabs-3'>Details</a></li>");var r=f("<div>").attr("id","tabs-1").appendTo(n),u=f("<div>").attr("id","tabs-2").appendTo(n);if(b.d.oCharacters.TVK)var l=f("<div>").attr("id","tabs-4").appendTo(n);var d=f("<div>").attr("id","tabs-3").appendTo(n),c=f("<div>").append(n);c.attr("title",i),c.dialog({closeText:"",height:550,width:600,modal:!0,resizeStop:function(i,e){n.tabs("refresh"),g()}}),n.tabs({heightStyle:"fill",active:e,create:function(){a=c.height()-r.height()},activate:function(i,e){n.tabs("refresh"),1==e.newTab.index()&&g()}}),d.css("overflow","hidden");var m=b.f.getTaxonCharacterValues(b.d.oTaxa[i]);r.append(m);b.f.addTaxonImagesToContainer({taxon:i,container:u,height:u.height()});if(b.d.oCharacters.TVK&&b.d.oTaxa[i].TVK){var p=f("<div>").css("position","relative").appendTo(l);b.f.addNBNMapToContainer(b.d.oTaxa[i].TVK,p)}function g(){var i=c.find(".tombio-galleria-pane").first();i.data("galleria")&&(i.data("galleria").setOptions("height",c.height()-a),i.data("galleria").resize())}!function(t,i){var e=f("<div>").appendTo(i),o=b.f.getTaxonHtmlFiles(t);if(0==o.length){var a=f("<div>").css("margin","10px").appendTo(e);a.text("No text information files (HTML) are specified in the knowledge-base for this taxon.")}else{var n=f("<div>");if(1<o.length){var s=f('<div style="margin-bottom: 20px">').appendTo(e),r=f("<select id='tombioFileSelect'></select>").appendTo(s);o.forEach(function(i,e){var t=f("<option/>").text(i.Caption).attr("value",e);r.append(t)}),r.selectmenu({change:function(i,e){b.f.addTaxonHtmlToContainer(t,n,e.item.value)}})}n.appendTo(e),b.f.addTaxonHtmlToContainer(t,n,0)}}(i,d)}}(jQuery,this.tombiovis.templates.loading?this.tombiovis.templates:this.tombiovis);