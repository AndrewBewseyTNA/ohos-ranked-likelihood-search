!function(V,A){"use strict";function H(){var a=V("input[name=charvisibility]:checked").val();V(".cloneInput .stateselect, .cloneInput .statespinner").each(function(t){if(void 0!==V(this).attr("id"))if("visible"==a)V(this).parents(".cloneInput").show(500,A.f.resizeControlsAndTaxa);else{var e=V(this).val();e&&""!=e?V(this).parents(".cloneInput").show(500,A.f.resizeControlsAndTaxa):V(this).parents(".cloneInput").hide(500,A.f.resizeControlsAndTaxa)}})}function L(n){var s=V("#"+n).pqSelect({multiplePlaceholder:"select option(s)",singlePlaceholder:"select option",checkbox:!0,search:!1,maxDisplay:20,width:240,selectallText:""});s.addClass("stateselect"),s.on("change",function(){if("clone-"==n.substring(0,6))var t=n.substring(6);else t="clone-"+n;if(V("#"+t).val(s.val()),V("#"+t).pqSelect("refreshData"),V("#"+n).pqSelect("refresh"),H(),"clone-"==n.substring(0,6))var a=n.substring(6);else a=n;var e=null!=s.val()&&""!=s.val();if(A.d.oCharacters[a].stateSet=e){if("string"==typeof s.val())var i=[s.val()];else i=s.val();var r=[];A.d.oCharacters[a].CharacterStateValues.forEach(function(t,e){-1<i.indexOf(t)&&r.push(e)}),A.d.oCharacters[a].userInput=r}else A.d.oCharacters[a].userInput=null;[n,t].forEach(function(t){var e=V("#"+t).next().children().find(".pq-select-item-text");e.attr("title",function(){var e=this,t=A.d.values.filter(function(t){if(t.Character==a&&t.CharacterState==V(e).text())return!0});return 1==t.length?t[0].StateHelpShort?t[0].StateHelpShort:t[0].StateHelp:""}),e.tooltip({track:!0})}),A.f.refreshVisualisation()}),s.val(V("#"+n+" option:first").val()).pqSelect("refreshData"),s.val("").pqSelect("refreshData")}function P(n,t,e,a){var s=V("#"+n).spinner({min:t,max:e,step:a});s.addClass("statespinner"),s.on("spinstop",function(t,e){var a=s.spinner("value");if("clone-"==n.substring(0,6))var i=n.substring(6);else i="clone-"+n;if(V("#"+i).spinner("value",a),"clone-"==n.substring(0,6))var r=n.substring(6);else r=n;A.d.oCharacters[r].stateSet=!0,A.d.oCharacters[r].userInput=a,A.f.refreshVisualisation(),H()}),V("#"+n+"-clear").button({icon:"ui-icon-close",showLabel:!1}).on("click",function(){if(s.spinner("value",""),"clone-"==n.substring(0,6))var t=n.substring(6);else t="clone-"+n;if(V("#"+t).spinner("value",s.spinner("value")),"clone-"==n.substring(0,6))var e=n.substring(6);else e=n;A.d.oCharacters[e].stateSet=!1,A.d.oCharacters[e].userInput=null,A.f.refreshVisualisation()})}A.gui.keyInput={width:360,otherState:{keys:[]},bullet:"",inputCharGroups:[],verticalTabSpace:33},A.gui.keyInput.init=function(t){var a=this;V("<div>").attr("id","tombioKeyInputTabs").css("background-color","rgba( 255,255, 255, 0.7)").appendTo(t),V("<ul>").attr("id","tombioKeyInputListElements").appendTo("#tombioKeyInputTabs"),A.gui.keyInput.divSel="#tombioKeyInputTabs";var e={All:[]};for(var i in A.d.characters.forEach(function(t){"key"==t.Status&&(e[t.Group]||(e[t.Group]=[],a.inputCharGroups.push(t.Group)),e[t.Group].push(t))}),V(A.gui.main.divInput).css("min-height",this.verticalTabSpace*(this.inputCharGroups.length+2)),e){var r="tombioKeyInputTab-"+i.replace(/\s+/g,"-"),n=V("<li/>"),s=V("<a/>").text(i).attr("href","#"+r);n.append(s),V("#tombioKeyInputListElements").append(n);var o=V("<div/>").attr("id",r);if(V("#tombioKeyInputTabs").append(o),"tombioKeyInputTab-All"==r){o.append(V("<div>").text("Un-used characters:").css("font-weight","bold"));var l=V("<fieldset>").attr("id","visCheckboxes").css("display","inline-block").css("padding","0px").css("border","none");l.append(V("<label>").attr("for","charvisible").text("show")),l.append(V("<input>").attr("type","radio").attr("name","charvisibility").attr("id","charvisible").attr("value","visible").attr("checked","checked")),l.append(V("<label>").attr("for","incharvisible").text("hide")),l.append(V("<input>").attr("type","radio").attr("name","charvisibility").attr("id","incharvisible").attr("value","invisible")),o.append(l),V("[name='charvisibility']").checkboxradio({icon:!1}),l.on("change",H);var c=V("<button>").attr("id","tombioReset").text("Reset all");c.button({icons:{primary:null,secondary:"ui-icon-reset"}}).click(function(t){V(".statespinner").spinner("value",""),V(".stateselect").each(function(){V(this).val()&&V(this).val("").pqSelect("refreshData")}),A.d.characters.forEach(function(t){t.stateSet=!1,t.userInput=null}),A.f.refreshVisualisation(),H()}),o.append(c)}for(var p=0;p<e[i].length;p++){var u=e[i][p],h=V("<span/>").attr("class","characterlabel").text(u.Label),d=V("<div/>").append(h);o.append(d),A.f.characterHasHelp(u.Character)&&(h.attr("character",u.Character),h.addClass("characterhelp"));var v=V("<div/>").attr("class","cloneInput");if(v.append(d.clone()),V("#tombioKeyInputTab-All").css("display","inline-block").append(v),"numeric"==u.ValueType){var f=u.Character,b=u.Params.split(","),m=Number(b[0]),g=Number(b[1]),y=Number(b[2]),C=V("<div>"),k=V("<input></input>").attr("class","spinner").attr("id",f),I=V("<div value='x'>").attr("class","widget").attr("class","spinclear").attr("id",f+"-clear");C.append(k),C.append(I),o.append(C),P(f,m,g,y);var S=V("<div>"),x=V("<input></input>").attr("class","spinner").attr("id","clone-"+f),T=V("<div value='x'>").attr("class","widget").attr("class","spinclear").attr("id","clone-"+f+"-clear");S.append(x),S.append(T),v.append(S),P("clone-"+f,m,g,y)}else{var G=u.Character;if("multi"==u.ControlType)var K=V("<select multiple=multiple></select>").attr("class","characterSelect");else K=V("<select></select>").attr("class","characterSelect");if(K.attr("id",G),o.append(K),"single"==u.ControlType){var w=V("<option/>").text("");K.append(w)}u.CharacterStateValues.forEach(function(t){var e=V("<option/>").text(a.bullet+t);K.append(e)}),L(G);var E=V("#"+G).clone();E.attr("id","clone-"+G),v.append(E),L("clone-"+G)}}}A.d.oCharacters.grouped||(V("#tombioKeyInputListElements").css("display","none"),V("#tombioKeyInputTabs").css("padding-left","0px"),A.gui.keyInput.width=255);var q=V("#tombioKeyInputTabs").tabs({activate:function(t,e){V(".stateselect").each(function(){}),A.f.resizeControlsAndTaxa()}});if(A.opts.toolconfig.keyinput||(A.opts.toolconfig.keyinput={}),void 0===A.opts.toolconfig.keyinput.selectedGroup&&(void 0===A.opts.selectedGroup?A.opts.toolconfig.keyinput.selectedGroup=A.d.kbconfig.defaultControlGroup?A.d.kbconfig.defaultControlGroup:null:A.opts.toolconfig.keyinput.selectedGroup=A.opts.selectedGroup?A.opts.selectedGroup:null),A.opts.toolconfig.keyinput.selectedGroup){var D=a.inputCharGroups.indexOf(A.opts.toolconfig.keyinput.selectedGroup);-1<D&&q.tabs("option","active",D+1)}V(".characterhelp").hover(function(){V(this).animate({color:"#D55E00"},"fast")},function(){V(this).animate({color:"black"},"fast")}).click(function(){var t,e;t=V(this).attr("character"),e=V("<div>"),V("<h3/>",{text:A.d.oCharacters[t].Label}).appendTo(e),e.append(V(A.f.getFullCharacterHelp(t))),A.gui.main.dialog("Character help & info",e.html())}),A.gui.main.createCharacterTooltips(".characterhelp"),A.f.checkInterface("keyInput",A.templates.gui.keyInput,A.gui.keyInput)},A.gui.keyInput.initFromCharacterState=function(){A.d.characters.forEach(function(e,t){if("spin"===e.ControlType){var a=V("#"+e.Character+".statespinner"),i=V("#clone-"+e.Character+".statespinner"),r=e.stateSet?e.userInput:"";a.spinner("value",e.userInput),i.spinner("value",r)}else{a=V("#"+e.Character+".stateselect"),i=V("#clone-"+e.Character+".stateselect");if(e.stateSet)var n=e.userInput.map(function(t){return e.CharacterStateValues[t]});else n=[];a.val(n).pqSelect("refreshData"),i.val(n).pqSelect("refreshData")}})},A.gui.keyInput.initStateFromParams=function(t){this.initFromCharacterState(),V("#tombioKeyInputTabs").tabs("option","active",t.grp),V("[name='charvisibility']").removeProp("checked").filter('[value="'+t.cvis+'"]').prop("checked",!0),V("[name='charvisibility']").checkboxradio("refresh"),H()},A.gui.keyInput.setParamsFromState=function(t){return t.push("grp="+V("#tombioKeyInputTabs").tabs("option","active")),t.push("cvis="+V("input[name=charvisibility]:checked").val()),t}}(jQuery,this.tombiovis.templates.loading?this.tombiovis.templates:this.tombiovis);