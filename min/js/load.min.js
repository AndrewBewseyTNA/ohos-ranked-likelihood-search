if(function(c){"use strict";window.console||(window.console={log:function(){}}),c.opts||(c.opts={}),c.opts.toolconfig||(c.opts.toolconfig={}),"undefined"!=typeof tombiover&&(c.opts.tombiover=tombiover),"undefined"!=typeof tombiopath&&(c.opts.tombiopath=tombiopath),"undefined"!=typeof tombiokbpath&&(c.opts.tombiokbpath=tombiokbpath);var e=new URLSearchParams(window.location.search).get("gui");e&&(c.opts.gui=e),c.f={},c.d={},c.d.nbnMapCache={},c.d.scoreColours=["#fc8d59","#ffffbf","#91bfdb"],c.v={},c.v.visualisations={},c.js={},c.gui={},c.gui.sharedKeyInput={},c.d.softwareMetadata={title:"FSC Identikit",year:"2018",authors:"Burkmar, R.",publisher:"Field Studies Council",location:"Shrewsbury, England",contact:"r.burkmar@field-studies-council.org",version:"1.7.1"};var n=["vis1","vis2","vis5","vis4","vis3"];c.v.includedVisualisations=[];var o=c.js.jsFiles={add:function(e,s,i,o){c.js.jsFiles[e]=Object.create(t),c.js.jsFiles[e].init(e,s,i,o)},asArray:function(){var e=[];for(var s in c.js.jsFiles)c.js.jsFiles.hasOwnProperty(s)&&e.push(c.js.jsFiles[s]);return e}},t={init:function(e,s,i,o){this.id=e,this.file=r(c.opts.tombiopath+s),this.tombiover=i,this.requires=[],this.requiresFirst=[],this.css=[],this.toolName=o},addCSS:function(e){this.css.push(r(c.opts.tombiopath+e))},loadJs:function(t,n){if(!this.p){var r=this.id,s=[];this.requires.forEach(function(e){s.push(o[e].loadJs(r,!1))});var i=[];if(this.requiresFirst.forEach(function(e){i.push(o[e].loadJs(r,!0))}),this.tombiover)var a=this.file+"?ver="+c.opts.tombiover;else a=this.file;a=this.file;var d=this.css,u=this.initF;this.p=Promise.all(i).then(function(){var e=new Promise(function(s,i){var o=document.createElement("script");o.src=a,o.onreadystatechange=o.onload=function(){if(!o.readyState||/loaded|complete/.test(o.readyState)){var e="";t&&(e=n?" (req before "+t+")":" (req by "+t+")"),console.log("%cLoaded JS file "+l(a)+" "+e,"color: blue"),u&&u(),d.forEach(function(e){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=e,document.querySelector("head").appendChild(s),console.log("%cLoaded CSS file "+l(e),"color: green")}),s()}else console.log("%cFailed to load JS file for "+r,"color: red"),i()},document.querySelector("head").appendChild(o)});return s.push(e),Promise.all(s)})}return this.p}};function r(e){if(c.opts.devel)return e;if(-1<e.indexOf("dependencies"))return e;var s=e.lastIndexOf("."),i=e.substr(s+1),o=e.substr(0,s),t=o.lastIndexOf("/");return"min/"+i+"/"+(-1==t?o:o.substr(t+1))+".min."+i}function l(e){var s=e.split("/");return s[s.length-1]}function s(e,s){(c.opts.toolconfig[e]||(c.opts.toolconfig[e]={}),o[e].requiresFirst||(o[e].requiresFirst=[]),s)&&(c.opts.toolconfig[e].keyinput||(c.opts.toolconfig.defaultKeyinput?c.opts.toolconfig[e].keyinput=c.opts.toolconfig.defaultKeyinput:c.opts.toolconfig[e].keyinput="keyInput"),o[e].requiresFirst.push(c.opts.toolconfig[e].keyinput))}c.f.showDownloadSpinner=function(){var e=document.createElement("div");e.id="downloadspin";var s=document.getElementById("tombiod3");s.insertBefore(e,s.firstChild);new Spinner({lines:13,length:28,width:14,radius:42,scale:.8,corners:1,color:"#000",opacity:.15,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"49%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}).spin(e)},c.f.hideDownloadSpinner=function(){var e=document.getElementById("tombiod3"),s=document.getElementById("downloadspin");e.removeChild(s)},o.add("spinner","dependencies/spin.min.js"),o.add("jquery","dependencies/jquery-3.1.1/jquery-3.1.1.min.js"),o.add("d3","dependencies/d3-4.10.0/d3.v4.min.js"),o.add("jqueryui","dependencies/jquery-ui-1.12.1/jquery-ui.min.js"),o.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.min.css"),o.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.theme.min.css"),o.jqueryui.addCSS("css/jquery-ui-tombio.css"),o.add("zoomMaster","dependencies/zoom-master/jquery.zoom.min.js"),o.add("galleria","dependencies/galleria-1.5.7/galleria/galleria-1.5.7.min.js"),o.galleria.addCSS("dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.css"),o.galleria.initF=function(){Galleria.loadTheme(c.opts.tombiopath+"dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.min.js"),Galleria.on("image",function(e){$(e.imageTarget).parent().zoom({on:"grab"})})},o.add("mousewheel","dependencies/jquery.mousewheel.min.js"),o.add("hammer","dependencies/hammer.min.js"),o.add("pqselect","dependencies/pqselect-1.3.2/pqselect.min.js"),o.pqselect.addCSS("dependencies/pqselect-1.3.2/pqselect.min.css"),o.pqselect.requiresFirst=["jqueryui"],o.add("pqgrid","dependencies/pqgrid-2.1.0/pqgrid.min.js"),o.pqgrid.addCSS("dependencies/pqgrid-2.1.0/pqgrid.min.css"),o.pqgrid.requiresFirst=["jqueryui"],o.add("keyinputTemplate","keyinputTemplate.js",!0),o.add("keyInput","keyinput.js",!0),o.keyInput.addCSS("css/keyinput.css"),o.keyInput.requires=["pqselect","jqueryui"],o.add("keyInputBasic","keyinputBasic.js",!0),o.keyInputBasic.addCSS("css/keyinputbasic.css"),o.add("keyInputOnsenUi","keyinputOnsenUi.js",!0),o.keyInputOnsenUi.addCSS("css/keyinputOnsenUi.css"),o.keyInputOnsenUi.requiresFirst=["onsenui"],o.add("tombiovis","tombiovis.js",!0),o.tombiovis.addCSS("css/tombiovis.css"),o.tombiovis.requires=["kbchecks"],o.add("kbchecks","kbchecks.js",!0),o.add("score","score.js",!0),o.add("taxonselect","taxonselect.js",!0),o.taxonselect.addCSS("css/taxonselect.css"),o.taxonselect.requires=["jqueryui"],o.add("visP","visP.js",!0),o.visP.requires=["mousewheel","galleria","zoomMaster"],o.add("guiTemplate","guiTemplate.js",!0),o.add("guiLargeJqueryUi","guiLargeJqueryUi.js",!0),o.guiLargeJqueryUi.addCSS("css/guiLargeJqueryUi.css"),o.guiLargeJqueryUi.requires=["jqueryui"],o.add("guiLarge","guiLarge.js",!0),o.guiLarge.addCSS("css/guiLarge.css"),o.add("guiOnsenUi","guiOnsenUi.js",!0),o.guiOnsenUi.addCSS("css/guiOnsenUi.css"),o.guiOnsenUi.requiresFirst=["onsenui"],o.add("onsenui","dependencies/onsenui-2.10.3/js/onsenui.min.js"),o.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsenui.min.css"),o.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsen-css-components.min.css"),o.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsenui-fonts.css"),o.add("visTemplate","visTemplate/visTemplate.js"),o.visTemplate.requiresFirst=["visP"],o.add("vis1","vis1/vis1.js",!0,"Two-column key"),o.vis1.addCSS("vis1/vis1.css"),o.vis1.requiresFirst=["visP"],o.vis1.requires=["score"],s("vis1",!0),o.add("vis2","vis2/vis2.js",!0,"Single-column key"),o.vis2.addCSS("vis2/vis2.css"),o.vis2.requiresFirst=["visP"],o.vis2.requires=["score"],s("vis2",!0),o.add("vis3","vis3/vis3.js",!0,"Side by side comparison"),o.vis3.addCSS("vis3/vis3.css"),o.vis3.requiresFirst=["visP"],s("vis3",!(o.vis3.requires=["taxonselect","pqgrid","score"])),o.add("vis4","vis4/vis4.js",!0,"Full taxon details"),o.vis4.addCSS("vis4/vis4.css"),o.vis4.requiresFirst=["visP"],s("vis4",!(o.vis4.requires=["taxonselect"])),o.add("vis5","vis5/vis5.js",!0,"Circle-pack key"),o.vis5.addCSS("vis5/vis5.css"),o.vis5.requiresFirst=["visP"],o.vis5.requires=["score"],s("vis5",!0),o.add("visEarthworm2","visEarthworm2/visEarthworm2.js",!0,"Bespoke earthworm key"),o.visEarthworm2.addCSS("visEarthworm2/visEarthworm2.css"),o.visEarthworm2.requiresFirst=["visP"],o.visEarthworm2.requires=["jqueryui","score"],c.f.startLoad=function(){o.spinner.loadJs().then(function(){return c.f.showDownloadSpinner(),Promise.all([o.d3.loadJs(),o.jquery.loadJs()])}).then(function(){return jQuery(document).ready(function(){jQuery("#tombiod3").append(jQuery('<div id="tombiod3vis">'))}),function(){var e,o="none",s=[];return e=new Promise(function(s){d3.csv(c.opts.tombiokbpath+"taxa.csv?"+o,function(e){return t(e)},function(e){c.d.taxa=e,console.log("%cLoading - kb taxa loaded","color: blue"),s()})}),s.push(e),e=new Promise(function(s){d3.csv(c.opts.tombiokbpath+"characters.csv?"+o,function(e){return t(e)},function(e){c.d.characters=e,console.log("%cLoading - kb characters loaded","color: blue"),s()})}),s.push(e),e=new Promise(function(s){d3.csv(c.opts.tombiokbpath+"values.csv?"+o,function(e){return t(e)},function(e){c.d.values=e,console.log("%cLoading - kb values loaded","color: blue"),s()})}),s.push(e),e=new Promise(function(s){d3.csv(c.opts.tombiokbpath+"media.csv?"+o,function(e){return t(e)},function(e){c.d.media=e,console.log("%cLoading - kb media loaded","color: blue"),s()})}),s.push(e),e=new Promise(function(i){d3.csv(c.opts.tombiokbpath+"config.csv?"+o,function(e){return t(e)},function(e){c.d.config=e,c.d.kbconfig={},c.d.kbmetadata={},c.d.kbreleaseHistory=[];var s=[];e.forEach(function(e){"config"==e.Type&&(c.d.kbconfig[e.Key]=e.Value),c.opts.selectedTool,"excludedDefaultTools"==e.Key&&""!=e.Value.trim()&&e.Value.split(",").forEach(function(e){s.push(e.trim())}),"otherIncludedTools"==e.Key&&""!=e.Value.trim()&&e.Value.split(",").forEach(function(e){c.v.includedVisualisations.push(e.trim())}),"metadata"==e.Type&&(c.d.kbmetadata[e.Key]=e.Value),"release"==e.Key&&c.d.kbreleaseHistory.push(e)}),n.forEach(function(e){-1==s.indexOf(e)&&c.v.includedVisualisations.push(e)}),c.opts.tools&&Array.isArray(c.opts.tools)&&0<c.opts.tools.length&&(c.v.includedVisualisations=c.opts.tools),console.log("%cLoading - kb config loaded","color: blue"),i()})}),s.push(e),Promise.all(s).then(function(){console.log("%cKB is loaded!","color: blue")});function t(e){if(""!=e[Object.keys(e)[0]]&&"#"!=e[Object.keys(e)[0]].substr(0,1)){for(var s in e)e.hasOwnProperty(s)&&(e[s]=e[s]?e[s].trim():"","?"==e[s]&&(e[s]=""));return e}return null}}()}).then(function(){return c.templates={gui:{main:{}}},c.templates.loading=!0,Promise.all([o.guiTemplate.loadJs(),o.visTemplate.loadJs(),o.keyinputTemplate.loadJs()])}).then(function(){c.templates.loading=!1}).then(function(){return Promise.all([o.tombiovis.loadJs()])}).then(function(){if(c.opts.gui)var e=c.opts.gui;else e="guiLargeJqueryUi";var s=[o[e].loadJs()];Promise.all(s).then(function(){c.f.hideDownloadSpinner(),c.f.loadcomplete()})})},c.opts.loadWait||c.f.startLoad()}(this.tombiovis?this.tombiovis:this.tombiovis={}),tombiovis.opts.devel)var v=tombiovis;