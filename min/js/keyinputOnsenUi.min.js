!function(a,s){"use strict";function n(){var o=!1;s.d.groupedCharacters.groups.forEach(function(e,t){var n="";s.d.groupedCharacters[e].forEach(function(t){if(t.stateSet){if(o=!0,n||(n+='<ul style="padding-left: 25px; margin: 0">'),n+="<li>",n+=t.Label+": ","text"==t.ValueType||"ordinal"==t.ValueType||"ordinalCircular"==t.ValueType){var i="";t.userInput.forEach(function(e){i&&(i+=" <i>or</i> "),i+='<span class="tombioOnsKiGroupSummaryValue">'+t.CharacterStateValues[e]+"</span>"})}else if("numeric"==t.ValueType)i='<span class="tombioOnsKiGroupSummaryValue">'+t.userInput+"</span>";n+=i,n+="</li>"}}),n&&(n+="</ul>"),a('.tombioOnsKiGroupSummary[data-group="'+e+'"]').html(n)}),o?(console.log("show"),a("#tombioOnsKiReset").show()):(console.log("hide"),a("#tombioOnsKiReset").hide())}function r(e){return e.substr(12)}function u(e,t){var i="";if(i+=void 0!==t?e.CharacterStates[t].StateHelpShort?e.CharacterStates[t].StateHelpShort:e.CharacterStates[t].StateHelp:e.HelpShort?e.HelpShort:e.Help,void 0!==t)var n=e.CharacterStates[t].StateHelpShort&&e.CharacterStates[t].StateHelp||0<s.f.getCharacterImages(e.Character,e.CharacterStateValues[t],"full").length;else n=s.f.stateValueHelpPresent(e.Character)||0<s.f.getCharacterImages(e.Character,null,"full").length;return n&&(i&&(i+=" "),i+='<a href="" onclick="tombiovis.gui.keyInputOnsenUi.fn.showHelp(event, \''+e.Character+"')\">More help</a>"),i||void 0!==t||("numeric"==e.ValueType?i+="Enter an appropriate value below.":i+="Select an appropriate value below."),i}function c(e,t){var i=s.d.oCharacters[e];if(("text"==i.ValueType||"ordinal"==i.ValueType||"ordinalCircular"==i.ValueType)&&t.querySelector("ons-checkbox").checked||"numeric"==i.ValueType&&""!=t.querySelector("ons-input").value)var n=!0;else n=!1;return n}s.gui.keyInputOnsenUi={width:250,otherState:{keys:[]},fn:{}},s.gui.keyInputOnsenUi.init=function(e){var t=a("<div>").attr("id","tombioKeyinputOnsenUi").appendTo(e),o="";if(1<s.d.groupedCharacters.groups.length)var i="tombioOnsKiGroupsTemplate";else i="tombioOnsKiGroup-None-template";o+='<ons-navigator swipeable id="tombioOnsKiNavigator" page="'+i+'"></ons-navigator>',o+='<template id="tombioOnsKiGroupsTemplate">',o+='<ons-page id="tombioOnsKiGroups">',o+='<ons-fab id="tombioOnsKiReset" position="bottom right" ripple="true" modifier="mini" style="display: none">',o+='<ons-icon icon="md-replay" onclick="tombiovis.gui.keyInputOnsenUi.fn.clearInput()"></ons-icon>',o+="</ons-fab>",o+="<ons-list>",s.d.groupedCharacters.groups.forEach(function(e,t){1<s.d.groupedCharacters.groups.length&&(o+="<ons-list-item expandable tappable onclick=\"tombiovis.gui.keyInputOnsenUi.fn.displayGroupControls('"+e+"')\">",o+='<div class="center">',o+='<span class="list-item__title">'+e+"</span>",o+='<span class="tombioOnsKiGroupSummary tombioOnsKiShortHelp" data-group="'+e+'"></span>',o+="</div>",o+="</ons-list-item>")}),o+="</ons-list> ",o+="</ons-page>",o+="</template>",s.d.groupedCharacters.groups.forEach(function(e,t){o+='<template id="tombioOnsKiGroup-'+e.replace(" ","")+'-template">',o+='<ons-page id="tombioOnsKiGroup-'+e.replace(" ","")+'">',s.d.groupedCharacters[e].forEach(function(e){var i,n;1<s.d.groupedCharacters.groups.length&&(o+='<ons-toolbar modifier="noshadow">',o+='<div class="left">',o+="<ons-back-button></ons-back-button>",o+="</div>",o+='<div class="center">back to overview</div>',o+="</ons-toolbar>"),"text"==e.ValueType||"ordinal"==e.ValueType||"ordinalCircular"==e.ValueType?o+=(n="",n+="<ons-list>",n+='<ons-list-item tappable class="tombioKiOuiCharcterListItem" id="tombioKiOui-'+(i=e).Character+'" data-shown="false" expandable>',n+='<div class="tombioKiOuiCharcterListItemText deselected middle">'+i.Label+"</div>",n+='<div class="expandable-content tombioOnsKiShortHelp"  onclick="tombiovis.gui.keyInputOnsenUi.fn.toggleExpansion(event, \''+i.Character+"')\">"+u(i)+"</div>",n+="</ons-list-item>",n+='<div id="tombioKiOui-'+i.Character+'-stateItems">',i.CharacterStateValues.forEach(function(e,t){n+='<ons-list-item id="tombioKiOui-'+i.Character+"-"+t+'" style="display: none" >',n+='<div class="middle" onclick="tombiovis.gui.keyInputOnsenUi.fn.toggleExpansion(event, \''+i.Character+"')\">"+e+"</div>",n+='<div class="left">',n+="<ons-checkbox onclick=\"tombiovis.gui.keyInputOnsenUi.fn.checkboxClicked(event, '"+i.Character+"', '"+t+"')\"></ons-checkbox>",n+="</div>",n+="</ons-list-item>"}),n+="</div>",n+="</ons-list>"):"numeric"==e.ValueType&&(o+=function(e){var t="";t+="<ons-list>",t+='<ons-list-item class="tombioKiOuiCharcterListItem" id="tombioKiOui-'+e.Character+'" expandable data-shown="false">',t+='<div class="tombioKiOuiCharcterListItemText deselected middle">'+e.Label+"</div>",t+='<div class="expandable-content tombioOnsKiShortHelp">'+u(e)+"</div>",t+="</ons-list-item>",t+='<div id="tombioKiOui-'+e.Character+'-stateItems">',t+='<ons-list-item style="display: none">',t+='<div class="middle">',t+='<ons-input style="width: 90%" modifier="underbar" placeholder="Enter numeric value" type="number"',t+=" onchange=\"tombiovis.gui.keyInputOnsenUi.fn.numericChanged('"+e.Character+"')\"",t+=" onkeyup=\"tombiovis.gui.keyInputOnsenUi.fn.numericChanged('"+e.Character+"')\" > ",t+="</ons-input>";var i=e.Params.split(","),n=Number(i[0]),o=Number(i[1]),a=Number(i[2]);return t+='<ons-range style="width: 90%; margin-top: 10px" value="0" min="'+n+'" max="'+o+'" step="'+a+'"',t+=" onchange=\"tombiovis.gui.keyInputOnsenUi.fn.numericRangeChanged('"+e.Character+"')\" > ",t+="</ons-range>",t+="</div>",t+='<div class="right">',t+='<ons-icon icon="md-close-circle" size="25px" style="color: #1e88e5"',t+=" onclick=\"tombiovis.gui.keyInputOnsenUi.fn.numericClear('"+e.Character+"')\" > ",t+="</ons-icon>",t+="</div>",t+="</ons-list-item>",t+="</div>",t+="</ons-list>"}(e))}),o+="</ons-page>",o+="</template>"}),t.html(o),s.gui.keyInputOnsenUi.divSel="#tombioKeyinputOnsenUi",s.f.checkInterface("keyInputOnsenUi",s.templates.gui.keyInput,s.gui.keyInputOnsenUi),document.addEventListener("listAnimated",function(e){var t=r(a(e.detail.listItem).attr("id"));s.gui.keyInputOnsenUi.fn.displaySelect(t,e.detail.action)}),document.addEventListener("init",function(e){var t=e.target;t.id.startsWith("tombioOnsKiGroup-")&&a("#"+t.id+" .tombioKiOuiCharcterListItem").each(function(){var t=r(a(this).attr("id"));s.d.oCharacters[t].stateSet&&(console.log(t,s.d.oCharacters[t].ValueType),"text"==s.d.oCharacters[t].ValueType||"ordinal"==s.d.oCharacters[t].ValueType||"ordinalCircular"==s.d.oCharacters[t].ValueType?s.d.oCharacters[t].userInput.forEach(function(e){a("#tombioKiOui-"+t+"-"+e+" ons-checkbox")[0].checked=!0}):"numeric"==s.d.oCharacters[t].ValueType&&(console.log("seting numeric ",s.d.oCharacters[t].userInput),a("#tombioKiOui-"+t+"-stateItems ons-input")[0].value=s.d.oCharacters[t].userInput),s.gui.keyInputOnsenUi.fn.displaySelect(t,"hide"))})}),document.addEventListener("show",function(e){"tombioOnsKiGroups"==e.target.id&&n()})},s.gui.keyInputOnsenUi.initFromCharacterState=function(){},s.gui.keyInputOnsenUi.initStateFromParams=function(e){n()},s.gui.keyInputOnsenUi.setParamsFromState=function(e){return e},s.gui.keyInputOnsenUi.fn.displayGroupControls=function(e){var t="tombioOnsKiGroup-"+e.replace(" ","")+"-template";document.querySelector("#tombioOnsKiNavigator").pushPage(t)},s.gui.keyInputOnsenUi.fn.displaySelect=function(e,t){var i="#tombioKiOui-"+e,n=i+"-stateItems > ons-list-item";"show"==t?(a(i).attr("data-shown","true"),a(n+" ons-range").show(),a(n).slideDown(200)):(a(i).attr("data-shown","false"),a(n).each(function(){c(e,this)?a(this).slideDown(200):a(this).slideUp(200),a(n+" ons-range").slideUp(200)})),a(i+" .tombioKiOuiCharcterListItemText").removeClass("selected deselected");var o=!1;a(n).each(function(){c(e,this)&&(o=!0)}),o||"show"==t?(a(i+" .tombioKiOuiCharcterListItemText").removeClass("deselected"),a(i+" .tombioKiOuiCharcterListItemText").addClass("selected")):(a(i+" .tombioKiOuiCharcterListItemText").removeClass("selected"),a(i+" .tombioKiOuiCharcterListItemText").addClass("deselected"))},s.gui.keyInputOnsenUi.fn.checkboxClicked=function(e,t,i){"true"==a("#tombioKiOui-"+t).attr("data-shown")&&document.querySelector("#tombioKiOui-"+t).hideExpansion(),document.querySelector("#tombioKiOui-"+t+"-"+i).hideExpansion();var n="#tombioKiOui-"+t+"-stateItems > ons-list-item";"single"==s.d.oCharacters[t].ControlType&&(document.querySelector("#tombioKiOui-"+t+"-"+i+" ons-checkbox").checked&&a(n).each(function(e){e!=i&&(this.querySelector("ons-checkbox").checked=!1)}));s.gui.keyInputOnsenUi.fn.displaySelect(t,"hide");var o=[];a(n).each(function(e){this.querySelector("ons-checkbox").checked&&o.push(e)}),0<o.length?(s.d.oCharacters[t].userInput=o,s.d.oCharacters[t].stateSet=!0):(s.d.oCharacters[t].userInput=null,s.d.oCharacters[t].stateSet=!1),s.f.refreshVisualisation()},s.gui.keyInputOnsenUi.fn.toggleExpansion=function(e,t){"false"==a("#tombioKiOui-"+t).attr("data-shown")?document.querySelector("#tombioKiOui-"+t).showExpansion():document.querySelector("#tombioKiOui-"+t).hideExpansion()},s.gui.keyInputOnsenUi.fn.numericChanged=function(e){var t=document.querySelector("#tombioKiOui-"+e+"-stateItems ons-input").value;"false"==a("#tombioKiOui-"+e).attr("data-shown")&&""==t&&document.querySelector("#tombioKiOui-"+e).hideExpansion();var i=""==t?0:t;document.querySelector("#tombioKiOui-"+e+"-stateItems ons-range").value=i,""!=t?(s.d.oCharacters[e].userInput=t,s.d.oCharacters[e].stateSet=!0):(s.d.oCharacters[e].userInput=null,s.d.oCharacters[e].stateSet=!1),s.f.refreshVisualisation()},s.gui.keyInputOnsenUi.fn.numericRangeChanged=function(e){var t=document.querySelector("#tombioKiOui-"+e+"-stateItems ons-range").value;document.querySelector("#tombioKiOui-"+e+"-stateItems ons-input").value=t,s.gui.keyInputOnsenUi.fn.numericChanged(e)},s.gui.keyInputOnsenUi.fn.numericClear=function(e){document.querySelector("#tombioKiOui-"+e+"-stateItems ons-input").value="",s.gui.keyInputOnsenUi.fn.numericChanged(e)},s.gui.keyInputOnsenUi.fn.clearInput=function(e){s.d.characters.forEach(function(e){e.userInput=null,e.stateSet=!1}),n(),s.f.refreshVisualisation()},s.gui.keyInputOnsenUi.fn.showHelp=function(e,t){e.preventDefault(),e.stopPropagation(),s.gui.main.dialog("Character help & info",s.f.getFullCharacterHelp(t))}}(jQuery,this.tombiovis.templates.loading?this.tombiovis.templates:this.tombiovis);