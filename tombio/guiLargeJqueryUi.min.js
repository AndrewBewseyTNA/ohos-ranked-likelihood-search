(function(n,t){"use strict";function i(){t.gui.main.contextMenu={};t.gui.main.contextMenu.items={};t.gui.main.contextMenu.contexts={};t.gui.main.contextMenu.menu=n("<ul>").css("white-space","nowrap").appendTo("#tombioGuiLargeJqueryUi").addClass("contextMenu").css("position","absolute").css("display","none").css("z-index",999999);t.gui.main.contextMenu.menu.menu();n("#tombioGuiLargeJqueryUi").on("contextmenu",function(i){t.gui.main.contextMenu.menu.position({});var r=n(this).parent().offset(),u=i.pageX-r.left,f=i.pageY-r.top;return t.gui.main.contextMenu.menu.css({left:u,top:f}),t.gui.main.contextMenu.menu.show(),!1});n("#tombioGuiLargeJqueryUi").on("click",function(){t.gui.main.contextMenu.menu.hide()});t.gui.main.contextMenu.addItem=function(i,r,u,f){if(f&&i in t.gui.main.contextMenu.items&&(t.gui.main.contextMenu.items[i].remove(),delete t.gui.main.contextMenu.items[i],delete t.gui.main.contextMenu.contexts[i]),!(i in t.gui.main.contextMenu.items)){var e=n("<li>").append(n("<div>").text(i).click(r));t.gui.main.contextMenu.menu.append(e);t.gui.main.contextMenu.menu.menu("refresh");t.gui.main.contextMenu.items[i]=e;t.gui.main.contextMenu.contexts[i]=u}};t.gui.main.contextMenu.removeItem=function(n){n in t.gui.main.contextMenu.items&&(t.gui.main.contextMenu.items[n].remove(),delete t.gui.main.contextMenu.items[n],delete t.gui.main.contextMenu.contexts[n])};t.gui.main.contextMenu.contextChanged=function(n){for(var i in t.gui.main.contextMenu.items)t.gui.main.contextMenu.contexts[i].indexOf(n)>-1?t.gui.main.contextMenu.items[i].show():t.gui.main.contextMenu.items[i].hide()}}function r(i){var h=n("<div/>"),c=!1,o,r,s,v,k,f,w,e;t.d.oCharacters[i].HelpShort&&t.d.oCharacters[i].HelpShort!=""?(o=t.d.oCharacters[i].HelpShort,c=!0):o=t.d.oCharacters[i].Help;var b=t.d.media.filter(function(n){if((n.Type=="image-local"||n.Type=="image-web")&&n.Character==i)return!0}).sort(function(n,t){return Number(n.Priority)-Number(t.Priority)}),u,l=0,a=0;if(b.forEach(function(n){var t=!1,i=!1;n.UseFor?n.UseFor.split(",").forEach(function(r){r.toLowerCase().trim()=="tip"&&(i=n.State?!1:!0);r.toLowerCase().trim()=="full"&&(t=!0)}):(i=n.State?!1:!0,t=!0);i&&!u?u=n:t&&l++;t&&a++}),s=!1,u&&(r=n("<figure/>"),r.addClass("keyInputHelpFigure"),v=n("<img/>",{src:u.URI}).appendTo(r).css("margin-top",2),u.ImageWidth&&v.css("width",u.ImageWidth),k=n("<figcaption/>",{html:u.Caption}).appendTo(r),u.TipStyle&&u.TipStyle!="")){var y=u.TipStyle.split("-"),p=y[0],d=y[1];r.css("width",d+"%");r.css("float",p);r.css("margin-bottom",5);p=="right"?r.css("margin-left",5):r.css("margin-right",5);s=!0}return f=[],s&&f.push(r),o.length>0&&f.push(n("<span/>").html(o)),!s&&r&&f.push(r),f.forEach(function(n){h.append(n)}),w=t.d.values.filter(function(n){if(n.Character==i&&n.StateHelp)return!0}),e="",c||l>0||w.length>0?e="(Click for <b>more detailed help<\/b>.)":u&&a>0&&(e="(Click for resizeable help window.)"),e&&n("<div/>").css("margin-top",5).css("font-weight","normal").html(e).appendTo(h),h}t.gui.main={};t.gui.main.setSelectedTool=function(t){n("#tombioGuiLargeJqueryUiVisualisation").val()!=t&&n("#tombioGuiLargeJqueryUiVisualisation").val(t)};t.gui.main.resizeControlsAndTaxa=function(){var t,i;n("#tombioGuiLargeJqueryUiControls").is(":visible")?(t=n("#tombioGuiLargeJqueryUiControls").width(),n("#tombioGuiLargeJqueryUiTaxa").css("margin-left",t+10),i=n("#tombioGuiLargeJqueryUiControls").height(),n("#tombioGuiLargeJqueryUiControlsAndTaxa").css("min-height",i+10)):(n("#tombioGuiLargeJqueryUiTaxa").css("margin-left",0),n("#tombioGuiLargeJqueryUiControlsAndTaxa").css("min-height","0px"))};t.gui.main.addTopPageElements=function(){n("#tombiod3vis").html("");n("#tombiod3vis").css("position","relative");n("<div>").attr("id","tombioGuiLargeJqueryUi").addClass("needsclick").css("display","none").appendTo("#tombiod3vis");n("<div>").attr("id","tombioGuiLargeJqueryUiDeviceWarning").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","tombioGuiLargeJqueryUiDeviceWarningInnerDiv").css("margin","2em").appendTo(n("#tombioGuiLargeJqueryUiDeviceWarning"));n("<p>").text("This Identikit tool is designed for large format devices. If you are working with a small screen or with a touch device, it might not appear or work as intended. We are working to produce a range of 'mobile-first' tools in the latter part of 2018.").appendTo(n("#tombioGuiLargeJqueryUiDeviceWarningInnerDiv"));n("<img>").attr("id","tombioGuiLargeJqueryUiDeviceWarningButton").attr("src",t.opts.tombiopath+"/resources/remove.png").css("position","absolute").css("right","10px").css("top","10px").appendTo(n("#tombioGuiLargeJqueryUiDeviceWarningInnerDiv"));n("#tombioGuiLargeJqueryUiDeviceWarningButton").on("click",function(){n("#tombioGuiLargeJqueryUiDeviceWarning").hide()});n("<div>").attr("id","tombioGuiLargeJqueryUiFlashDisplay").css("display","none").appendTo("#tombioGuiLargeJqueryUi");n("<select>").attr("id","tombioGuiLargeJqueryUiVisualisation").appendTo("#tombioGuiLargeJqueryUi");n("<div>").addClass("tombioNoSelect").attr("id","tombioGuiLargeJqueryUiControlsAndTaxa").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","tombioGuiLargeJqueryUiControls").appendTo("#tombioGuiLargeJqueryUiControlsAndTaxa");n("<div>").attr("id","tombioGuiLargeJqueryUiTaxa").appendTo("#tombioGuiLargeJqueryUiControlsAndTaxa");t.gui.main.divVis="#tombioGuiLargeJqueryUiTaxa";t.gui.main.divInput="#tombioGuiLargeJqueryUiControls";n("<div>").attr("id","currentVisInfo").css("display","none").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","kbInfo").css("display","none").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","visInfo").css("display","none").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","tombioCitation").css("display","none").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","mediaFilesCheck").css("display","none").appendTo("#tombioGuiLargeJqueryUi");n("<div>").attr("id","tvkCheck").css("display","none").appendTo("#tombioGuiLargeJqueryUi")};t.gui.main.createUIControls=function(){n("#tombioGuiLargeJqueryUi").css("display","");i();var r=[];r.push(n('<option value="reload" class="html" data-class="reload">Reload<\/option>'));r.push(n('<option value="reloadGuiOnsen" class="html" data-class="reload">Reload with mobile-first interface<\/option>'));r.push(n('<option value="reloadGuiJQuery" class="html" data-class="reload">Reload with large format interface<\/option>'));t.v.includedVisualisations.forEach(function(i){var u=n('<option class="needsclick">').attr("value",i).attr("data-class","vis").addClass("visualisation").text(t.js.jsFiles[i].toolName);r.push(u)});r.push(n('<option id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info"><\/option>'));r.push(n('<option value="kbInfo" class="html" data-class="info">About the Knowledge-base<\/option>'));r.push(n('<option value="visInfo" class="html" data-class="info">About FSC Identikit<\/option>'));r.push(n('<option value="tombioCitation" class="html" data-class="info">Get citation text<\/option>'));t.opts.checkKB&&(r.push(n('<option value="mediaFilesCheck" class="html" data-class="wrench">Check media files<\/option>')),t.d.oCharacters.TVK&&r.push(n('<option value="tvkCheck" class="html" data-class="wrench">Check TVKs<\/option>')));r.forEach(function(n){n.attr("value")==t.v.selectedTool&&n.attr("selected","selected")});n("#tombioGuiLargeJqueryUiVisualisation").append(r);n.widget("custom.iconselectmenu",n.ui.selectmenu,{_renderItem:function(t,i){var r=n("<li>"),u=n("<div>",{text:i.label});return i.disabled&&r.addClass("ui-state-disabled"),n("<span>",{style:i.element.attr("data-style"),"class":"ui-icon "+i.element.attr("data-class")}).appendTo(u),r.append(u).appendTo(t)}});n("#tombioGuiLargeJqueryUiVisualisation").iconselectmenu({change:function(){t.f.visChanged(n("#tombioGuiLargeJqueryUiVisualisation").val())}}).iconselectmenu("menuWidget").addClass("ui-menu-icons customicons");t.opts.hideVisDropdown==!0&&n("#tombioGuiLargeJqueryUiVisualisation-button").hide()};t.gui.main.visShow=function(i){var o=t.v.visualisations[i],r,u;if(i=="tombioCitation"&&n("#tombioCitation").html(t.f.createCitationPage()),i=="mediaFilesCheck"&&n("#mediaFilesCheck").html(t.f.createMediaCheckPage()),i=="tvkCheck"&&n("#tvkCheck").html(t.f.createTvkCheckPage()),i=="kbInfo"&&n("#kbInfo").html().length==0&&t.f.setKbInfo(n("#kbInfo")),i=="visInfo"&&n("#visInfo").html().length==0&&t.f.setVisInfo(n("#visInfo")),i=="currentVisInfo"&&(n("#currentVisInfo").html(""),t.f.setSelectedToolInfo(n("#currentVisInfo"))),console.log("selectedToolName",i),i!=t.v.currentTool&&(t.v.currentTool&&(t.v.visualisations[t.v.currentTool]?t.v.visualisations[t.v.currentTool].hide():n("#"+t.v.currentTool).hide()),t.v.visualisations[i]?t.v.visualisations[i].show():n("#"+i).show()),o?n("#tombioGuiLargeJqueryUiControlsAndTaxa").show():n("#tombioGuiLargeJqueryUiControlsAndTaxa").hide(),t.f.refreshVisualisation(),t.v.currentTool=i,Object.keys(t.v.visualisations).indexOf(i)>-1&&(t.v.lastVis=i,n("#optCurrentVisInfo").text("Using the "+t.v.visualisations[t.v.lastVis].metadata.title),n("#tombioGuiLargeJqueryUiVisualisation").iconselectmenu("refresh")),t.gui.main.contextMenu.contextChanged(i),!t.v.initialised&&t.v.visualisations[i]){var f={},s=decodeURI(window.location.search.substring(1)).replace(/\+/g," "),e=s.split("&");for(r=0;r<e.length;r++)u=e[r].split("="),f[u[0]]=u[1];t.v.visualisations[i].urlParams(f);t.v.initialised=!0}};t.gui.main.dialog=function(t,i){n("#tombioGuiDialog").remove();n("<div>").attr("id","tombioGuiDialog").css("display","none").appendTo(n("#tombioGuiLargeJqueryUi"));n("#tombioGuiDialog").dialog({modal:!1,width:550,height:450,resizable:!0,draggable:!0,autoOpen:!1,show:{effect:"highlight",duration:500},hide:{effect:"fade",duration:250}});n("#tombioGuiDialog").dialog("option","title",t);n("#tombioGuiDialog").html(i);n("#tombioGuiDialog").dialog("open")};t.gui.main.createCharacterTooltips=function(t){n(t).tooltip({track:!0,items:"span",content:function(){return r(n(this).attr("character"))}})};t.gui.main.createTaxonToolTips=function(i,r){n(i).tooltip({track:!0,items:"text",content:function(){if(r)return t.f.getTaxonTipImage(this.textContent,this)},open:function(t,i){var r=n(t.target);i.tooltip.click(function(){r.tooltip("close")})}})};t.gui.main.tooltip=function(t){n(t).tooltip()};t.gui.main.showFullDetails=function(i,r,u,f){function w(){var n=o.find(".tombio-galleria-pane").first();n.data("galleria")&&(n.data("galleria").setOptions("height",o.height()-a),n.data("galleria").resize())}function k(i,r){var f=n("<div>").appendTo(r),e=t.f.getTaxonHtmlFiles(i),s,u,h,o;e.length==0?(s=n("<div>").css("margin","10px").appendTo(f),s.text("No text information files (HTML) are specified in the knowledge-base for this taxon.")):(u=n("<div>"),e.length>1&&(h=n('<div style="margin-bottom: 20px">').appendTo(f),o=n("<select id='tombioFileSelect'><\/select>").appendTo(h),e.forEach(function(t,i){var r=n("<option/>").text(t.Caption).attr("value",i);o.append(r)}),o.selectmenu({change:function(n,r){t.f.addTaxonHtmlToContainer(i,u,r.item.value)}})),u.appendTo(f),t.f.addTaxonHtmlToContainer(i,u,0))}var d=this,a,e,s,h,c,v,l,o,y,b,p;u=typeof u!="undefined"?u:0;f=typeof f!="undefined"?f:0;r=typeof r!="undefined"?r:1;e=n("<div>").addClass("tombioFullDetailsTabs");e.css("border","none");s=n("<ul>").appendTo(e);s.append("<li><a href='#tabs-1'>Knowledge-base<\/a><\/li>");s.append("<li><a href='#tabs-2'>Images<\/a><\/li>");t.d.oCharacters.TVK&&s.append("<li><a href='#tabs-4'>NBN map<\/a><\/li>");s.append("<li><a href='#tabs-3'>Details<\/a><\/li>");h=n("<div>").attr("id","tabs-1").appendTo(e);c=n("<div>").attr("id","tabs-2").appendTo(e);t.d.oCharacters.TVK&&(v=n("<div>").attr("id","tabs-4").appendTo(e));l=n("<div>").attr("id","tabs-3").appendTo(e);o=n("<div>").append(e);o.attr("title",i);o.dialog({closeText:"",height:550,width:600,modal:!0,resizeStop:function(){e.tabs("refresh");w()}});e.tabs({heightStyle:"fill",active:r,create:function(){a=o.height()-h.height()},activate:function(n,t){e.tabs("refresh");t.newTab.index()==1&&w()}});l.css("overflow","hidden");y=t.f.getTaxonCharacterValues(t.d.oTaxa[i]);h.append(y);b=t.f.addTaxonImagesToContainer({taxon:i,container:c,height:c.height()});t.d.oCharacters.TVK&&t.d.oTaxa[i].TVK&&(p=n("<div>").css("position","relative").appendTo(v),t.f.addNBNMapToContainer(t.d.oTaxa[i].TVK,p));k(i,l)};t.gui.main.showCharacterScore=function(i,r){var f=t.f.getCharacterScoreDetails(i,r),u=n("<div>");u.dialog({height:300,width:600,modal:!0,title:"Character score details"});u.html(f);u.dialog("open")}})(jQuery,this.tombiovis);