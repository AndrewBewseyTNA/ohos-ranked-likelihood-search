(function(n,t){"use strict";t.stateValue={v:null};t.stateValue.init=function(n,i){var u=t.oCharacters[i],f,e,r;this.valueType=u.ValueType;this.status=u.Status;this.character=u.Character;f=this;e=this.v.trim().split("|");e.forEach(function(n){var u,i,t;n=n.trim();n.endsWith("(m)")||n.endsWith("(f)")?(u=n.substr(0,n.length-4).trim(),i=n.substr(n.length-4,4)):(u=n,i="");t=f.translateStateValue(f.character,u);i!=""&&(t=t+" "+i);r=r?r+" | "+t:t;r.length>0&&r.substr(0,1)=="#"&&(r="");r.length=="?"&&(r="")});this.kbValue=r};t.stateValue.translateStateValue=function(n,i){function r(n,i){var r=t.values.filter(function(t){return t.Character==n&&t.CharacterState.trim()==i?!0:!1}),u;return u=r[0]&&r[0].CharacterStateTranslation&&r[0].CharacterStateTranslation!=""?r[0].CharacterStateTranslation:i,u.replace(/ +(?= )/g,"")}if(/^\[[^-]+-[^-]+\]$/.test(i)){var f=i.substr(1,i.length-2),u=f.split("-");return"["+r(n,u[0])+"-"+r(n,u[1])+"]"}return r(n,i)};t.stateValue.getStates=function(n){var i,u,r,t;for(n||(n=""),i=[],u=this.kbValue.split("|"),r=0;r<u.length;r++)t=u[r],t=t.trim(),t!="n/a"&&t!="?"&&t!=""&&(n!="male"||t.endsWith("(f)")?n!="female"||t.endsWith("(m)")?n==""&&i.push(t.replace("(m)","").replace("(f)","").trim()):i.push(t.replace("(f)","").trim()):i.push(t.replace("(m)","").trim()));return i};t.stateValue.getRange=function(){var n={},i,t;return n.hasValue=String(this.kbValue)==""?!1:!0,String(this.kbValue).indexOf("[")==0?(i=this.kbValue.substr(1,this.kbValue.length-2),t=i.split("-"),n.min=Number(t[0]),n.max=Number(t[1]),n.mid=n.min+(n.max-n.min)/2):(n.min=Number(this.kbValue),n.max=Number(this.kbValue),n.mid=Number(this.kbValue)),n};t.stateValue.getOrdinalRanges=function(n){var i=this,r=[];return(this.valueType=="ordinal"||this.valueType=="ordinalCircular")&&this.getStates(n).forEach(function(n){var f=[];if(n.indexOf("[")==0){var s=n.substr(1,n.length-2),e=s.split("-"),h=e[0],o=e[1],u=!1;t.oCharacters[i.character].CharacterStateValues.forEach(function(n){n==h&&(u=!0);u&&f.push(n);n==o&&(u=!1)});u&&t.oCharacters[i.character].CharacterStateValues.forEach(function(n){u&&f.push(n);n==o&&(u=!1)})}else f.push(n);r.push(f)}),r};t.stateValue.toHtml1=function(){var t,n;return this.kbValue=="n/a"?"<i>not applicable<\/i>":this.kbValue==""||this.kbValue=="?"?"<i>no value specified<\/i>":this.valueType=="text"||this.valueType=="ordinal"||this.valueType=="ordinalCircular"?(n=this.kbValue.replace(/([^|]+)/g,"<b>$1<\/b>"),n=n.replace(/(\(m\)\s*<\/b>)/g,"<\/b> (male)"),n=n.replace(/(\(f\)\s*<\/b>)/g,"<\/b> (female)"),n=n.replace(/<b>\s*\[/g,"<b>"),n=n.replace(/\]\s*<\/b>/g,"<\/b>"),n=n.replace(/\s*\|\s*/g," or "),this.status=="display"&&(n=n.replace(/<b>/g,"").replace(/<\/b>/g,"")),n):this.valueType=="numeric"?(t=this.getRange(),n=t.hasValue==!1?"<b>no value in knowledge-base<\/b>":t.min==t.max?"<b>"+t.min+"<\/b>":"<b>"+t.min+"-"+t.max+"<\/b> (range)",this.status=="display"&&(n=n.replace(/<b>/g,"").replace(/<\/b>/g,"")),n):this.kbValue};t.stateValue.toHtml2=function(){var i,u,r,n,t;if(this.kbValue=="n/a")return"<li><i>not applicable<\/i><\/li>";if(this.valueType=="text"||this.valueType=="ordinal"||this.valueType=="ordinalCircular"){for(i="",u=this.kbValue.split("|"),r=0;r<u.length;r++)n=u[r].trim(),n=/\(m\)$/.test(n)?"<b>"+n.replace(/\(m\)$/,"<\/b> (male)"):/\(f\)$/.test(n)?"<b>"+n.replace(/\(f\)$/,"<\/b> (female)"):"<b>"+n.trim()+"<\/b>",n=n.replace(/<b>\s*\[/g,"<b>"),n=n.replace(/\]\s*<\/b>/g,"<\/b>"),r<u.length-1&&(n+=" or"),i+="<li>",i+=n,i+="<\/li>";return i}return this.valueType=="numeric"?(t=this.getRange(),t.hasValue==!1?"<li><i>no value in knowledge-base<\/i><\/li>":t.min==t.max?"<li><b>"+t.min+"<\/b><\/li>":"<li><b>"+t.min+" - "+t.max+"<\/b> (range)<\/li>"):this.kbValue};t.stateValue.toString=function(){return this.kbValue}})(jQuery,this.tombiovis),function(n,t){"use strict";function r(){var t=n("#tombioVisualisation").val();return t in i.visualisations?i.visualisations[t]:null}function o(){n("#tombiod3vis").css("position","relative");n("<div>").attr("id","tombioDebugText").css("display","none").appendTo("#tombiod3vis");n("<div>").attr("id","tombioKBReport").css("display","none").appendTo("#tombiod3vis");n("<button>").attr("id","tombioReload").css("display","none").appendTo("#tombioKBReport");n("<button>").attr("id","tombioContinue").css("display","none").appendTo("#tombioKBReport");n("<div>").attr("id","tombioMain").appendTo("#tombiod3vis");n("<select>").attr("id","tombioVisualisation").appendTo("#tombioMain");n("<div>").addClass("tombioNoSelect").attr("id","tombioControlsAndTaxa").appendTo("#tombioMain");n("<div>").attr("id","tombioControls").css("display","none").appendTo("#tombioControlsAndTaxa");n("<span>").attr("id","tombioTaxa").appendTo("#tombioControlsAndTaxa");n("<div>").attr("id","currentVisInfo").css("display","none").appendTo("#tombioMain");n("<div>").attr("id","kbInfo").css("display","none").appendTo("#tombioMain");n("<div>").attr("id","visInfo").css("display","none").appendTo("#tombioMain");n("<div>").attr("id","tombioCitation").css("display","none").appendTo("#tombioMain");s()}function s(){n("#tombiod3vis").css("border","5px solid red").attr("title","tombiod3vis");n("#tombioMain").css("border","5px solid blue").attr("title","tombioMain");n("#tombioControlsAndTaxa").css("border","5px solid green").attr("title","tombioControlsAndTaxa");n("#tombioControls").css("border","5px solid yellow").attr("title","tombioControls");n("#tombioTaxa").css("border","5px solid cyan").attr("title","tombioTaxa")}function h(){t.values.forEach(function(n){var i=t.oCharacters[n.Character],r;i&&(r=n.CharacterStateTranslation&&n.CharacterStateTranslation!=""?n.CharacterStateTranslation:n.CharacterState,i.CharacterStates.push({CharacterState:r,StateHelp:n.StateHelp}),i.CharacterStateValues.push(r))});t.characters.forEach(function(n){(n.Group=="Taxonomy"||n.Status=="key"&&n.ValueType=="text")&&t.taxa.forEach(function(t){var i=t[n.Character].getStates("");i.forEach(function(t){t!=""&&n.CharacterStateValues.indexOf(t)==-1&&(n.CharacterStates.push({CharacterState:t,StateHelp:""}),n.CharacterStateValues.push(t))})})})}function c(){t.taxa.forEach(function(n){n.matchscore={};t.characters.forEach(function(t){t.Status=="key"&&(n.matchscore[t.Character]={label:t.Label,scorena:0,scorefor:0,scoreagainst:0,scoreoverall:0})})})}function l(){var r,u,o,s;p();i.visualisations={};r=[];r.push(n('<option value="reload" class="html" data-class="reload">Reload<\/option>'));t.includedTools.forEach(function(i){var u=n('<option class="needsclick">').attr("value",i).attr("data-class","vis").addClass("visualisation").text(t.jsFiles[i].toolName);r.push(u)});r.push(n('<option id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info"><\/option>'));r.push(n('<option value="kbInfo" class="html" data-class="info">About the Knowledge-base<\/option>'));r.push(n('<option value="visInfo" class="html" data-class="info">About Tom.bio ID Visualisations<\/option>'));r.push(n('<option value="tombioCitation" class="html" data-class="info">Get citation text<\/option>'));o=b("selectedTool");o?u=o:t.opts.selectedTool?u=t.opts.selectedTool:t.kbconfig.selectedTool&&(u=t.kbconfig.selectedTool);s=!1;r.forEach(function(n){n.attr("value")==u&&(n.attr("selected","selected"),s=!0)});s||r[1].attr("selected","selected");n("#tombioVisualisation").append(r);n.widget("custom.iconselectmenu",n.ui.selectmenu,{_renderItem:function(t,i){var r=n("<li>"),u=n("<div>",{text:i.label});return i.disabled&&r.addClass("ui-state-disabled"),n("<span>",{style:i.element.attr("data-style"),"class":"ui-icon "+i.element.attr("data-class")}).appendTo(u),r.append(u).appendTo(t)}});n("#tombioVisualisation").iconselectmenu({change:function(){e()}}).iconselectmenu("menuWidget").addClass("ui-menu-icons customicons");t.opts.hideVisDropdown==!0&&n("#tombioVisualisation-button").hide();n("#tombioInfotoggle").button({icons:{primary:null,secondary:"ui-icon-info20"}}).click(function(){n("#tombioInfoDialog").dialog("open")});n("#tombioOptions").button({icons:{primary:null,secondary:"ui-icon-options"},disabled:!1}).click(function(){});i.visWithInput=[];for(name in i.visualisations)i.visualisations[name].charStateInput&&i.visWithInput.push(name);i.contextMenu.addItem("Toggle key input visibility",function(){f()},i.visWithInput)}function a(i){var u=!0,r="";i.forEach(function(n){n?r+=n:u=!1});u&&(r=r.replace(/##tombiopath##/g,t.opts.tombiopath).replace(/##tombiokbpath##/g,t.opts.tombiokbpath),n("#currentVisInfo").html(r))}function v(){var r=n("<div>"),u,f;r.append(n("<h3>").text("Citation for general framework (core software)"));u="This is the reference you can use for the main Tom.bio Framework - in other words the core software.";u+=" The core version number is updated whenever there is a new major release of the core software.";r.append(n("<p>").html(u));r.append(n("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='tbCitationCore' id='tbCitationCore'>"));r.append(n("<span>").text("Copy citation"));r.append(n("<b>").html(t.getCitation(t.metadata,"Software")));r.append(n("<h3>").text("Citation for last selected visualisation tool"));u="This is the reference you can use for the last selected visualisation tool.";u+=" The tool version number is updated whenever there is a new release of the tool.";u+=" If you cite a tool, there's no need to cite the core software separately since it is implicit.";r.append(n("<p>").html(u));r.append(n("<input style='position: relative; top: 0.2em' type='checkbox' name='tbCitationVis' id='tbCitationVis'>"));r.append(n("<span>").text("Copy citation"));r.append(n("<b>").html(t.getCitation(i.lastVisualisation.metadata,"Software",t.metadata.title)));r.append(n("<h3>").text("Citation for knowledge-base"));u="This is the reference you can use for the knowledge-base currently driving the software.";u+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.";r.append(n("<p>").html(u));r.append(n("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='tbCitationKb' id='tbCitationKb'>"));r.append(n("<span>").text("Copy citation"));r.append(n("<b>").html(t.getCitation(t.kbmetadata,"Knowledge-base",t.metadata.title)));f=n("<button>Copy citations<\/button>").button();f.on("click",function(){n("#tbSelectedCitations").html("");document.getElementById("tbCitationCore").checked&&n("#tbSelectedCitations").append(t.getCitation(t.metadata,"Software"));document.getElementById("tbCitationVis").checked&&n("#tbSelectedCitations").append(t.getCitation(i.lastVisualisation.metadata,"Software",t.metadata.title));document.getElementById("tbCitationKb").checked&&n("#tbSelectedCitations").append(t.getCitation(t.kbmetadata,"Knowledge-base",t.metadata.title));y(document.getElementById("tbSelectedCitations"));n("#tbCitationInstructions").show()});return r.append(n("<p>").append(f).append("&nbsp;The selected citations will appear together below - just copy and paste")),r.append(n("<div id='tbSelectedCitations'>")),r.append(n("<p id='tbCitationInstructions' style='display: none'>").text("You can now copy and paste the selected citation text.")),r}function y(n,t){t=t||window;var r=t.document,u,i;t.getSelection&&r.createRange?(u=t.getSelection(),i=r.createRange(),i.selectNodeContents(n),u.removeAllRanges(),u.addRange(i)):r.body.createTextRange&&(i=r.body.createTextRange(),i.moveToElementText(n),i.select())}function e(){t.visChanged(n("#tombioVisualisation").val())}function u(r){var s=i.visualisations[r],l,h,y,e,p,u,o,c;if(r=="tombioCitation"&&n("#tombioCitation").html(v()),r=="kbInfo"&&n("#kbInfo").html().length==0&&(l=n("<h2>").text(t.kbmetadata.title),n("#kbInfo").html(l),n.get(t.opts.tombiokbpath+"info.html",function(i){n("#kbInfo").append(i.replace(/##tombiopath##/g,t.opts.tombiopath).replace(/##tombiokbpath##/g,t.opts.tombiokbpath))}).always(function(){var e=n("<h3>").attr("id","tombioKbCitation").text("Citation"),u,f,r,i;n("#kbInfo").append(e);n("#kbInfo").append(t.getCitation(t.kbmetadata,"Knowledge-base",t.metadata.title));u=n("<h3>").attr("id","tombioKbRevisionHistory").text("Knowledge-base revision history");n("#kbInfo").append(u);f=n("<p>").html("<b>Current version: "+t.kbmetadata.version+"<\/b>");n("#kbInfo").append(f);r=n("<table>");i=n("<tr>").css("background-color","black").css("color","white");i.append(n("<td>").text("Date").css("padding","3px"));i.append(n("<td>").text("Version").css("padding","3px"));i.append(n("<td>").text("Notes").css("padding","3px"));r.append(i);t.kbreleaseHistory.forEach(function(t,u){i=n("<tr>");u%2==0?i.css("background-color","rgb(200,200,200)"):i.css("background-color","rgb(230,230,230)");var f=new Date(t.Date);i.append(n("<td>").css("padding","3px").text(f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()));i.append(n("<td>").css("padding","3px").text(t.Value));i.append(n("<td>").css("padding","3px").text(t.Notes));r.append(i)});n("#kbInfo").append(r)})),r=="visInfo"&&n("#visInfo").html().length==0&&n.get(t.opts.tombiopath+"visInfo.html",function(i){n("#visInfo").html(i.replace(/##tombiopath##/g,t.opts.tombiopath).replace(/##tombiokbpath##/g,t.opts.tombiokbpath))}),r=="currentVisInfo"&&(h=new Array(i.lastVisualisation.helpFiles.length),i.lastVisualisation.helpFiles.forEach(function(t,i){n.get(t,function(n){h[i]=n;a(h)})})),r!=i.currentTool&&(i.currentTool&&(y=n("#"+i.currentTool),y.hide(),e=i.visualisations[i.currentTool],e&&e.inputControl&&e.inputControl.$div.hide()),p=n("#"+r),p.show(),u=i.visualisations[r],u&&u.inputControl&&(u.inputControl.$div.show(),u.inputControl.initFromCharacterState())),s&&s.charStateInput?f(!0):f(!1),s?n("#tombioControlsAndTaxa").show():n("#tombioControlsAndTaxa").hide(),t.refreshVisualisation(),i.currentTool=r,Object.keys(i.visualisations).indexOf(r)>-1&&(i.lastVisualisation=i.visualisations[r],n("#optCurrentVisInfo").text("Using the "+i.lastVisualisation.metadata.title),n("#tombioVisualisation").iconselectmenu("refresh")),i.contextMenu.contextChanged(r),i.initialising&&i.visualisations[r]){var w={},k=decodeURI(window.location.search.substring(1)).replace(/\+/g," "),b=k.split("&");for(o=0;o<b.length;o++)c=b[o].split("="),w[c[0]]=c[1];i.visualisations[r].urlParams(w);i.initialising=!1}}function f(r){var u;u=r!=undefined?r:!n("#tombioControls").is(":visible");u?n("#tombioControls").show(0,t.resizeControlsAndTaxa):(i.controlsWidth=n("#tombioControls").width(),n("#tombioControls").hide(0,t.resizeControlsAndTaxa))}function p(){i.contextMenu={};i.contextMenu.items={};i.contextMenu.contexts={};i.contextMenu.menu=n("<ul>").css("white-space","nowrap").appendTo("#tombioMain").addClass("contextMenu").css("position","absolute").css("display","none").css("z-index",999999);i.contextMenu.menu.menu();n("#tombioMain").on("contextmenu",function(t){i.contextMenu.menu.position({});var r=n(this).parent().offset(),u=t.pageX-r.left,f=t.pageY-r.top;return i.contextMenu.menu.css({left:u,top:f}),console.log("showing context"),i.contextMenu.menu.show(),!1});n("#tombioMain").on("click",function(){i.contextMenu.menu.hide()});i.contextMenu.addItem=function(t,r,u,f){if(f&&t in i.contextMenu.items&&(i.contextMenu.items[t].remove(),delete i.contextMenu.items[t],delete i.contextMenu.contexts[t]),!(t in i.contextMenu.items)){var e=n("<li>").append(n("<div>").text(t).click(r));i.contextMenu.menu.append(e);i.contextMenu.menu.menu("refresh");i.contextMenu.items[t]=e;i.contextMenu.contexts[t]=u}};i.contextMenu.removeItem=function(n){n in i.contextMenu.items&&(i.contextMenu.items[n].remove(),delete i.contextMenu.items[n],delete i.contextMenu.contexts[n])};i.contextMenu.contextChanged=function(n){for(var t in i.contextMenu.items)i.contextMenu.contexts[t].indexOf(n)>-1?i.contextMenu.items[t].show():i.contextMenu.items[t].hide()}}function w(){var i=n("#Sex").val();t.taxa.forEach(function(n){n.scorefor=0;n.scoreagainst=0;n.scoreoverall=0;n.charcount=0;t.characters.filter(function(n){return n.Status=="key"}).forEach(function(r){var s,u,f,e,o=r.Character,l,a,v,h,c;if(r.stateSet){if(r.ValueType=="numeric")if(n[o]=="")s=0,e=0,u=0,f=0;else if(n[o]=="n/a")s=1,e=1,u=0,f=0;else{var y=Number(r.userInput),p=n[o].getRange(),l=Number(r.Strictness),w=r.maxVal-r.minVal,h=t.score.numberVsRange(y,p,w,l);u=h[0];f=h[1];s=1;e=0}else if(r.ValueType=="ordinal"||r.ValueType=="ordinalCircular"||r.ValueType=="text")if(l=Number(r.Strictness),n[o]=="n/a")s=1,e=1,u=0,f=0;else{if(a=r.userInput.map(function(n){return r.CharacterStateValues[n]}),r.ValueType=="ordinal"||r.ValueType=="ordinalCircular")var v=n[o].getOrdinalRanges(i),b=r.CharacterStateValues,k=r.ValueType=="ordinalCircular",h=t.score.ordinal2(a,v,b,l,k);else v=n[o].getStates(i),h=t.score.character(a,v);u=h[0];f=h[1];s=1;e=0}}else s=0,e=0,u=0,f=0;n.charcount+=s;n.matchscore[o].scorena=e;n.matchscore[o].scorefor=u;n.matchscore[o].scoreagainst=f;n.matchscore[o].scoreoverall=u-f-e;c=Number(r.Weight)/10;n.scorefor+=u*c;n.scoreagainst+=f*c;n.scoreagainst+=e*c;n.scoreoverall+=(u-f-e)*c})})}function b(n){for(var i,u=window.location.search.substring(1),r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1];return null}var i={delay:250,duration:1e3,infowidth:750,infoheight:700,visInfoDialogWidth:650,visInfoDialogHeight:350,scriptsLoaded:!1,htmlLoaded:!1,initialising:!0};t.loadComplete=function(i){(o(),n("#tombiod3-header").text(t.kbmetadata.title),n("#tombiod3-footer").html(t.getCitation(t.kbmetadata,"Knowledge-base",t.metadata.title)),i||t.checkKnowledgeBase())&&(t.oCharacters={},t.characters.forEach(function(n){t.oCharacters[n.Character]=n}),t.oTaxa={},t.taxa.forEach(function(n){t.oTaxa[n.Taxon]=n;for(var i in n)n.hasOwnProperty(i)&&(n[i]=Object.create(t.stateValue,{v:{writable:!0,value:n[i]}}),n[i].init(n,i))}),t.characters.forEach(function(n){n.CharacterStates=[];n.CharacterStateValues=[];n.stateSet=!1;n.userInput=null;n.minVal=null;n.maxVal=null;n.ValueType=="numeric"&&t.taxa.forEach(function(t){var i=t[n.Character].getRange().min,r=t[n.Character].getRange().max;(!n.minVal||i<n.minVal)&&(n.minVal=i);(!n.maxVal||r>n.maxVal)&&(n.maxVal=r)})}),t.charactersGrouped=!1,t.characters.forEach(function(n){n.Status=="key"&&n.Group.toLowerCase()!="none"&&(t.charactersGrouped=!0)}),t.media.forEach(function(n){(n.Type=="image-local"||n.Type=="html-local")&&(n.URI=t.opts.tombiokbpath+n.URI)}),h(),n("#tombioMain").css("display",""),l(),n("#downloadspin").remove(),c(),t.resizeControlsAndTaxa(),e(),t.loadCallback&&t.loadCallback())};t.initControlsFromParams=function(n){for(name in n)if(name.startsWith("c-")){var u=name.split("-")[1],i=t.characters[u];i.userInput=i.ControlType==="spin"?n[name]:n[name].split(",");i.stateSet=!0}r().inputControl.initKeyInputFromParams(n);t.refreshVisualisation()};t.setParamsFromControls=function(){var n=[];return t.characters.forEach(function(t,i){if(t.userInput){var r="c-"+i;t.ControlType==="spin"?n.push(r+"="+t.userInput):n.push(r+"="+t.userInput.join(","))}}),r().inputControl.setParamsFromKeyInput(n)};t.getCitation=function(t,i,r){var f=n("<div class='tombioCitation'>"),u,e=new Date;return u=t.authors+" ",u+="("+t.year+") ",u+="<i>"+t.title+"<\/i>",u+=" (Version "+t.version+") ["+i+"]",r&&(u+=" (for "+r+")"),u+=". ",t.publisher&&(u+=t.publisher+". "),t.location&&(u+=t.location+". "),u+="Accessed "+e.toDateString()+". ",u+=window.location.href.split("?")[0],f.append(n("<div>").html(u)),f};t.visChanged=function(r,f){if(r=="reload"){n.ajax({url:window.location.href,headers:{Pragma:"no-cache",Expires:-1,"Cache-Control":"no-cache"}}).done(function(){window.location.reload(!0)});return}if(r=="visInfo"||r=="kbInfo"){u(r);return}if(r=="tombioCitation"||r=="currentVisInfo"){var e;e=f?f:i.lastVisualisation?i.lastVisualisation.visName:t.opts.lastVisualisation?t.opts.lastVisualisation:"vis1";t.showDownloadSpinner();t.jsFiles[e]&&t.jsFiles[e].markLoadReady();t.loadScripts(function(){if(t.hideDownloadSpinner(),!i.visualisations[e]){var n=t[e];n.initP(e,"#tombioTaxa",i.contextMenu,t);i.visualisations[e]=n}i.lastVisualisation=i.visualisations[e];u(r)});return}n("#tombioVisualisation").val()!=r&&n("#tombioVisualisation").val(r);t.showDownloadSpinner();t.jsFiles[r]&&t.jsFiles[r].markLoadReady();t.loadScripts(function(){if(t.hideDownloadSpinner(),!i.visualisations[r]){var n=t[r];n.initP(r,"#tombioTaxa",i.contextMenu,t);i.visualisations[r]=n}console.log("Starting",r);u(r)})};t.debugText=function(t,i){var r=n("#tombioDebugText"),u;t===null?(r.html(""),r.hide()):(r.show(),u=Math.floor(Math.random()*1e3),t=u+" "+t,i?r.html(r.html()+"<br/>"+t):r.html(t))};t.refreshVisualisation=function(){w();r()&&r().refresh();t.resizeControlsAndTaxa()};t.resizeControlsAndTaxa=function(){if(n("#tombioControls").is(":visible")){var t=n("#tombioControls").width();n("#tombioControlsAndTaxa").css("min-width",t+n("#tombioTaxa").width()+50)}else n("#tombioControlsAndTaxa").css("min-width","0px")};t.characterHasHelp=function(n){var u=t.oCharacters[n].Help,i,r;return u.length>0?!0:(i=t.values.filter(function(t){if(t.Character==n&&t.StateHelp)return!0}),i.length>0)?!0:(r=t.media.filter(function(t){if(t.Type=="image-local"&&t.Character==n)return!0}),r.length>0)?!0:!1}}(jQuery,this.tombiovis);