(function(n,t){"use strict";function h(){var n=[],r;n.push("selectedTool="+i);n.push("taxon="+f);var e=document.getElementById("tbVis4Images").checked,s=document.getElementById("tbVis4Kb").checked,h=document.getElementById("tbVis4Text").checked;e&&s&&h||(r=[],e&&r.push("image"),h&&r.push("text"),s&&r.push("kb"),n.push("opts="+r.join("-")));n=u.setParamsFromState(n);t.d.oTaxa[f].visState[i].indexselectedImg&&n.push("imgi="+t.d.oTaxa[f].visState[i].indexselectedImg);t.d.oTaxa[f].visState[i].indexselectedText&&n.push("txti="+t.d.oTaxa[f].visState[i].indexselectedText);o.createViewURL(n)}function c(n){f=n.selected;s(f)}function s(u){var l,o,w,e,b,h,k,c,y,p;if(r.html(null),u){t.opts.toolconfig.vis4&&t.opts.toolconfig.vis4.subTitleChar&&(w=t.opts.toolconfig.vis4.subTitleChar,l=t.d.oTaxa[u][w].kbValue);o=l?u+" ("+l+")":u+" ";o=o+"<span id='vis4TaxonHeaderPadding'>x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x<\/span>";n("<div id='vis4TaxonHeader'>").html(o).appendTo(r);var a=document.getElementById("tbVis4Images").checked,v=document.getElementById("tbVis4NbnMap")&&document.getElementById("tbVis4NbnMap").checked,d=document.getElementById("tbVis4Kb").checked,f=document.getElementById("tbVis4Text").checked,s=t.f.getTaxonHtmlFiles(u);f=f&&s.length>0;a=a&&t.f.getTaxonImages(u).length>0;v=v&&t.d.oTaxa[u].TVK;a&&(e=n('<div style="position: relative">').appendTo(r),f?e.attr("class","vis4ImageWithText"):e.attr("class","vis4ImageNoText"),b=t.d.oTaxa[u].visState[i].indexselectedImg?t.d.oTaxa[u].visState[i].indexselectedImg:0,t.f.addTaxonImagesToContainer({taxon:u,container:e,indexSelected:b,height:f?400:600,fImageSelect:function(n){t.d.oTaxa[u].visState[i].indexselectedImg=n}}));v&&(h=n('<div style="position: relative">').appendTo(r),f?h.attr("class","vis4ImageWithText"):h.attr("class","vis4ImageNoText"),t.f.addNBNMapToContainer(t.d.oTaxa[u].TVK,h));f&&(s.length>1&&(k=n('<div style="margin-bottom: 20px; display: inline">').appendTo(r),c=n("<select id='vis4html'><\/select>").appendTo(k),s.forEach(function(t,i){var r=n("<option/>").text(t.Caption).attr("value",i);c.append(r)}),c.selectmenu({change:function(n,r){t.f.addTaxonHtmlToContainer(u,y,r.item.value);t.d.oTaxa[u].visState[i].indexselectedText=r.item.value}}).selectmenu("menuWidget")),y=n('<div class="htmlFile">').appendTo(r),p=t.d.oTaxa[u].visState[i].indexselectedText?t.d.oTaxa[u].visState[i].indexselectedText:0,t.f.addTaxonHtmlToContainer(u,y,p),s.length>1&&c.val(p).selectmenu("refresh"));d&&(r.append(n("<h2>").css("clear","both").text("Knowledge-base values")),r.append(t.f.getTaxonCharacterValues(t.d.oTaxa[u])));e&&n(window).resize(function(){var n=e.find(".baseimage");n.trigger("change")})}}var i="vis4",e=t.v.visualisations[i]=Object.create(t.v[t.opts.toolconfig[i].prototype]),o,u,r,f;e.initialise=function(){function e(i,r,u){if(i!="tbVis4NbnMap"||t.d.oCharacters.TVK){var e=n('<div style="display: inline-block; vertical-align:top; margin-left: 20px">').appendTo(u);e.append(n("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='"+i+"' id='"+i+"'>"));e.append(n("<span>").text(r));e.change(function(){s(f,!0)})}}var i;o=this;this.metadata.title="Full taxon details";this.metadata.authors="Burkmar, R.";this.metadata.year="2016";this.metadata.publisher="Field Studies Council";this.metadata.location="Shrewsbury, England";this.metadata.contact="richardb@field-studies-council.org";this.metadata.version="1.1";this.helpFiles=[t.opts.tombiopath+"vis4/vis4Help.html",t.opts.tombiopath+"common/full-details.html",t.opts.tombiopath+"common/taxon-select-help.html"];this.contextMenu.addItem("Get URL for full details view",function(){h()},[this.visName]);i=n("<div/>").css("display","block").css("overflow","hidden");n(this.cssSel).append(i);u=Object.create(t.gui.taxonSelect);u.init(t.gui.main.divInput,!1,c);e("tbVis4Images","Images",i);e("tbVis4NbnMap","NBN Map",i);e("tbVis4Kb","Knowledge-base",i);e("tbVis4Text","Show text",i);r=n("<div>").css("margin","10px");i.append(r);this.taxonSelect=u};e.refresh=function(){n("#vis4taxon").selectmenu("menuWidget").css("height",200)};e.urlParams=function(r){var e,f;r.opts&&(e=r.opts.split("-"),n("#tbVis4Text").prop("checked",e.indexOf("text")>-1),n("#tbVis4Images").prop("checked",e.indexOf("image")>-1),n("#tbVis4Kb").prop("checked",e.indexOf("kb")>-1));f=r.taxon?r.taxon.replace(/%20/g," "):"";r.imgi&&(t.d.oTaxa[f].visState[i].indexselectedImg=r.imgi);r.txti&&(t.d.oTaxa[f].visState[i].indexselectedText=r.txti);f&&u.taxonClick(f);u.initStateFromParams(r)};e.show=function(){console.log("Show vis4");n("#vis4").show();u.$div.show()};e.hide=function(){n("#vis4").hide();u.$div.hide()}})(jQuery,this.tombiovis);