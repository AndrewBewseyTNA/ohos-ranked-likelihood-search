(function(n,t){"use strict";function l(n){h=n.selected;c(h)}function c(i){var f,v,l,o;if(r.html(null),i){n("<div id='vis4TaxonHeader'>").text(i).appendTo(r);var a=document.getElementById("tbVis4Images").checked,y=document.getElementById("tbVis4Kb").checked,h=document.getElementById("tbVis4Text").checked,c=u.getTaxonHtmlFiles(i);h=h&&c.length>0;a=a&&u.getTaxonImages(i).length>0;a&&(f=n('<div style="position: relative">').appendTo(r),h&&f.css("display","inline-block").css("width","50%").css("float","right").css("padding","0 0 10px 10px"),f.html(u.getTaxonImagesDiv(i,f,s,!0,!0)));h&&(c.length>1&&(v=n('<div style="margin-bottom: 20px; display: inline">').appendTo(r),l=n("<select id='vis4html'><\/select>").appendTo(v),c.forEach(function(t,i){var r=n("<option/>").text(t.Caption).attr("value",i);l.append(r)}),l.selectmenu({change:function(n,t){u.showTaxonHtmlInfo(i,o,t.item.value);o.attr("indexselected",t.item.value)}}).selectmenu("menuWidget")),o=n('<div class="htmlFile">').appendTo(r),o.attr("indexselected",e),u.showTaxonHtmlInfo(i,o,e),c.length>1&&l.val(e).selectmenu("refresh"));y&&(r.append(n("<h2>").text("Knowledge-base values")),r.append(u.showTaxonCharacterValues(t.oTaxa[i],!0)));f&&n(window).resize(function(){var n=f.find(".baseimage");n.trigger("change")})}}function a(){var t,e,r,o,s,c,l;console.log("Get the URL");t=[];t.push("selectedTool="+f);t.push("taxon="+h);var a=document.getElementById("tbVis4Images").checked,v=document.getElementById("tbVis4Kb").checked,y=document.getElementById("tbVis4Text").checked;a&&v&&y||(e=[],a&&e.push("image"),y&&e.push("text"),v&&e.push("kb"),t.push("opts="+e.join("-")));r=i.getFilter();r&&(r.startsWith("#")&&(r="-"+r.substr(1)),t.push("filter="+r));i.taxonSort&&(i.taxonSort=="radio-a"?o="a-z":i.taxonSort=="radio-z"&&(o="z-a"),o&&t.push("sort="+o));i.hiddenControlsShown&&t.push("hc=show");s=n("#"+f).find(".tombioImage");s.length>0&&t.push("imgi="+s.attr("indexselected"));c=n("#"+f).find(".htmlFile");c.length>0&&t.push("txti="+c.attr("indexselected"));l=encodeURI(window.location.href.split("?")[0]+"?"+t.join("&"));u.copyTextToClipboard(l);console.log(l)}var f="vis4",o=t[f]={},r,h,i,s=0,e=0,u;o.Obj=function(n,t,i){i.visP.Obj.call(this,f,n,t,i);this.metadata.title="Full taxon details";this.metadata.authors="Burkmar, R.";this.metadata.year="2016";this.metadata.publisher="Field Studies Council";this.metadata.location="Shrewsbury, England";this.metadata.contact="richardb@field-studies-council.org";this.metadata.version="1.0"};o.Obj.prototype=Object.create(t.visP.Obj.prototype);o.Obj.prototype.initialise=function(){function y(t,i,r){var u=n('<div style="display: inline-block; vertical-align:top; margin-left: 20px">').appendTo(r);u.append(n("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='"+t+"' id='"+t+"'>"));u.append(n("<span>").text(i));u.change(function(){var i=n("#"+f).find(".tombioImage"),t;i.length>0&&(s=i.attr("indexselected"));t=n("#"+f).find(".htmlFile");t.length>0&&(e=t.attr("indexselected"));c(h,!0);s=0;e=0})}var v,o;u=this;this.charStateInput=!1;this.helpFiles=[t.tombiopath+"vis4/vis4Help.html",];this.contextMenu.addItem("Get URL for full details view",function(){a()},[this.visName]);v=n("<div>").appendTo(n(this.cssSel));v.css("display","flex");n(this.cssSel).append(v);this.controlsDiv=n("<div/>").css("width",210);v.append(this.controlsDiv);o=n("<div/>").css("flex-grow",1).css("font-size","small");v.append(o);i=Object.create(t.taxonSelect);i.control(this.controlsDiv,!1,l);y("tbVis4Images","Images",o);y("tbVis4Kb","Knowledge-base",o);y("tbVis4Text","Show text",o);r=n("<div>").css("margin","10px");o.append(r)};o.Obj.prototype.refresh=function(){n("#vis4taxon").selectmenu("menuWidget").css("height",200)};o.Obj.prototype.urlParams=function(t){var f=this,r,u;console.log("Vis 4 URL parameters:",t);t.opts&&(r=t.opts.split("-"),n("#tbVis4Text").prop("checked",r.indexOf("text")>-1),n("#tbVis4Images").prop("checked",r.indexOf("image")>-1),n("#tbVis4Kb").prop("checked",r.indexOf("kb")>-1));t.hc&&i.toggleHiddenControls();t.sort&&i.setSort(t.sort);t.imgi&&(s=t.imgi);t.txti&&(e=t.txti);t.taxon&&i.taxonClick(t.taxon.replace(/%20/g," "));t.filter&&(u=t.filter.startsWith("-")?"#"+t.filter.substr(1):t.filter,console.log("setting filter",u),i.setFilter(u));s=0;e=0}})(jQuery,this.tombiovis);