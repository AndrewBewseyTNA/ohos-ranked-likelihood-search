(function(n,t){"use strict";function l(){var t,f,r,o,h,c,l;console.log("Get the URL");t=[];t.push("selectedTool="+e);t.push("taxon="+s);var a=document.getElementById("tbVis4Images").checked,v=document.getElementById("tbVis4Kb").checked,y=document.getElementById("tbVis4Text").checked;a&&v&&y||(f=[],a&&f.push("image"),y&&f.push("text"),v&&f.push("kb"),t.push("opts="+f.join("-")));r=i.getFilter();r&&(r.startsWith("#")&&(r="-"+r.substr(1)),t.push("filter="+r));i.taxonSort&&(i.taxonSort=="radio-a"?o="a-z":i.taxonSort=="radio-z"&&(o="z-a"),o&&t.push("sort="+o));i.hiddenControlsShown&&t.push("hc=show");h=n("#"+e).find(".tombioImage");h.length>0&&t.push("imgi="+h.attr("indexselected"));c=n("#"+e).find(".htmlFile");c.length>0&&t.push("txti="+c.attr("indexselected"));l=encodeURI(window.location.href.split("?")[0]+"?"+t.join("&"));u.copyTextToClipboard(l);console.log(l)}function a(n){s=n.selected;c(s)}function c(i){var a,w,b,s,p,k,l,h;if(r.html(null),i){t.opts.toolconfig&&t.opts.toolconfig.vis4&&t.opts.toolconfig.vis4.subTitleChar&&(b=t.opts.toolconfig.vis4.subTitleChar,a=t.oTaxa[i][b].kbValue);w=a?i+" ("+a+")":i;n("<div id='vis4TaxonHeader'>").text(w).appendTo(r);var v=document.getElementById("tbVis4Images").checked,y=document.getElementById("tbVis4NbnMap")&&document.getElementById("tbVis4NbnMap").checked,d=document.getElementById("tbVis4Kb").checked,e=document.getElementById("tbVis4Text").checked,c=u.getTaxonHtmlFiles(i);e=e&&c.length>0;v=v&&u.getTaxonImages(i).length>0;y=y&&t.oTaxa[i].TVK;v&&(s=n('<div style="position: relative">').appendTo(r),e&&s.attr("class","vis4Image"),u.getTaxonImagesDiv(i,s,o));y&&(p=n('<div style="position: relative">').appendTo(r),e&&p.attr("class","vis4Image"),u.addNBNMap(t.oTaxa[i].TVK,p));e&&(c.length>1&&(k=n('<div style="margin-bottom: 20px; display: inline">').appendTo(r),l=n("<select id='vis4html'><\/select>").appendTo(k),c.forEach(function(t,i){var r=n("<option/>").text(t.Caption).attr("value",i);l.append(r)}),l.selectmenu({change:function(n,t){u.showTaxonHtmlInfo(i,h,t.item.value);h.attr("indexselected",t.item.value)}}).selectmenu("menuWidget")),h=n('<div class="htmlFile">').appendTo(r),h.attr("indexselected",f),u.showTaxonHtmlInfo(i,h,f),c.length>1&&l.val(f).selectmenu("refresh"));d&&(r.append(n("<h2>").css("clear","both").text("Knowledge-base values")),r.append(u.showTaxonCharacterValues(t.oTaxa[i],!0)));s&&n(window).resize(function(){var n=s.find(".baseimage");n.trigger("change")})}}var e="vis4",h=t[e]=Object.create(t.visP),u,i,r,s,o=0,f=0;h.initialise=function(){function y(i,r,u){if(i!="tbVis4NbnMap"||t.oCharacters.TVK){var h=n('<div style="display: inline-block; vertical-align:top; margin-left: 20px">').appendTo(u);h.append(n("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='"+i+"' id='"+i+"'>"));h.append(n("<span>").text(r));h.change(function(){var i=n("#"+e).find(".tombioImage"),t;i.length>0&&(o=i.attr("indexselected"));t=n("#"+e).find(".htmlFile");t.length>0&&(f=t.attr("indexselected"));c(s,!0);o=0;f=0})}}var v,h;u=this;this.metadata.title="Full taxon details";this.metadata.authors="Burkmar, R.";this.metadata.year="2016";this.metadata.publisher="Field Studies Council";this.metadata.location="Shrewsbury, England";this.metadata.contact="richardb@field-studies-council.org";this.metadata.version="1.0";this.charStateInput=!1;this.helpFiles=[t.opts.tombiopath+"vis4/vis4Help.html",t.opts.tombiopath+"common/full-details.html",t.opts.tombiopath+"common/taxon-select-help.html"];this.contextMenu.addItem("Get URL for full details view",function(){l()},[this.visName]);v=n("<div>").appendTo(n(this.cssSel));n(this.cssSel).append(v);this.controlsDiv=n("<div/>").css("width",210).css("float","left");v.append(this.controlsDiv);h=n("<div/>").css("display","block").css("overflow","hidden");v.append(h);i=Object.create(t.taxonSelect);i.init(this.controlsDiv,!1,a);y("tbVis4Images","Images",h);y("tbVis4NbnMap","NBN Map",h);y("tbVis4Kb","Knowledge-base",h);y("tbVis4Text","Show text",h);r=n("<div>").css("margin","10px");h.append(r)};h.refresh=function(){n("#vis4taxon").selectmenu("menuWidget").css("height",200)};h.urlParams=function(t){var r,u;t.opts&&(r=t.opts.split("-"),n("#tbVis4Text").prop("checked",r.indexOf("text")>-1),n("#tbVis4Images").prop("checked",r.indexOf("image")>-1),n("#tbVis4Kb").prop("checked",r.indexOf("kb")>-1));t.hc&&i.toggleHiddenControls();t.sort&&i.setSort(t.sort);t.imgi&&(o=t.imgi);t.txti&&(f=t.txti);t.taxon&&i.taxonClick(t.taxon.replace(/%20/g," "));t.filter&&(u=t.filter.startsWith("-")?"#"+t.filter.substr(1):t.filter,console.log("setting filter",u),i.setFilter(u));o=0;f=0}})(jQuery,this.tombiovis);