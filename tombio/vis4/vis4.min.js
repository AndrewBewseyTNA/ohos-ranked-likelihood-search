(function(n,t){"use strict";function h(){var n=[],r;n.push("selectedTool="+i);n.push("taxon="+f);var o=document.getElementById("tbVis4Images").checked,s=document.getElementById("tbVis4Kb").checked,h=document.getElementById("tbVis4Text").checked;o&&s&&h||(r=[],o&&r.push("image"),h&&r.push("text"),s&&r.push("kb"),n.push("opts="+r.join("-")));n=e.setParamsFromState(n);t.d.oTaxa[f].visState[i].indexselectedImg&&n.push("imgi="+t.d.oTaxa[f].visState[i].indexselectedImg);t.d.oTaxa[f].visState[i].indexselectedText&&n.push("txti="+t.d.oTaxa[f].visState[i].indexselectedText);u.createViewURL(n)}function c(n){f=n.selected;s(f)}function s(f){var a,s,b,o,k,c,d,l,p,w;if(r.html(null),f){t.opts.toolconfig&&t.opts.toolconfig.vis4&&t.opts.toolconfig.vis4.subTitleChar&&(b=t.opts.toolconfig.vis4.subTitleChar,a=t.d.oTaxa[f][b].kbValue);s=a?f+" ("+a+")":f+" ";s=s+"<span id='vis4TaxonHeaderPadding'>x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x<\/span>";n("<div id='vis4TaxonHeader'>").html(s).appendTo(r);var v=document.getElementById("tbVis4Images").checked,y=document.getElementById("tbVis4NbnMap")&&document.getElementById("tbVis4NbnMap").checked,g=document.getElementById("tbVis4Kb").checked,e=document.getElementById("tbVis4Text").checked,h=u.getTaxonHtmlFiles(f);e=e&&h.length>0;v=v&&u.getTaxonImages(f).length>0;y=y&&t.d.oTaxa[f].TVK;v&&(o=n('<div style="position: relative">').appendTo(r),e?o.attr("class","vis4ImageWithText"):o.attr("class","vis4ImageNoText"),k=t.d.oTaxa[f].visState[i].indexselectedImg?t.d.oTaxa[f].visState[i].indexselectedImg:0,u.addTaxonImagesToContainer({taxon:f,container:o,indexSelected:k,height:e?400:600,fImageSelect:function(n){t.d.oTaxa[f].visState[i].indexselectedImg=n}}));y&&(c=n('<div style="position: relative">').appendTo(r),e?c.attr("class","vis4ImageWithText"):c.attr("class","vis4ImageNoText"),u.addNBNMapToContainer(t.d.oTaxa[f].TVK,c));e&&(h.length>1&&(d=n('<div style="margin-bottom: 20px; display: inline">').appendTo(r),l=n("<select id='vis4html'><\/select>").appendTo(d),h.forEach(function(t,i){var r=n("<option/>").text(t.Caption).attr("value",i);l.append(r)}),l.selectmenu({change:function(n,r){u.addTaxonHtmlToContainer(f,p,r.item.value);t.d.oTaxa[f].visState[i].indexselectedText=r.item.value}}).selectmenu("menuWidget")),p=n('<div class="htmlFile">').appendTo(r),w=t.d.oTaxa[f].visState[i].indexselectedText?t.d.oTaxa[f].visState[i].indexselectedText:0,u.addTaxonHtmlToContainer(f,p,w),h.length>1&&l.val(w).selectmenu("refresh"));g&&(r.append(n("<h2>").css("clear","both").text("Knowledge-base values")),r.append(u.getTaxonCharacterValues(t.d.oTaxa[f])));o&&n(window).resize(function(){var n=o.find(".baseimage");n.trigger("change")})}}var i="vis4",o=t.v.visualisations[i]=Object.create(t.v.visPjQueryUILargeFormat),u,e,r,f;o.initialise=function(){function l(i,r,u){if(i!="tbVis4NbnMap"||t.d.oCharacters.TVK){var e=n('<div style="display: inline-block; vertical-align:top; margin-left: 20px">').appendTo(u);e.append(n("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='"+i+"' id='"+i+"'>"));e.append(n("<span>").text(r));e.change(function(){s(f,!0)})}}var o,i;u=this;this.metadata.title="Full taxon details";this.metadata.authors="Burkmar, R.";this.metadata.year="2016";this.metadata.publisher="Field Studies Council";this.metadata.location="Shrewsbury, England";this.metadata.contact="richardb@field-studies-council.org";this.metadata.version="1.1";this.charStateInput=!1;this.helpFiles=[t.opts.tombiopath+"vis4/vis4Help.html",t.opts.tombiopath+"common/full-details.html",t.opts.tombiopath+"common/taxon-select-help.html"];this.contextMenu.addItem("Get URL for full details view",function(){h()},[this.visName]);o=n("<div>").appendTo(n(this.cssSel));n(this.cssSel).append(o);this.controlsDiv=n("<div/>").css("width",210).css("float","left");o.append(this.controlsDiv);i=n("<div/>").css("display","block").css("overflow","hidden");o.append(i);e=Object.create(t.gui.taxonSelect);e.init(this.controlsDiv,!1,c);l("tbVis4Images","Images",i);l("tbVis4NbnMap","NBN Map",i);l("tbVis4Kb","Knowledge-base",i);l("tbVis4Text","Show text",i);r=n("<div>").css("margin","10px");i.append(r)};o.refresh=function(){n("#vis4taxon").selectmenu("menuWidget").css("height",200)};o.urlParams=function(r){var f,u;r.opts&&(f=r.opts.split("-"),n("#tbVis4Text").prop("checked",f.indexOf("text")>-1),n("#tbVis4Images").prop("checked",f.indexOf("image")>-1),n("#tbVis4Kb").prop("checked",f.indexOf("kb")>-1));u=r.taxon?r.taxon.replace(/%20/g," "):"";r.imgi&&(t.d.oTaxa[u].visState[i].indexselectedImg=r.imgi);r.txti&&(t.d.oTaxa[u].visState[i].indexselectedText=r.txti);u&&e.taxonClick(u);e.initStateFromParams(r)}})(jQuery,this.tombiovis);