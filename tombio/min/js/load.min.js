if(function(a){"use strict";if("undefined"!=typeof tombiover&&(a.opts.tombiover=tombiover),"undefined"!=typeof tombiopath&&(a.opts.tombiopath=tombiopath),"undefined"!=typeof tombiokbpath&&(a.opts.tombiokbpath=tombiokbpath),!a.opts.pwaSupress&&"serviceWorker"in navigator){var e="sw.js?tombiokbpath="+encodeURIComponent(a.opts.tombiokbpath)+"&tombiopath="+encodeURIComponent(a.opts.tombiopath);a.opts.pwa=!0,navigator.serviceWorker.register(e).then(function(){s("Service worker started successfully")}).catch(function(){s("Service worker failed")})}else s("Service worker not called");function s(e){console.log(e),window.console||(window.console={log:function(){}}),a.opts||(a.opts={}),a.opts.toolconfig||(a.opts.toolconfig={});var s=new URLSearchParams(window.location.search).get("gui");s&&(a.opts.gui=s),a.f={},a.d={},a.d.nbnMapCache={},a.d.scoreColours=["#fc8d59","#ffffbf","#91bfdb"],a.v={},a.v.visualisations={},a.js={},a.gui={},a.gui.sharedKeyInput={},a.d.softwareMetadata={title:"FSC Identikit",year:"2018",authors:"Burkmar, R.",publisher:"Field Studies Council",location:"Shrewsbury, England",contact:"r.burkmar@field-studies-council.org",version:"1.8.1"};var t=["vis1","vis2","vis5","vis4","vis3"];a.v.includedVisualisations=[];var o=a.js.jsFiles={add:function(e,s,i,o){a.js.jsFiles[e]=Object.create(n),a.js.jsFiles[e].init(e,s,i,o)},asArray:function(){var e=[];for(var s in a.js.jsFiles)a.js.jsFiles.hasOwnProperty(s)&&e.push(a.js.jsFiles[s]);return e}},n={init:function(e,s,i,o){this.id=e,this.file=r(a.opts.tombiopath+s),this.tombiover=i,this.requires=[],this.requiresFirst=[],this.css=[],this.toolName=o},addCSS:function(e){this.css.push(r(a.opts.tombiopath+e))},loadJs:function(t,n){if(!this.p){var r=this.id,s=[];this.requires.forEach(function(e){s.push(o[e].loadJs(r,!1))});var i=[];this.requiresFirst.forEach(function(e){i.push(o[e].loadJs(r,!0))});var a=this.file,d=this.css,u=this.initF;this.p=Promise.all(i).then(function(){var e=new Promise(function(s,i){var o=document.createElement("script");o.src=a,o.onreadystatechange=o.onload=function(){if(!o.readyState||/loaded|complete/.test(o.readyState)){var e="";t&&(e=n?" (req before "+t+")":" (req by "+t+")"),console.log("%cLoaded JS file "+c(a)+" "+e,"color: blue"),u&&u(),d.forEach(function(e){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=e,document.querySelector("head").appendChild(s),console.log("%cCSS link added for "+c(e),"color: green")}),s()}else console.log("%cFailed to load JS file for "+r,"color: red"),i()},document.querySelector("head").appendChild(o)});return s.push(e),Promise.all(s)})}return this.p}};function r(e){if(a.opts.devel)return e;if(-1<e.indexOf("dependencies"))return e;var s=e.lastIndexOf("."),i=e.substr(s+1),o=e.substr(0,s),t=o.lastIndexOf("/"),n=-1==t?o:o.substr(t+1);return a.opts.tombiopath+"min/"+i+"/"+n+".min."+i}function c(e){var s=e.split("/");return s[s.length-1]}function i(e,s){a.opts.toolconfig[e]||(a.opts.toolconfig[e]={}),o[e].requiresFirst||(o[e].requiresFirst=[]),s&&(a.opts.toolconfig[e].keyinput||(a.opts.toolconfig.genKeyinput&&a.opts.toolconfig.genKeyinput.default?a.opts.toolconfig[e].keyinput=a.opts.toolconfig.genKeyinput.default:a.opts.toolconfig[e].keyinput="keyInput"),o[e].requiresFirst.push(a.opts.toolconfig[e].keyinput),console.log("Requires first",e,o[e].requiresFirst))}a.f.showDownloadSpinner=function(){var e=document.createElement("div");e.id="downloadspin";e.innerHTML='<div class="loader"><svg viewBox="0 0 32 32" width="32" height="32"><circle id="spinner" cx="16" cy="16" r="14" fill="none"></circle></svg></div>';var s=document.getElementById("tombiod3");s.insertBefore(e,s.firstChild)},a.f.hideDownloadSpinner=function(){var e=document.getElementById("tombiod3"),s=document.getElementById("downloadspin");e.removeChild(s)},o.add("jquery","dependencies/jquery-3.1.1/jquery-3.1.1.min.js"),o.add("d3","dependencies/d3-5.7.0/d3.min.js"),o.add("jqueryui","dependencies/jquery-ui-1.12.1/jquery-ui.min.js"),o.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.min.css"),o.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.theme.min.css"),o.jqueryui.addCSS("css/jquery-ui-tombio.css"),o.add("zoomMaster","dependencies/zoom-master/jquery.zoom.min.js"),o.add("galleria","dependencies/galleria-1.5.7/galleria/galleria-1.5.7.min.js"),o.galleria.addCSS("dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.css"),o.galleria.initF=function(){Galleria.loadTheme(a.opts.tombiopath+"dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.min.js"),Galleria.on("image",function(e){$(e.imageTarget).parent().zoom({on:"grab"})})},o.add("mousewheel","dependencies/jquery.mousewheel.min.js"),o.add("hammer","dependencies/hammer.min.js"),o.add("pqselect","dependencies/pqselect-1.3.2/pqselect.min.js"),o.pqselect.addCSS("dependencies/pqselect-1.3.2/pqselect.min.css"),o.pqselect.requiresFirst=["jqueryui"],o.add("pqgrid","dependencies/pqgrid-2.1.0/pqgrid.min.js"),o.pqgrid.addCSS("dependencies/pqgrid-2.1.0/pqgrid.min.css"),o.pqgrid.requiresFirst=["jqueryui"],o.add("keyinputTemplate","keyinputTemplate.js",!0),o.add("keyInput","keyinput.js",!0),o.keyInput.addCSS("css/keyinput.css"),o.keyInput.requires=["pqselect","jqueryui"],o.add("keyInputBasic","keyinputBasic.js",!0),o.keyInputBasic.addCSS("css/keyinputbasic.css"),o.add("keyInputOnsenUi","keyinputOnsenUi.js",!0),o.keyInputOnsenUi.addCSS("css/keyinputOnsenUi.css"),o.keyInputOnsenUi.requiresFirst=["onsenui"],o.add("tombiovis","tombiovis.js",!0),o.tombiovis.addCSS("css/tombiovis.css"),o.tombiovis.requires=["kbchecks"],o.add("kbchecks","kbchecks.js",!0),o.add("score","score.js",!0),o.add("taxonselect","taxonselect.js",!0),o.taxonselect.addCSS("css/taxonselect.css"),o.taxonselect.requires=["jqueryui"],o.add("visP","visP.js",!0),o.visP.requires=["galleria","zoomMaster"],o.add("guiTemplate","guiTemplate.js",!0),o.add("guiLargeJqueryUi","guiLargeJqueryUi.js",!0),o.guiLargeJqueryUi.addCSS("css/guiLargeJqueryUi.css"),o.guiLargeJqueryUi.requires=["jqueryui"],o.add("guiLarge","guiLarge.js",!0),o.guiLarge.addCSS("css/guiLarge.css"),o.add("guiOnsenUi","guiOnsenUi.js",!0),o.guiOnsenUi.addCSS("css/guiOnsenUi.css"),o.guiOnsenUi.requiresFirst=["onsenui"],o.add("onsenui","dependencies/onsenui-2.10.3/js/onsenui.min.js"),o.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsenui.min.css"),o.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsen-css-components.min.css"),o.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsenui-fonts.css"),o.add("visTemplate","visTemplate/visTemplate.js"),o.visTemplate.requiresFirst=["visP"],o.add("vis1","vis1/vis1.js",!0,"Two-column key"),o.vis1.addCSS("vis1/vis1.css"),o.vis1.requiresFirst=["visP"],o.vis1.requires=["score"],i("vis1",!0),o.add("vis2","vis2/vis2.js",!0,"Single-column key"),o.vis2.addCSS("vis2/vis2.css"),o.vis2.requiresFirst=["visP"],o.vis2.requires=["score"],i("vis2",!0),o.add("vis3","vis3/vis3.js",!0,"Side by side comparison"),o.vis3.addCSS("vis3/vis3.css"),o.vis3.requiresFirst=["visP"],i("vis3",!(o.vis3.requires=["taxonselect","pqgrid","score"])),o.add("vis4","vis4/vis4.js",!0,"Full taxon details"),o.vis4.addCSS("vis4/vis4.css"),o.vis4.requiresFirst=["visP"],i("vis4",!(o.vis4.requires=["taxonselect"])),o.add("vis5","vis5/vis5.js",!0,"Circle-pack key"),o.vis5.addCSS("vis5/vis5.css"),o.vis5.requiresFirst=["visP"],o.vis5.requires=["score"],i("vis5",!0),o.add("vis6","vis6/vis6.js",!0,"Mobile key"),o.vis6.addCSS("vis6/vis6.css"),o.vis6.requiresFirst=["visP"],o.vis6.requires=["score"],i("vis6",!0),o.add("visEarthworm2","visEarthworm2/visEarthworm2.js",!0,"Bespoke earthworm key"),o.visEarthworm2.addCSS("visEarthworm2/visEarthworm2.css"),o.visEarthworm2.requiresFirst=["visP"],o.visEarthworm2.requires=["jqueryui","score"],a.f.startLoad=function(){a.f.showDownloadSpinner(),Promise.all([o.d3.loadJs(),o.jquery.loadJs()]).then(function(){return jQuery(document).ready(function(){jQuery("#tombiod3").append(jQuery('<div id="tombiod3vis">'))}),function(){var e,i=new Date,s=[];return e=d3.csv(a.opts.tombiokbpath+"taxa.csv?t=kbcsv",function(e){return o(e)}).then(function(e){a.d.taxa=e,console.log("%cLoading - kb taxa loaded","color: blue")}),s.push(e),e=d3.csv(a.opts.tombiokbpath+"characters.csv?t=kbcsv",function(e){return o(e)}).then(function(e){a.d.characters=e,console.log("%cLoading - kb characters loaded","color: blue")}),s.push(e),e=d3.csv(a.opts.tombiokbpath+"values.csv?t=kbcsv",function(e){return o(e)}).then(function(e){a.d.values=e,console.log("%cLoading - kb values loaded","color: blue")}),s.push(e),e=d3.csv(a.opts.tombiokbpath+"media.csv?t=kbcsv",function(e){return o(e)}).then(function(e){a.d.media=e,console.log("%cLoading - kb media loaded","color: blue")}),s.push(e),e=d3.csv(a.opts.tombiokbpath+"config.csv?t=kbcsv",function(e){return o(e)}).then(function(e){a.d.config=e,a.d.kbconfig={},a.d.kbmetadata={},a.d.kbreleaseHistory=[];var s=[];e.forEach(function(e){"config"==e.Type&&(a.d.kbconfig[e.Key]=e.Value),a.opts.selectedTool,"excludedDefaultTools"==e.Key&&""!=e.Value.trim()&&e.Value.split(",").forEach(function(e){s.push(e.trim())}),"otherIncludedTools"==e.Key&&""!=e.Value.trim()&&e.Value.split(",").forEach(function(e){a.v.includedVisualisations.push(e.trim())}),"metadata"==e.Type&&(a.d.kbmetadata[e.Key]=e.Value),"release"==e.Key&&a.d.kbreleaseHistory.push(e)}),t.forEach(function(e){-1==s.indexOf(e)&&a.v.includedVisualisations.push(e)}),a.opts.tools&&Array.isArray(a.opts.tools)&&0<a.opts.tools.length&&(a.v.includedVisualisations=a.opts.tools),console.log("%cLoading - kb config loaded","color: blue")}),s.push(e),Promise.all(s).then(function(){var e,s;console.log("%cKB loaded in "+(e=i,s=new Date-e,s/=1e3,Math.round(100*s)/100),"color: blue")});function o(e){if(""!=e[Object.keys(e)[0]]&&"#"!=e[Object.keys(e)[0]].substr(0,1)){for(var s in e)e.hasOwnProperty(s)&&(e[s]=e[s]?e[s].trim():"","?"==e[s]&&(e[s]=""));return e}return null}}()}).then(function(){return a.templates={gui:{main:{}}},a.opts.devel?Promise.all([o.guiTemplate.loadJs(),o.visTemplate.loadJs(),o.keyinputTemplate.loadJs()]):Promise.resolve()}).then(function(){return Promise.all([o.tombiovis.loadJs()])}).then(function(){if(a.opts.gui)var e=a.opts.gui;else e="guiLargeJqueryUi";var s=[o[e].loadJs()];Promise.all(s).then(function(){a.f.hideDownloadSpinner(),a.f.loadcomplete()})})},a.opts.loadWait||a.f.startLoad()}}(this.tombiovis?this.tombiovis:this.tombiovis={}),tombiovis.opts.devel)var v=tombiovis;