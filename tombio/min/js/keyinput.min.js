!function(V,H){"use strict";function L(){var a=V("input[name=charvisibility]:checked").val();V(".cloneInput .stateselect, .cloneInput .statespinner").each(function(t){if(void 0!==V(this).attr("id"))if("visible"==a)V(this).parents(".cloneInput").show(500,H.f.resizeControlsAndTaxa);else{var e=V(this).val();e&&""!=e?V(this).parents(".cloneInput").show(500,H.f.resizeControlsAndTaxa):V(this).parents(".cloneInput").hide(500,H.f.resizeControlsAndTaxa)}})}function P(n){var s=V("#"+n).pqSelect({multiplePlaceholder:"select option(s)",singlePlaceholder:"select option",checkbox:!0,search:!1,maxDisplay:20,width:240,selectallText:""});s.addClass("stateselect"),s.on("change",function(){if("clone-"==n.substring(0,6))var t=n.substring(6);else t="clone-"+n;if(V("#"+t).val(s.val()),V("#"+t).pqSelect("refreshData"),V("#"+n).pqSelect("refresh"),L(),"clone-"==n.substring(0,6))var a=n.substring(6);else a=n;var e=null!=s.val()&&""!=s.val();if(H.d.oCharacters[a].stateSet=e){if("string"==typeof s.val())var r=[s.val()];else r=s.val();var i=[];H.d.oCharacters[a].CharacterStateValues.forEach(function(t,e){-1<r.indexOf(t)&&i.push(e)}),H.d.oCharacters[a].userInput=i}else H.d.oCharacters[a].userInput=null;[n,t].forEach(function(t){var e=V("#"+t).next().children().find(".pq-select-item-text");e.attr("title",function(){var e=this,t=H.d.values.filter(function(t){if(t.Character==a&&t.CharacterState==V(e).text())return!0});return 1==t.length?t[0].StateHelpShort?t[0].StateHelpShort:t[0].StateHelp:""}),e.tooltip({track:!0})}),H.f.refreshVisualisation()}),s.val(V("#"+n+" option:first").val()).pqSelect("refreshData"),s.val("").pqSelect("refreshData")}function F(r,t,e,a){var i=V("#"+r).spinner({min:t,max:e,step:a});function n(t){t=i.spinner("value");if("clone-"==r.substring(0,6))var e=r.substring(6);else e="clone-"+r;if(V("#"+e).spinner("value",t),"clone-"==r.substring(0,6))var a=r.substring(6);else a=r;""==t||null===t?(H.d.oCharacters[a].stateSet=!1,H.d.oCharacters[a].userInput=null):(H.d.oCharacters[a].stateSet=!0,H.d.oCharacters[a].userInput=t),H.f.refreshVisualisation(),L()}i.addClass("statespinner"),i.on("spinstop",function(t,e){n()}),V("#"+r+"-clear").button({icon:"ui-icon-close",showLabel:!1}).on("click",function(){i.spinner("value",""),n()})}H.gui.keyInput={width:360,otherState:{keys:[]},bullet:"",verticalTabSpace:33},H.gui.keyInput.init=function(t){var a=this;V("<div>").attr("id","tombioKeyInputTabs").css("background-color","rgba( 255,255, 255, 0.7)").appendTo(t),V("<ul>").attr("id","tombioKeyInputListElements").appendTo("#tombioKeyInputTabs"),H.gui.keyInput.divSel="#tombioKeyInputTabs";var e={All:[]};for(var r in H.d.groupedCharacters.groups.forEach(function(t){e[t]=H.d.groupedCharacters[t]}),V(H.gui.main.divInput).css("min-height",this.verticalTabSpace*(H.d.groupedCharacters.groups.length+2)),e){var i="tombioKeyInputTab-"+r.replace(/\s+/g,"-"),n=V("<li/>"),s=V("<a/>").text(r).attr("href","#"+i);n.append(s),V("#tombioKeyInputListElements").append(n);var c=V("<div/>").attr("id",i);if(V("#tombioKeyInputTabs").append(c),"tombioKeyInputTab-All"==i){c.append(V("<div>").text("Un-used characters:").css("font-weight","bold"));var o=V("<fieldset>").attr("id","visCheckboxes").css("display","inline-block").css("padding","0px").css("border","none");o.append(V("<label>").attr("for","charvisible").text("show")),o.append(V("<input>").attr("type","radio").attr("name","charvisibility").attr("id","charvisible").attr("value","visible").attr("checked","checked")),o.append(V("<label>").attr("for","incharvisible").text("hide")),o.append(V("<input>").attr("type","radio").attr("name","charvisibility").attr("id","incharvisible").attr("value","invisible")),c.append(o),V("[name='charvisibility']").checkboxradio({icon:!1}),o.on("change",L);var l=V("<button>").attr("id","tombioReset").text("Reset all");l.button({icons:{primary:null,secondary:"ui-icon-reset"}}).click(function(t){V(".statespinner").spinner("value",""),V(".stateselect").each(function(){V(this).val()&&V(this).val("").pqSelect("refreshData")}),H.d.characters.forEach(function(t){t.stateSet=!1,t.userInput=null}),H.f.refreshVisualisation(),L()}),c.append(l)}for(var p=0;p<e[r].length;p++){var u=e[r][p],h=V("<span/>").attr("class","characterlabel").text(u.Label),d=V("<div/>").append(h);c.append(d),H.f.characterHasHelp(u.Character)&&(h.attr("character",u.Character),h.addClass("characterhelp"));var f=V("<div/>").attr("class","cloneInput");if(f.append(d.clone()),V("#tombioKeyInputTab-All").css("display","inline-block").append(f),"numeric"==u.ValueType){var v=u.Character,b=u.Params.split(","),g=Number(b[0]),y=Number(b[1]),m=Number(b[2]),C=V("<div>"),I=V("<input></input>").attr("class","spinner").attr("id",v),S=V("<div value='x'>").attr("class","widget").attr("class","spinclear").attr("id",v+"-clear");C.append(I),C.append(S),c.append(C),F(v,g,y,m);var k=V("<div>"),x=V("<input></input>").attr("class","spinner").attr("id","clone-"+v),T=V("<div value='x'>").attr("class","widget").attr("class","spinclear").attr("id","clone-"+v+"-clear");k.append(x),k.append(T),f.append(k),F("clone-"+v,g,y,m)}else{var K=u.Character;if("multi"==u.ControlType)var w=V("<select multiple=multiple></select>").attr("class","characterSelect");else w=V("<select></select>").attr("class","characterSelect");if(w.attr("id",K),c.append(w),"single"==u.ControlType){var E=V("<option/>").text("");w.append(E)}u.CharacterStateValues.forEach(function(t){var e=V("<option/>").text(a.bullet+t);w.append(e)}),P(K);var q=V("#"+K).clone();q.attr("id","clone-"+K),f.append(q),P("clone-"+K)}}}H.d.oCharacters.grouped||(V("#tombioKeyInputListElements").css("display","none"),V("#tombioKeyInputTabs").css("padding-left","0px"),H.gui.keyInput.width=255);var D,A=V("#tombioKeyInputTabs").tabs({activate:function(t,e){V(".stateselect").each(function(){}),H.f.resizeControlsAndTaxa()}});H.opts.toolconfig.genKeyinput||(H.opts.toolconfig.genKeyinput={});try{D=H.opts.toolconfig.genKeyinput.selectedGroup}catch(t){}if(!D)try{D=H.opts.toolconfig.keyinput.selectedGroup}catch(t){}if(!D)try{D=H.opts.selectedGroup}catch(t){}if(!D)try{D=H.d.kbconfig.defaultControlGroup}catch(t){}if(H.opts.toolconfig.genKeyinput.selectedGroup=D,H.opts.toolconfig.genKeyinput.selectedGroup){var G=H.d.groupedCharacters.groups.indexOf(H.opts.toolconfig.genKeyinput.selectedGroup);-1<G&&A.tabs("option","active",G+1)}V(".characterhelp").hover(function(){V(this).animate({color:"#D55E00"},"fast")},function(){V(this).animate({color:"black"},"fast")}).click(function(){var t,e;t=V(this).attr("character"),e=V("<div>"),V("<h3/>",{text:H.d.oCharacters[t].Label}).appendTo(e),e.append(V(H.f.getFullCharacterHelp(t))),H.gui.main.dialog("Character help & info",e.html())}),H.gui.main.createCharacterTooltips(".characterhelp"),H.f.checkInterface("keyInput",H.templates.gui.keyInput,H.gui.keyInput)},H.gui.keyInput.initFromCharacterState=function(){H.d.characters.forEach(function(e,t){if("spin"===e.ControlType){var a=V("#"+e.Character+".statespinner"),r=V("#clone-"+e.Character+".statespinner"),i=e.stateSet?e.userInput:"";a.spinner("value",e.userInput),r.spinner("value",i)}else{a=V("#"+e.Character+".stateselect"),r=V("#clone-"+e.Character+".stateselect");if(e.stateSet)var n=e.userInput.map(function(t){return e.CharacterStateValues[t]});else n=[];a.val(n).pqSelect("refreshData"),r.val(n).pqSelect("refreshData")}})},H.gui.keyInput.initStateFromParams=function(t){this.initFromCharacterState(),V("#tombioKeyInputTabs").tabs("option","active",t.grp),V("[name='charvisibility']").removeProp("checked").filter('[value="'+t.cvis+'"]').prop("checked",!0),V("[name='charvisibility']").checkboxradio("refresh"),L()},H.gui.keyInput.setParamsFromState=function(t){return t.push("grp="+V("#tombioKeyInputTabs").tabs("option","active")),t.push("cvis="+V("input[name=charvisibility]:checked").val()),t}}(jQuery,this.tombiovis);