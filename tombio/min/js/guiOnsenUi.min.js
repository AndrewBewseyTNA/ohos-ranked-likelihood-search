!function(u,m){"use strict";var i,o={};function c(){var t,o=m.v.visualisations[m.v.currentTool];t=o&&o.inputControl?o.inputControl.width:o&&o.taxonSelect?o.taxonSelect.width:230,u("#tombioOnsMenu").css("width",t),i?(-1<m.v.includedVisualisations.indexOf(m.v.currentTool)?(u("ons-splitter-content").css("left",t),u("ons-splitter-side").show()):(u("ons-splitter-content").css("left","0px"),u("ons-splitter-side").hide()),u("#tombioUiSideMenuBackButton").hide(),u("#tombioUiSideMenuPinIcon").attr("icon","md-pin")):(u("#tombioUiSideMenuBackButton").show(),u("#tombioUiSideMenuPinIcon").attr("icon","md-pin-off")),-1<m.v.includedVisualisations.indexOf(m.v.currentTool)?i?u("#tombioUiInputToolbarButton").hide():u("#tombioUiInputToolbarButton").show():u("#tombioUiInputToolbarButton").hide()}m.gui.main={fn:{}},m.gui.main.setSelectedTool=function(t){},m.gui.main.resizeControlsAndTaxa=function(){},m.gui.main.init=function(){"(max-width: 979px)",i=!window.matchMedia("(max-width: 979px)").matches,u("#tombiod3vis").html(""),u("<div>").attr("id","tombioOnsHiddenVisualisation").hide().appendTo("#tombiod3vis"),u("<div>").attr("id","tombioOnsHiddenControls").hide().appendTo("#tombiod3vis"),m.gui.main.divVis="#tombioOnsHiddenVisualisation",m.gui.main.divInput="#tombioOnsHiddenControls",u("<div>").attr("id","tombioOns").appendTo(u("#tombiod3vis"));var t="";t+='<ons-navigator swipeable id="tombioOnsNavigator" page="tombioOnsSelectTemplate"></ons-navigator>',t+='<template id="tombioOnsSelectTemplate">',t+='<ons-page id="tombioOnsToolSelect">',t+="<ons-toolbar>",t+='<div class="center">'+m.d.kbmetadata.title+"</div>",t+="</ons-toolbar>",t+='<ons-list id="tombioOnsTools"></ons-list>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisualisationTemplate">',t+='<ons-page id="tombioOnsVisualisation">',t+="<ons-splitter>",t+='<ons-splitter-side id="tombioOnsMenu" side="left" collapse swipeable>',t+='<ons-page id="tombioOnsVisInput">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-back-button id="tombioUiSideMenuBackButton"></ons-back-button>',t+="</div>",t+='<div class="right">',t+='<ons-toolbar-button id="tombioUiSideMenuPin" onclick="tombiovis.gui.main.fn.toggleMenuPin()">',t+='<ons-icon  id="tombioUiSideMenuPinIcon" icon=""></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+="</ons-toolbar>",t+='<div id="tombioOnsVisInputDiv"></div>',t+="</ons-page>",t+="</ons-splitter-side>",t+='<ons-splitter-content id="content" page="tombioOnsVisDisplayTemplate"></ons-splitter-content>',t+="</ons-splitter>",t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisDisplayTemplate">',t+='<ons-page id="tombioOnsVisDisplay">',t+="<ons-toolbar>";var o="";o+='<ons-toolbar-button id="tombioUiFullscreenMenuButton" onclick="tombiovis.gui.main.fn.requestFullscreen()">',o+='<ons-icon icon="md-fullscreen"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button id="tombioUiExitFullscreenMenuButton" onclick="tombiovis.gui.main.fn.exitFullscreen()" style="display: none">',o+='<ons-icon icon="md-fullscreen-exit"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button id="tombioUiContextMenuButton" onclick="tombiovis.gui.main.openContext()">',o+='<ons-icon icon="md-more-vert"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button onclick="tombiovis.gui.main.popPage()">',o+='<ons-icon icon="md-menu"></ons-icon>',t+='<div class="left">',t+='<ons-toolbar-button id="tombioUiInputToolbarButton" onclick="tombiovis.gui.main.openMenu()">',t+='<ons-icon icon="md-keyboard"></ons-icon>',t+="</ons-toolbar-button>",t+='<div id="tombioOnsToolsLeft" style="display:none">',t+=o+="</ons-toolbar-button>",t+="</div>",t+="</div>",t+='<div id="tombioOnsToolsRight" class="right">',t+=o,t+="</div>",t+="</ons-toolbar>",t+='<div id="tombioOnsVisDisplayDiv"></div>',t+='<div id="tombioOnsOtherInfoDiv"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsDialogTemplate">',t+='<ons-page id="tombioOnsDialog">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div id="tombioOnsDialogTitle" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsDialogContent" style="margin: 1em"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsContextTemplate">',t+='<ons-page id="tombioOnsContext">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div class="center">Context menu</div>',t+="</ons-toolbar>",t+='<ons-list id="tombioOnsContextContent"></ons-list>',t+="</ons-page>",t+="</template>",u("#tombioOns").append(u(t)),m.gui.main.openMenu=function(){document.getElementById("tombioOnsMenu").open()},m.gui.main.openContext=function(){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsContextTemplate").then(function(){!function(){var t=[];for(var o in m.gui.main.contextMenu.items){var i=!0;-1==m.gui.main.contextMenu.visContexts[o].indexOf(m.v.currentTool)&&(i=!1),m.gui.main.contextMenu.guiContexts[o]&&-1==m.gui.main.contextMenu.guiContexts[o].indexOf(m.opts.gui)&&(i=!1),i&&(m.gui.main.contextMenu.items[o].on("click",m.gui.main.popPage),m.gui.main.contextMenu.items[o].on("click",m.gui.main.contextMenu.functions[o]),t.push(m.gui.main.contextMenu.items[o]))}u("#tombioOnsContextContent").html(""),u("#tombioOnsContextContent").append(t)}()})},m.gui.main.popPage=function(){document.querySelector("#tombioOnsNavigator").popPage().then(function(){}).catch(function(){})},document.addEventListener("init",function(t){var o=t.target;"tombioOnsToolSelect"===o.id?m.gui.main.createUIControls(!0):"tombioOnsVisDisplay"===o.id?(u("#tombioOnsVisDisplayDiv").append(u("#tombioOnsHiddenVisualisation")),u("#tombioOnsHiddenVisualisation").show()):"tombioOnsVisInput"===o.id&&(u("#tombioOnsVisInputDiv").append(u("#tombioOnsHiddenControls")),u("#tombioOnsHiddenControls").show(),document.querySelector("#tombioUiSideMenuBackButton").onClick=function(t){document.getElementById("tombioOnsMenu").close()})}),document.addEventListener("destroy",function(t){"tombioOnsVisualisation"===t.target.id&&(u("#tombioOnsHiddenVisualisation").hide(),u("#tombiod3vis").append(u("#tombioOnsHiddenVisualisation")),u("#tombioOnsHiddenControls").hide(),u("#tombiod3vis").append(u("#tombioOnsHiddenControls")))}),document.addEventListener("show",function(t){t.target}),document.addEventListener("hide",function(t){t.target}),ons.orientation.on("change",function(){c(),function(){0<u("#tombioOnsFullDetailsTab3").length&&u("#tombioNbnMapImage").css("height",u("#tombioOnsFullDetailsTab3").height()-10);0<u("#tombioOnsFullDetailsTab2").length&&u(".tombio-galleria-pane").data("galleria").resize({height:u("#tombioOnsFullDetailsTab2").height()})}(),m.f.refreshVisualisation()}),m.f.checkInterface("guiOnsenUi",m.templates.gui.main,m.gui.main)},m.gui.main.createUIControls=function(){var e=[];(m.opts.checkKB||m.opts.devel)&&e.push(u("<ons-list-header>For developers</ons-list-header>")),n='<div class="left"><ons-icon icon="md-wrench" class="list-item__icon"></ons-icon></div>',m.opts.checkKB&&(e.push(u('<ons-list-item value="reloadkb" class="html" data-class="wrench">'+n+"Reload KB</ons-list-item>")),e.push(u('<ons-list-item value="mediaFilesCheck" class="html" data-class="wrench">'+n+"Check media files</ons-list-item>")),m.d.oCharacters.TVK&&e.push(u('<ons-list-item value="tvkCheck" class="html" data-class="wrench">'+n+"Check TVKs</ons-list-item>"))),n='<div class="left"><ons-icon icon="md-lamp" class="list-item__icon"></ons-icon></div>',e.push(u("<ons-list-header>Visualisations</ons-list-header>")),m.v.includedVisualisations.forEach(function(t,o){var i=u("<ons-list-item>").attr("value",t).attr("data-class","vis").text(m.js.jsFiles[t].toolName);i.append(u(n)),e.push(i)}),e.push(u("<ons-list-header>Help &amp; Information</ons-list-header>")),n='<div class="left"><ons-icon icon="md-info" class="list-item__icon"></ons-icon></div>',e.push(u('<ons-list-item id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info">'+n+"Using the...</ons-list-item>")),e.push(u('<ons-list-item value="kbInfo" class="html" data-class="info">'+n+"About the Knowledge-base</ons-list-item>")),e.push(u('<ons-list-item value="visInfo" class="html" data-class="info">'+n+"About FSC Identikit</ons-list-item>")),e.push(u('<ons-list-item value="tombioCitation" class="html" data-class="info">'+n+"Get citation text</ons-list-item>")),e.push(u("<ons-list-header>Other</ons-list-header>"));var n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>';e.push(u('<ons-list-item value="reload" class="html" data-class="reload">'+n+"Reload app</ons-list-item>")),e.forEach(function(t){"ons-list-item"==t.prop("tagName").toLowerCase()&&(o[t.attr("value")]=t.text(),t.on("click",function(){m.v.selectedTool=t.attr("value"),m.f.visChanged(m.v.selectedTool)}))}),u("#tombioOnsTools").append(e)},m.gui.main.visShow=function(l){var t=document.querySelector("#tombioOnsVisualisationTemplate").content.querySelector("#tombioOnsMenu");i?t.removeAttribute("collapse"):t.setAttribute("collapse",""),document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsVisualisationTemplate").then(function(){u("#tombioOnsOtherInfoDiv").html(null);m.v.visualisations[l];"tombioCitation"==l&&u("#tombioOnsOtherInfoDiv").html(((o=u("<div>")).append(u("<h3>").text("Citation for FSC Identikit (core software)")),t="This is the reference you can use for the FSC Identikit - in other words the core software.",t+=" The core version number is updated whenever there is a new major release of the core software.",o.append(u("<p>").html(t)),o.append(u("<b>").html(m.f.getCitation(m.d.softwareMetadata,"Software"))),o.append(u("<h3>").text("Citation for last selected visualisation tool")),t="This is the reference you can use for the last selected visualisation tool.",t+=" The tool version number is updated whenever there is a new release of the tool.",t+=" If you cite a tool, there's no need to cite the core software separately since it is implicit.",o.append(u("<p>").html(t)),o.append(u("<b>").html(m.f.getCitation(m.v.visualisations[m.v.lastVis].metadata,"Software",m.d.softwareMetadata.title))),o.append(u("<h3>").text("Citation for knowledge-base")),t="This is the reference you can use for the knowledge-base currently driving the software.",t+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.",o.append(u("<p>").html(t)),o.append(u("<b>").html(m.f.getCitation(m.d.kbmetadata,"Knowledge-base",m.d.softwareMetadata.title))),o));var t,o;"mediaFilesCheck"==l&&u("#tombioOnsOtherInfoDiv").html(m.f.createMediaCheckPage());"tvkCheck"==l&&u("#tombioOnsOtherInfoDiv").html(m.f.createTvkCheckPage());"kbInfo"==l&&m.f.setKbInfo(u("#tombioOnsOtherInfoDiv"));"visInfo"==l&&m.f.setVisInfo(u("#tombioOnsOtherInfoDiv"));"currentVisInfo"==l&&(u("#tombioOnsOtherInfoDiv").html(""),m.f.setSelectedToolInfo(u("#tombioOnsOtherInfoDiv")));l!=m.v.currentTool&&(m.v.currentTool&&(m.v.visualisations[m.v.currentTool]?m.v.visualisations[m.v.currentTool].hide():u("#"+m.v.currentTool).hide()),m.v.visualisations[l]?m.v.visualisations[l].show():u("#"+l).show());m.f.refreshVisualisation(),m.v.currentTool=l,-1<Object.keys(m.v.visualisations).indexOf(l)&&(m.v.lastVis=l,u("#optCurrentVisInfo>div.center").text("Using the "+m.v.visualisations[m.v.lastVis].metadata.title));-1<m.v.includedVisualisations.indexOf(l)?(u("#tombioOnsVisDisplayDiv").show(),u("#tombioOnsOtherInfoDiv").hide()):(u("#tombioOnsVisDisplayDiv").hide(),u("#tombioOnsOtherInfoDiv").show());if(c(),!m.v.initialised&&m.v.visualisations[l]){for(var i={},e=decodeURI(window.location.search.substring(1)).replace(/\+/g," "),n=e.split("&"),s=0;s<n.length;s++){var a=n[s].split("=");i[a[0]]=a[1]}m.v.visualisations[l].urlParams(i),m.v.initialised=!0}})},m.gui.main.dialog=function(t,o){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsDialogTemplate").then(function(){u("#tombioOnsDialogTitle").text(t),u("#tombioOnsDialogContent").html(o)})},m.gui.main.createCharacterTooltips=function(t){},m.gui.main.createTaxonToolTips=function(t,o){},m.gui.main.tooltip=function(t){},m.gui.main.showFullDetails=function(t,o,i,e){if(0==u("#tombioOnsFullDetailsTemplate").length){var s="";s+='<template id="tombioOnsFullDetailsTemplate">',s+='<ons-page id="tombioOnsFullDetails">',s+="<ons-toolbar>",s+='<div class="left">',s+="<ons-back-button></ons-back-button>",s+="</div>",s+='<div id="tombioOnsFullDetailsTitle" class="center"></div>',s+="</ons-toolbar>",s+='<ons-tabbar id="tombioOnsFullDetailsTabBar" swipeable position="auto">',s+='<ons-tab page="tombioOnsFullDetailsTab1Template" label="Knowledge" icon="md-grid" active>',s+="</ons-tab>",s+='<ons-tab page="tombioOnsFullDetailsTab2Template" label="Images" icon="md-image">',s+="</ons-tab>",m.d.oCharacters.TVK&&(s+='<ons-tab page="tombioOnsFullDetailsTab3Template" label="NBN Atlas" icon="md-map">',s+="</ons-tab>"),s+='<ons-tab page="tombioOnsFullDetailsTab4Template" label="Info" icon="md-file-text">',s+="</ons-tab>",s+="</ons-tabbar>",s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab1Template">',s+='<ons-page id="tombioOnsFullDetailsTab1">',s+='<div id="tombioOnsFullDetailsTab1Content" style="margin: 1em"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab2Template">',s+='<ons-page id="tombioOnsFullDetailsTab2">',s+='<div id="tombioOnsFullDetailsTab2Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab3Template">',s+='<ons-page id="tombioOnsFullDetailsTab3">',s+='<div id="tombioOnsFullDetailsTab3Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab4Template">',s+='<ons-page id="tombioOnsFullDetailsTab4">',s+='<div id="tombioOnsFullDetailsTab4Content"></div>',s+="</ons-page>",s+="</template>",u("#tombioOns").append(u(s)),document.addEventListener("show",function(t){var o=document.querySelector("#tombioOnsNavigator").topPage.data.taxon,i=document.querySelector("#tombioOnsNavigator").topPage.data.tab;u("#tombioOnsFullDetailsTitle").html("<i>"+o+"</i>"),t.target.matches("#tombioOnsFullDetailsTab1")&&u("#tombioOnsFullDetailsTab1Content").html(m.f.getTaxonCharacterValues(m.d.oTaxa[o])),t.target.matches("#tombioOnsFullDetailsTab2")&&(u("#tombioOnsFullDetailsTab2Content").html(""),u("#tombioOnsFullDetailsTab2Content").attr("data-taxon",o),m.f.addTaxonImagesToContainer({taxon:o,container:u("#tombioOnsFullDetailsTab2Content"),height:u("#tombioOnsFullDetailsTab2").css("height")})),t.target.matches("#tombioOnsFullDetailsTab3")&&(u("#tombioOnsFullDetailsTab3Content").html(""),m.f.addNBNMapToContainer(m.d.oTaxa[o].TVK,u("#tombioOnsFullDetailsTab3Content")),u("#tombioNbnMapImage").css("height",u("#tombioOnsFullDetailsTab3").height()-10)),t.target.matches("#tombioOnsFullDetailsTab4")&&(u("#tombioOnsFullDetailsTab4Content").html(""),function(o,t){var i=u("<div>").css("margin","10px").appendTo(t),e=m.f.getTaxonHtmlFiles(o);if(0==e.length)i.text("No text information files (HTML) are specified in the knowledge-base for this taxon.");else{var n=u("<div>");1<e.length&&(s='<ons-select onchange="tombiovis.gui.main.textFileSelect(event)">',e.forEach(function(t,o){s+='<option value="'+o+'">',s+=t.Caption,s+="</option>"}),s+="</ons-select>",i.html(s)),n.appendTo(i),m.f.addTaxonHtmlToContainer(o,n,0),m.gui.main.textFileSelect=function(t){m.f.addTaxonHtmlToContainer(o,n,t.target.value)}}}(o,u("#tombioOnsFullDetailsTab4Content"))),t.target.matches("#tombioOnsFullDetails")&&i&&document.querySelector("#tombioOnsFullDetailsTabBar").setActiveTab(i)},!1)}document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsFullDetailsTemplate",{data:{taxon:t,tab:o}}).then(function(){})},m.gui.main.fn.toggleMenuPin=function(){(i=!i)?u("#tombioOnsMenu").removeAttr("collapse"):u("#tombioOnsMenu").attr("collapse",""),console.log("vis width",u("#tombioOnsVisDisplay").width()),u("#tombioOnsVisDisplay").width()<208?(u("#tombioOnsToolsRight").hide(),u("#tombioOnsToolsLeft").show()):(u("#tombioOnsToolsRight").show(),u("#tombioOnsToolsLeft").hide()),c(),m.f.refreshVisualisation()},m.gui.main.contextMenu={items:{},functions:{},visContexts:{},guiContexts:{}},m.gui.main.contextMenu.addItem=function(t,o,i,e,n){if(i&&t in m.gui.main.contextMenu.items&&(m.gui.main.contextMenu.items[t].remove(),delete m.gui.main.contextMenu.items[t],delete m.gui.main.contextMenu.functions[t],delete m.gui.main.contextMenu.visContexts[t],delete m.gui.main.contextMenu.guiContexts[t]),!(t in m.gui.main.contextMenu.items)){var s=u('<ons-list-item><div class="left"><ons-icon icon="md-caret-right" class="list-item__icon"></ons-icon></div>'+t+"</ons-list-item>");m.gui.main.contextMenu.items[t]=s,m.gui.main.contextMenu.visContexts[t]=e,m.gui.main.contextMenu.guiContexts[t]=n,m.gui.main.contextMenu.functions[t]=o}},m.gui.main.contextMenu.removeItem=function(t){t in m.gui.main.contextMenu.items&&(delete m.gui.main.contextMenu.items[t],delete m.gui.main.contextMenu.functions[t],delete m.gui.main.contextMenu.visContexts[t],delete m.gui.main.contextMenu.guiContexts[t])},m.gui.main.fn.requestFullscreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),u("#tombioUiFullscreenMenuButton").hide(),u("#tombioUiExitFullscreenMenuButton").show()},m.gui.main.fn.exitFullscreen=function(){console.log("exit fullscreen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),u("#tombioUiFullscreenMenuButton").show(),u("#tombioUiExitFullscreenMenuButton").hide()}}(jQuery,this.tombiovis);