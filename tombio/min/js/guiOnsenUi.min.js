!function(u,d){"use strict";u("#tombiod3-header").remove(),u("#tombiod3-footer").remove();var e,o={};function i(){u("#tombioOnsVisDisplay").width()<208?(u("#tombioOnsToolsRight").hide(),u("#tombioOnsToolsLeft").show()):(u("#tombioOnsToolsRight").show(),u("#tombioOnsToolsLeft").hide())}function r(){var t,o=d.v.visualisations[d.v.currentTool];t=o&&o.inputControl?o.inputControl.width:o&&o.taxonSelect?o.taxonSelect.width:230,u("#tombioOnsMenu").css("width",t),e?(-1<d.v.includedVisualisations.indexOf(d.v.currentTool)?(u("ons-splitter-content").css("left",t),u("ons-splitter-side").show()):(u("ons-splitter-content").css("left","0px"),u("ons-splitter-side").hide()),u("#tombioUiSideMenuBackButton").hide(),u("#tombioUiSideMenuPinIcon").attr("icon","md-pin")):(u("#tombioUiSideMenuBackButton").show(),u("#tombioUiSideMenuPinIcon").attr("icon","md-pin-off")),-1<d.v.includedVisualisations.indexOf(d.v.currentTool)?e?u("#tombioUiInputToolbarButton").hide():u("#tombioUiInputToolbarButton").show():u("#tombioUiInputToolbarButton").hide()}d.gui.main={fn:{}},d.gui.main.setSelectedTool=function(t){},d.gui.main.updateProgress=function(t){100==t&&u("#tombioOnsDownloadProgressHeader").text("Resource download complete"),u("#tombioOnsDownloadProgressHeader").show(),u("#tombioOnsDownloadProgress").attr("value",t)},d.gui.main.offlineOptions=function(){d.gui.main.dialog("Offline options",'<ons-button  modifier="outline" onclick="tombiovis.f.cacheAll()">Download for offline use</ons-button><p id="tombioOnsDownloadProgressHeader" style="display: none">Downloading resources...</p><ons-progress-bar id="tombioOnsDownloadProgress" value="0"></ons-progress-bar>')},d.gui.main.offerRefresh=function(){var t=document.getElementById("refreshPrompt");t?t.show():ons.createElement("refreshPromptTemplate",{append:!0}).then(function(t){t.show()})},d.gui.main.resizeControlsAndTaxa=function(){},d.gui.main.init=function(){"(max-width: 979px)",e=!window.matchMedia("(max-width: 979px)").matches,u("#tombiod3vis").html(""),u("<div>").attr("id","tombioOnsHiddenVisualisation").hide().appendTo("#tombiod3vis"),u("<div>").attr("id","tombioOnsHiddenControls").hide().appendTo("#tombiod3vis"),d.gui.main.divVis="#tombioOnsHiddenVisualisation",d.gui.main.divInput="#tombioOnsHiddenControls",u("<div>").attr("id","tombioOns").appendTo(u("#tombiod3vis"));var t="";t+='<ons-navigator swipeable id="tombioOnsNavigator" page="tombioOnsSelectTemplate"></ons-navigator>',t+='<template id="tombioOnsSelectTemplate">',t+='<ons-page id="tombioOnsToolSelect">',t+="<ons-toolbar>",t+='<div class="center">'+d.d.kbmetadata.title+"</div>",t+="</ons-toolbar>",t+='<ons-list id="tombioOnsTools"></ons-list>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisualisationTemplate">',t+='<ons-page id="tombioOnsVisualisation">',t+="<ons-splitter>",t+='<ons-splitter-side id="tombioOnsMenu" side="left" collapse swipeable>',t+='<ons-page id="tombioOnsVisInput">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-back-button id="tombioUiSideMenuBackButton"></ons-back-button>',t+="</div>",t+='<div class="right">',t+='<ons-toolbar-button id="tombioUiSideMenuPin" onclick="tombiovis.gui.main.fn.toggleMenuPin()">',t+='<ons-icon  id="tombioUiSideMenuPinIcon" icon=""></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+="</ons-toolbar>",t+='<div id="tombioOnsVisInputDiv"></div>',t+="</ons-page>",t+="</ons-splitter-side>",t+='<ons-splitter-content id="content" page="tombioOnsVisDisplayTemplate"></ons-splitter-content>',t+="</ons-splitter>",t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisDisplayTemplate">',t+='<ons-page id="tombioOnsVisDisplay">',t+="<ons-toolbar>";var o="";o+='<ons-toolbar-button id="tombioUiContextMenuButton" onclick="tombiovis.gui.main.openContext()">',o+='<ons-icon icon="md-more-vert"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button onclick="tombiovis.gui.main.popPage()">',o+='<ons-icon icon="md-menu"></ons-icon>',t+='<div class="left">',t+='<ons-toolbar-button id="tombioUiInputToolbarButton" onclick="tombiovis.gui.main.openMenu()">',t+='<ons-icon icon="md-keyboard"></ons-icon>',t+="</ons-toolbar-button>",t+='<div id="tombioOnsToolsLeft" style="display:none">',t+=o+="</ons-toolbar-button>",t+="</div>",t+="</div>",t+='<div id="tombioOnsToolsRight" class="right">',t+=o,t+="</div>",t+="</ons-toolbar>",t+='<div id="tombioOnsVisDisplayDiv"></div>',t+='<div id="tombioOnsOtherInfoDiv"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsDialogTemplate">',t+='<ons-page id="tombioOnsDialog">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div id="tombioOnsDialogTitle" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsDialogContent" style="margin: 1em"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsContextTemplate">',t+='<ons-page id="tombioOnsContext">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div class="center">Context menu</div>',t+="</ons-toolbar>",t+='<ons-list id="tombioOnsContextContent"></ons-list>',t+="</ons-page>",t+="</template>",t+='<template id="refreshPromptTemplate">',t+='<ons-alert-dialog id="refreshPrompt" modifier="rowfooter">',t+='<div class="alert-dialog-title">Refresh required</div>',t+='<div class="alert-dialog-content">',t+="To complete preparation for using offline, a refresh is required.",t+="</div>",t+='<div class="alert-dialog-footer">',t+='<ons-alert-dialog-button onclick="tombiovis.gui.main.fn.refreshDialogDismissed()">Not now</ons-alert-dialog-button>',t+='<ons-alert-dialog-button onclick="tombiovis.gui.main.fn.refreshDialogDismissed(true)">Refresh</ons-alert-dialog-button>',t+="</div>",t+="</ons-alert-dialog>",t+="</template>",u("#tombioOns").append(u(t)),d.gui.main.fn.refreshDialogDismissed=function(t){document.getElementById("refreshPrompt").hide(),t&&(console.log("Refresh",t),window.location.reload())},d.gui.main.openMenu=function(){document.getElementById("tombioOnsMenu").open()},d.gui.main.openContext=function(){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsContextTemplate").then(function(){!function(){var t=[];for(var o in d.gui.main.contextMenu.items){var e=!0;-1==d.gui.main.contextMenu.visContexts[o].indexOf(d.v.currentTool)&&(e=!1),d.gui.main.contextMenu.guiContexts[o]&&-1==d.gui.main.contextMenu.guiContexts[o].indexOf(d.opts.gui)&&(e=!1),e&&(d.gui.main.contextMenu.items[o].on("click",d.gui.main.popPage),d.gui.main.contextMenu.items[o].on("click",d.gui.main.contextMenu.functions[o]),t.push(d.gui.main.contextMenu.items[o]))}u("#tombioOnsContextContent").html(""),u("#tombioOnsContextContent").append(t)}()})},d.gui.main.popPage=function(){document.querySelector("#tombioOnsNavigator").popPage().then(function(){}).catch(function(){})},document.addEventListener("init",function(t){var o=t.target;"tombioOnsToolSelect"===o.id?d.gui.main.createUIControls(!0):"tombioOnsVisDisplay"===o.id?(u("#tombioOnsVisDisplayDiv").append(u("#tombioOnsHiddenVisualisation")),u("#tombioOnsHiddenVisualisation").show()):"tombioOnsVisInput"===o.id&&(u("#tombioOnsVisInputDiv").append(u("#tombioOnsHiddenControls")),u("#tombioOnsHiddenControls").show(),document.querySelector("#tombioUiSideMenuBackButton").onClick=function(t){document.getElementById("tombioOnsMenu").close()})}),document.addEventListener("destroy",function(t){"tombioOnsVisualisation"===t.target.id&&(u("#tombioOnsHiddenVisualisation").hide(),u("#tombiod3vis").append(u("#tombioOnsHiddenVisualisation")),u("#tombioOnsHiddenControls").hide(),u("#tombiod3vis").append(u("#tombioOnsHiddenControls")))}),document.addEventListener("show",function(t){t.target}),document.addEventListener("hide",function(t){t.target}),ons.orientation.on("change",function(){console.log("Orientation changed"),r(),function(){0<u("#tombioOnsFullDetailsTab3").length&&u("#tombioNbnMapImage").css("height",u("#tombioOnsFullDetailsTab3").height()-10);0<u("#tombioOnsFullDetailsTab2").length&&u(".tombio-galleria-pane").data("galleria").resize({height:u("#tombioOnsFullDetailsTab2").height()})}(),setTimeout(function(){d.f.refreshVisualisation(),i()},1e3)}),d.f.checkInterface("guiOnsenUi",d.templates.gui.main,d.gui.main)},d.gui.main.createUIControls=function(){var i=[];if((d.opts.checkKB||d.opts.devel)&&i.push(u("<ons-list-header>For developers</ons-list-header>")),n='<div class="left"><ons-icon icon="md-wrench" class="list-item__icon"></ons-icon></div>',d.opts.checkKB&&(i.push(u('<ons-list-item value="reloadkb" class="html" data-class="wrench">'+n+"Reload KB</ons-list-item>")),i.push(u('<ons-list-item value="mediaFilesCheck" class="html" data-class="wrench">'+n+"Check media files</ons-list-item>")),d.d.oCharacters.TVK&&i.push(u('<ons-list-item value="tvkCheck" class="html" data-class="wrench">'+n+"Check TVKs</ons-list-item>"))),n='<div class="left"><ons-icon icon="md-lamp" class="list-item__icon"></ons-icon></div>',i.push(u("<ons-list-header>Visualisations</ons-list-header>")),d.v.includedVisualisations.forEach(function(t,o){var e=u("<ons-list-item>").attr("value",t).attr("data-class","vis").text(d.js.jsFiles[t].toolName);e.append(u(n)),i.push(e)}),i.push(u("<ons-list-header>Help &amp; Information</ons-list-header>")),n='<div class="left"><ons-icon icon="md-info" class="list-item__icon"></ons-icon></div>',i.push(u('<ons-list-item id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info">'+n+"Using the...</ons-list-item>")),i.push(u('<ons-list-item value="kbInfo" class="html" data-class="info">'+n+"About the Knowledge-base</ons-list-item>")),i.push(u('<ons-list-item value="visInfo" class="html" data-class="info">'+n+"About FSC Identikit</ons-list-item>")),i.push(u('<ons-list-item value="tombioCitation" class="html" data-class="info">'+n+"Get citation text</ons-list-item>")),i.push(u('<ons-list-item id="optPdfInfo" style="display: none">'+n+'<a href="'+d.opts.tombiokbpath+'info.pdf">About this resource PDF</a></ons-list-item>')),u.ajax({type:"HEAD",url:d.opts.tombiokbpath+"info.pdf",success:function(t){u("#optPdfInfo").show()}}),i.push(u("<ons-list-header>Other</ons-list-header>")),d.opts.pwa){var n='<div class="left"><ons-icon icon="md-download" class="list-item__icon"></ons-icon></div>';i.push(u('<ons-list-item value="offline" class="html" data-class="?">'+n+"Offline options</ons-list-item>"))}n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>';i.push(u('<ons-list-item value="reload" class="html" data-class="reload">'+n+"Reload app</ons-list-item>")),i.forEach(function(t){"ons-list-item"==t.prop("tagName").toLowerCase()&&(o[t.attr("value")]=t.text(),t.on("click",function(){d.v.selectedTool=t.attr("value"),d.f.visChanged(d.v.selectedTool)}))}),u("#tombioOnsTools").append(i)},d.gui.main.visShow=function(m){var t=document.querySelector("#tombioOnsVisualisationTemplate").content.querySelector("#tombioOnsMenu");e?t.removeAttribute("collapse"):t.setAttribute("collapse",""),document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsVisualisationTemplate").then(function(){u("#tombioOnsOtherInfoDiv").html(null);var o;d.v.visualisations[m];"tombioCitation"==m&&u("#tombioOnsOtherInfoDiv").html(((e=u("<div>")).append(u("<h3>").text("Citation for FSC Identikit (core software)")),t="This is the reference you can use for the FSC Identikit - in other words the core software.",t+=" The core version number is updated whenever there is a new major release of the core software.",e.append(u("<p>").html(t)),e.append(u("<b>").html(d.f.getCitation(d.d.softwareMetadata,"Software"))),e.append(u("<h3>").text("Citation for knowledge-base")),t="This is the reference you can use for the knowledge-base currently driving the software.",t+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.",e.append(u("<p>").html(t)),e.append(u("<b>").html(d.f.getCitation(d.d.kbmetadata,"Knowledge-base",d.d.softwareMetadata.title))),e));var t,e;"mediaFilesCheck"==m&&u("#tombioOnsOtherInfoDiv").html(d.f.createMediaCheckPage());"tvkCheck"==m&&u("#tombioOnsOtherInfoDiv").html(d.f.createTvkCheckPage());"kbInfo"==m&&d.f.setKbInfo(u("#tombioOnsOtherInfoDiv"));"visInfo"==m&&d.f.setVisInfo(u("#tombioOnsOtherInfoDiv"));"currentVisInfo"==m&&(u("#tombioOnsOtherInfoDiv").html(""),d.f.setSelectedToolInfo(u("#tombioOnsOtherInfoDiv")));m!=d.v.currentTool&&(d.v.currentTool&&(d.v.visualisations[d.v.currentTool]?d.v.visualisations[d.v.currentTool].hide():u("#"+d.v.currentTool).hide()),d.v.visualisations[m]?d.v.visualisations[m].show():u("#"+m).show());d.f.refreshVisualisation(),d.v.currentTool=m,-1<Object.keys(d.v.visualisations).indexOf(m)&&(d.v.lastVis=m,u("#optCurrentVisInfo>div.center").text("Using the "+d.v.visualisations[d.v.lastVis].metadata.title));-1<d.v.includedVisualisations.indexOf(m)?(u("#tombioOnsVisDisplayDiv").show(),u("#tombioOnsOtherInfoDiv").hide()):(u("#tombioOnsVisDisplayDiv").hide(),u("#tombioOnsOtherInfoDiv").show());if(r(),!d.v.initialised&&d.v.visualisations[m]){for(var i={},n=decodeURI(window.location.search.substring(1)).replace(/\+/g," "),s=n.split("&"),a=0;a<s.length;a++){var l=s[a].split("=");i[l[0]]=l[1]}d.v.visualisations[m].urlParams(i),d.v.initialised=!0}console.log(m),Object.keys(d.gui.main.contextMenu.items).forEach(function(t){console.log(d.gui.main.contextMenu.visContexts[t]),-1!=d.gui.main.contextMenu.visContexts[t].indexOf(m)&&(o=!0)}),o?u("ons-toolbar-button#tombioUiContextMenuButton.toolbar-button").show():u("ons-toolbar-button#tombioUiContextMenuButton.toolbar-button").hide()})},d.gui.main.dialog=function(t,o){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsDialogTemplate").then(function(){u("#tombioOnsDialogTitle").text(t),u("#tombioOnsDialogContent").html(o)})},d.gui.main.createCharacterTooltips=function(t){},d.gui.main.createTaxonToolTips=function(t,o){},d.gui.main.tooltip=function(t){},d.gui.main.showFullDetails=function(t,o,e,i){if(0==u("#tombioOnsFullDetailsTemplate").length){var s="";s+='<template id="tombioOnsFullDetailsTemplate">',s+='<ons-page id="tombioOnsFullDetails">',s+="<ons-toolbar>",s+='<div class="left">',s+="<ons-back-button></ons-back-button>",s+="</div>",s+='<div id="tombioOnsFullDetailsTitle" class="center"></div>',s+="</ons-toolbar>",s+='<ons-tabbar id="tombioOnsFullDetailsTabBar" swipeable position="auto">',s+='<ons-tab page="tombioOnsFullDetailsTab1Template" label="Knowledge" icon="md-grid" active>',s+="</ons-tab>",s+='<ons-tab page="tombioOnsFullDetailsTab2Template" label="Images" icon="md-image">',s+="</ons-tab>",d.d.oCharacters.TVK&&(s+='<ons-tab page="tombioOnsFullDetailsTab3Template" label="NBN Atlas" icon="md-map">',s+="</ons-tab>"),s+='<ons-tab page="tombioOnsFullDetailsTab4Template" label="Info" icon="md-file-text">',s+="</ons-tab>",s+="</ons-tabbar>",s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab1Template">',s+='<ons-page id="tombioOnsFullDetailsTab1">',s+='<div id="tombioOnsFullDetailsTab1Content" style="margin: 1em"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab2Template">',s+='<ons-page id="tombioOnsFullDetailsTab2">',s+='<div id="tombioOnsFullDetailsTab2Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab3Template">',s+='<ons-page id="tombioOnsFullDetailsTab3">',s+='<div id="tombioOnsFullDetailsTab3Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab4Template">',s+='<ons-page id="tombioOnsFullDetailsTab4">',s+='<div id="tombioOnsFullDetailsTab4Content"></div>',s+="</ons-page>",s+="</template>",u("#tombioOns").append(u(s)),document.addEventListener("show",function(t){var o=document.querySelector("#tombioOnsNavigator").topPage.data.taxon,e=document.querySelector("#tombioOnsNavigator").topPage.data.tab;u("#tombioOnsFullDetailsTitle").html("<i>"+o+"</i>"),t.target.matches("#tombioOnsFullDetailsTab1")&&u("#tombioOnsFullDetailsTab1Content").html(d.f.getTaxonCharacterValues(d.d.oTaxa[o])),t.target.matches("#tombioOnsFullDetailsTab2")&&(u("#tombioOnsFullDetailsTab2Content").html(""),u("#tombioOnsFullDetailsTab2Content").attr("data-taxon",o),d.f.addTaxonImagesToContainer({taxon:o,container:u("#tombioOnsFullDetailsTab2Content"),height:u("#tombioOnsFullDetailsTab2").css("height")})),t.target.matches("#tombioOnsFullDetailsTab3")&&(u("#tombioOnsFullDetailsTab3Content").html(""),d.f.addNBNMapToContainer(d.d.oTaxa[o].TVK,u("#tombioOnsFullDetailsTab3Content")),u("#tombioNbnMapImage").css("height",u("#tombioOnsFullDetailsTab3").height()-10)),t.target.matches("#tombioOnsFullDetailsTab4")&&(u("#tombioOnsFullDetailsTab4Content").html(""),function(o,t){var e=u("<div>").css("margin","10px").appendTo(t),i=d.f.getTaxonHtmlFiles(o);if(0==i.length)e.text("No text information files (HTML) are specified in the knowledge-base for this taxon.");else{var n=u("<div>");1<i.length&&(s='<ons-select onchange="tombiovis.gui.main.textFileSelect(event)">',i.forEach(function(t,o){s+='<option value="'+o+'">',s+=t.Caption,s+="</option>"}),s+="</ons-select>",e.html(s)),n.appendTo(e),d.f.addTaxonHtmlToContainer(o,n,0),d.gui.main.textFileSelect=function(t){d.f.addTaxonHtmlToContainer(o,n,t.target.value)}}}(o,u("#tombioOnsFullDetailsTab4Content"))),t.target.matches("#tombioOnsFullDetails")&&e&&document.querySelector("#tombioOnsFullDetailsTabBar").setActiveTab(e)},!1)}document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsFullDetailsTemplate",{data:{taxon:t,tab:o}}).then(function(){})},d.gui.main.fn.toggleMenuPin=function(){(e=!e)?u("#tombioOnsMenu").removeAttr("collapse"):u("#tombioOnsMenu").attr("collapse",""),i(),r(),d.f.refreshVisualisation()},d.gui.main.contextMenu={items:{},functions:{},visContexts:{},guiContexts:{}},d.gui.main.contextMenu.addItem=function(t,o,e,i,n){if(e&&t in d.gui.main.contextMenu.items&&(d.gui.main.contextMenu.items[t].remove(),delete d.gui.main.contextMenu.items[t],delete d.gui.main.contextMenu.functions[t],delete d.gui.main.contextMenu.visContexts[t],delete d.gui.main.contextMenu.guiContexts[t]),!(t in d.gui.main.contextMenu.items)){var s=u('<ons-list-item><div class="left"><ons-icon icon="md-caret-right" class="list-item__icon"></ons-icon></div>'+t+"</ons-list-item>");d.gui.main.contextMenu.items[t]=s,d.gui.main.contextMenu.visContexts[t]=i,d.gui.main.contextMenu.guiContexts[t]=n,d.gui.main.contextMenu.functions[t]=o}},d.gui.main.contextMenu.removeItem=function(t){t in d.gui.main.contextMenu.items&&(delete d.gui.main.contextMenu.items[t],delete d.gui.main.contextMenu.functions[t],delete d.gui.main.contextMenu.visContexts[t],delete d.gui.main.contextMenu.guiContexts[t])},d.gui.main.fn.requestFullscreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),u("#tombioUiFullscreenMenuButton").hide(),u("#tombioUiExitFullscreenMenuButton").show()},d.gui.main.fn.exitFullscreen=function(){console.log("exit fullscreen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),u("#tombioUiFullscreenMenuButton").show(),u("#tombioUiExitFullscreenMenuButton").hide()}}(jQuery,this.tombiovis);