!function(m,u){"use strict";var i,o={};function c(){var t,o=u.v.visualisations[u.v.currentTool];t=o&&o.inputControl?o.inputControl.width:o&&o.taxonSelect?o.taxonSelect.width:230,m("#tombioOnsMenu").css("width",t),i?(-1<u.v.includedVisualisations.indexOf(u.v.currentTool)?(m("ons-splitter-content").css("left",t),m("ons-splitter-side").show()):(m("ons-splitter-content").css("left","0px"),m("ons-splitter-side").hide()),m("#tombioUiSideMenuBackButton").hide(),m("#tombioUiSideMenuPinIcon").attr("icon","md-pin")):(m("#tombioUiSideMenuBackButton").show(),m("#tombioUiSideMenuPinIcon").attr("icon","md-pin-off")),-1<u.v.includedVisualisations.indexOf(u.v.currentTool)?i?m("#tombioUiInputToolbarButton").hide():m("#tombioUiInputToolbarButton").show():m("#tombioUiInputToolbarButton").hide()}u.gui.main={fn:{}},u.gui.main.setSelectedTool=function(t){},u.gui.main.resizeControlsAndTaxa=function(){},u.gui.main.init=function(){"(max-width: 979px)",i=!window.matchMedia("(max-width: 979px)").matches,m("#tombiod3vis").html(""),m("<div>").attr("id","tombioOnsHiddenVisualisation").hide().appendTo("#tombiod3vis"),m("<div>").attr("id","tombioOnsHiddenControls").hide().appendTo("#tombiod3vis"),u.gui.main.divVis="#tombioOnsHiddenVisualisation",u.gui.main.divInput="#tombioOnsHiddenControls",m("<div>").attr("id","tombioOns").appendTo(m("#tombiod3vis"));var t="";t+='<ons-navigator swipeable id="tombioOnsNavigator" page="tombioOnsSelectTemplate"></ons-navigator>',t+='<template id="tombioOnsSelectTemplate">',t+='<ons-page id="tombioOnsToolSelect">',t+="<ons-toolbar>",t+='<div class="center">'+u.d.kbmetadata.title+"</div>",t+="</ons-toolbar>",t+='<ons-list id="tombioOnsTools"></ons-list>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisualisationTemplate">',t+='<ons-page id="tombioOnsVisualisation">',t+="<ons-splitter>",t+='<ons-splitter-side id="tombioOnsMenu" side="left" collapse swipeable>',t+='<ons-page id="tombioOnsVisInput">',t+="<ons-toolbar>",t+='<div class="left">',t+='<ons-back-button id="tombioUiSideMenuBackButton"></ons-back-button>',t+="</div>",t+='<div class="right">',t+='<ons-toolbar-button id="tombioUiSideMenuPin" onclick="tombiovis.gui.main.fn.toggleMenuPin()">',t+='<ons-icon  id="tombioUiSideMenuPinIcon" icon=""></ons-icon>',t+="</ons-toolbar-button>",t+="</div>",t+="</ons-toolbar>",t+='<div id="tombioOnsVisInputDiv"></div>',t+="</ons-page>",t+="</ons-splitter-side>",t+='<ons-splitter-content id="content" page="tombioOnsVisDisplayTemplate"></ons-splitter-content>',t+="</ons-splitter>",t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsVisDisplayTemplate">',t+='<ons-page id="tombioOnsVisDisplay">',t+="<ons-toolbar>";var o="";o+='<ons-toolbar-button id="tombioUiFullscreenMenuButton" onclick="tombiovis.gui.main.fn.requestFullscreen()">',o+='<ons-icon icon="md-fullscreen"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button id="tombioUiExitFullscreenMenuButton" onclick="tombiovis.gui.main.fn.exitFullscreen()" style="display: none">',o+='<ons-icon icon="md-fullscreen-exit"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button id="tombioUiContextMenuButton" onclick="tombiovis.gui.main.openContext()">',o+='<ons-icon icon="md-more-vert"></ons-icon>',o+="</ons-toolbar-button>",o+='<ons-toolbar-button onclick="tombiovis.gui.main.popPage()">',o+='<ons-icon icon="md-menu"></ons-icon>',t+='<div class="left">',t+='<ons-toolbar-button id="tombioUiInputToolbarButton" onclick="tombiovis.gui.main.openMenu()">',t+='<ons-icon icon="md-keyboard"></ons-icon>',t+="</ons-toolbar-button>",t+='<div id="tombioOnsToolsLeft" style="display:none">',t+=o+="</ons-toolbar-button>",t+="</div>",t+="</div>",t+='<div id="tombioOnsToolsRight" class="right">',t+=o,t+="</div>",t+="</ons-toolbar>",t+='<div id="tombioOnsVisDisplayDiv"></div>',t+='<div id="tombioOnsOtherInfoDiv"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsDialogTemplate">',t+='<ons-page id="tombioOnsDialog">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div id="tombioOnsDialogTitle" class="center"></div>',t+="</ons-toolbar>",t+='<div id="tombioOnsDialogContent" style="margin: 1em"></div>',t+="</ons-page>",t+="</template>",t+='<template id="tombioOnsContextTemplate">',t+='<ons-page id="tombioOnsContext">',t+="<ons-toolbar>",t+='<div class="left">',t+="<ons-back-button></ons-back-button>",t+="</div>",t+='<div class="center">Context menu</div>',t+="</ons-toolbar>",t+='<ons-list id="tombioOnsContextContent"></ons-list>',t+="</ons-page>",t+="</template>",m("#tombioOns").append(m(t)),u.gui.main.openMenu=function(){document.getElementById("tombioOnsMenu").open()},u.gui.main.openContext=function(){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsContextTemplate").then(function(){!function(){var t=[];for(var o in u.gui.main.contextMenu.items){var i=!0;-1==u.gui.main.contextMenu.visContexts[o].indexOf(u.v.currentTool)&&(i=!1),u.gui.main.contextMenu.guiContexts[o]&&-1==u.gui.main.contextMenu.guiContexts[o].indexOf(u.opts.gui)&&(i=!1),i&&(u.gui.main.contextMenu.items[o].on("click",u.gui.main.popPage),u.gui.main.contextMenu.items[o].on("click",u.gui.main.contextMenu.functions[o]),t.push(u.gui.main.contextMenu.items[o]))}m("#tombioOnsContextContent").html(""),m("#tombioOnsContextContent").append(t)}()})},u.gui.main.popPage=function(){document.querySelector("#tombioOnsNavigator").popPage().then(function(){}).catch(function(){})},document.addEventListener("init",function(t){var o=t.target;"tombioOnsToolSelect"===o.id?u.gui.main.createUIControls(!0):"tombioOnsVisDisplay"===o.id?(m("#tombioOnsVisDisplayDiv").append(m("#tombioOnsHiddenVisualisation")),m("#tombioOnsHiddenVisualisation").show()):"tombioOnsVisInput"===o.id&&(m("#tombioOnsVisInputDiv").append(m("#tombioOnsHiddenControls")),m("#tombioOnsHiddenControls").show(),document.querySelector("#tombioUiSideMenuBackButton").onClick=function(t){document.getElementById("tombioOnsMenu").close()})}),document.addEventListener("destroy",function(t){"tombioOnsVisualisation"===t.target.id&&(m("#tombioOnsHiddenVisualisation").hide(),m("#tombiod3vis").append(m("#tombioOnsHiddenVisualisation")),m("#tombioOnsHiddenControls").hide(),m("#tombiod3vis").append(m("#tombioOnsHiddenControls")))}),document.addEventListener("show",function(t){t.target}),document.addEventListener("hide",function(t){t.target}),ons.orientation.on("change",function(){c(),function(){0<m("#tombioOnsFullDetailsTab3").length&&m("#tombioNbnMapImage").css("height",m("#tombioOnsFullDetailsTab3").height()-10);0<m("#tombioOnsFullDetailsTab2").length&&m(".tombio-galleria-pane").data("galleria").resize({height:m("#tombioOnsFullDetailsTab2").height()})}(),u.f.refreshVisualisation()}),u.f.checkInterface("guiOnsenUi",u.templates.gui.main,u.gui.main)},u.gui.main.createUIControls=function(){var e=[],n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>';e.push(m('<ons-list-item value="reload" class="html" data-class="reload">'+n+"Reload</ons-list-item>")),n='<div class="left"><ons-icon icon="md-lamp" class="list-item__icon"></ons-icon></div>',e.push(m("<ons-list-header>Visualisations</ons-list-header>")),u.v.includedVisualisations.forEach(function(t,o){var i=m("<ons-list-item>").attr("value",t).attr("data-class","vis").text(u.js.jsFiles[t].toolName);i.append(m(n)),e.push(i)}),e.push(m("<ons-list-header>Help &amp; Information</ons-list-header>")),n='<div class="left"><ons-icon icon="md-info" class="list-item__icon"></ons-icon></div>',e.push(m('<ons-list-item id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info">'+n+"Using the...</ons-list-item>")),e.push(m('<ons-list-item value="kbInfo" class="html" data-class="info">'+n+"About the Knowledge-base</ons-list-item>")),e.push(m('<ons-list-item value="visInfo" class="html" data-class="info">'+n+"About FSC Identikit</ons-list-item>")),e.push(m('<ons-list-item value="tombioCitation" class="html" data-class="info">'+n+"Get citation text</ons-list-item>")),(u.opts.checkKB||u.opts.devel)&&e.push(m("<ons-list-header>For developers</ons-list-header>")),u.opts.checkKB&&(n='<div class="left"><ons-icon icon="md-wrench" class="list-item__icon"></ons-icon></div>',e.push(m('<ons-list-item value="mediaFilesCheck" class="html" data-class="wrench">'+n+"Check media files</ons-list-item>")),u.d.oCharacters.TVK&&e.push(m('<ons-list-item value="tvkCheck" class="html" data-class="wrench">'+n+"Check TVKs</ons-list-item>"))),u.opts.devel&&(n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>',e.push(m('<ons-list-item value="reloadGuiOnsen" class="html" data-class="reload">'+n+"Reload with mobile-first interface</ons-list-item>")),e.push(m('<ons-list-item value="reloadGuiJQuery" class="html" data-class="reload">'+n+"Reload with large format interface</ons-list-item>"))),e.forEach(function(t){"ons-list-item"==t.prop("tagName").toLowerCase()&&(o[t.attr("value")]=t.text(),t.on("click",function(){u.v.selectedTool=t.attr("value"),u.f.visChanged(u.v.selectedTool)}))}),m("#tombioOnsTools").append(e)},u.gui.main.visShow=function(l){var t=document.querySelector("#tombioOnsVisualisationTemplate").content.querySelector("#tombioOnsMenu");i?t.removeAttribute("collapse"):t.setAttribute("collapse",""),document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsVisualisationTemplate").then(function(){m("#tombioOnsOtherInfoDiv").html(null);u.v.visualisations[l];"tombioCitation"==l&&m("#tombioOnsOtherInfoDiv").html(((o=m("<div>")).append(m("<h3>").text("Citation for FSC Identikit (core software)")),t="This is the reference you can use for the FSC Identikit - in other words the core software.",t+=" The core version number is updated whenever there is a new major release of the core software.",o.append(m("<p>").html(t)),o.append(m("<b>").html(u.f.getCitation(u.d.softwareMetadata,"Software"))),o.append(m("<h3>").text("Citation for last selected visualisation tool")),t="This is the reference you can use for the last selected visualisation tool.",t+=" The tool version number is updated whenever there is a new release of the tool.",t+=" If you cite a tool, there's no need to cite the core software separately since it is implicit.",o.append(m("<p>").html(t)),o.append(m("<b>").html(u.f.getCitation(u.v.visualisations[u.v.lastVis].metadata,"Software",u.d.softwareMetadata.title))),o.append(m("<h3>").text("Citation for knowledge-base")),t="This is the reference you can use for the knowledge-base currently driving the software.",t+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.",o.append(m("<p>").html(t)),o.append(m("<b>").html(u.f.getCitation(u.d.kbmetadata,"Knowledge-base",u.d.softwareMetadata.title))),o));var t,o;"mediaFilesCheck"==l&&m("#tombioOnsOtherInfoDiv").html(u.f.createMediaCheckPage());"tvkCheck"==l&&m("#tombioOnsOtherInfoDiv").html(u.f.createTvkCheckPage());"kbInfo"==l&&u.f.setKbInfo(m("#tombioOnsOtherInfoDiv"));"visInfo"==l&&u.f.setVisInfo(m("#tombioOnsOtherInfoDiv"));"currentVisInfo"==l&&(m("#tombioOnsOtherInfoDiv").html(""),u.f.setSelectedToolInfo(m("#tombioOnsOtherInfoDiv")));l!=u.v.currentTool&&(u.v.currentTool&&(u.v.visualisations[u.v.currentTool]?u.v.visualisations[u.v.currentTool].hide():m("#"+u.v.currentTool).hide()),u.v.visualisations[l]?u.v.visualisations[l].show():m("#"+l).show());u.f.refreshVisualisation(),u.v.currentTool=l,-1<Object.keys(u.v.visualisations).indexOf(l)&&(u.v.lastVis=l,m("#optCurrentVisInfo>div.center").text("Using the "+u.v.visualisations[u.v.lastVis].metadata.title));-1<u.v.includedVisualisations.indexOf(l)?(m("#tombioOnsVisDisplayDiv").show(),m("#tombioOnsOtherInfoDiv").hide()):(m("#tombioOnsVisDisplayDiv").hide(),m("#tombioOnsOtherInfoDiv").show());if(c(),!u.v.initialised&&u.v.visualisations[l]){for(var i={},e=decodeURI(window.location.search.substring(1)).replace(/\+/g," "),n=e.split("&"),s=0;s<n.length;s++){var a=n[s].split("=");i[a[0]]=a[1]}u.v.visualisations[l].urlParams(i),u.v.initialised=!0}})},u.gui.main.dialog=function(t,o){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsDialogTemplate").then(function(){m("#tombioOnsDialogTitle").text(t),m("#tombioOnsDialogContent").html(o)})},u.gui.main.createCharacterTooltips=function(t){},u.gui.main.createTaxonToolTips=function(t,o){},u.gui.main.tooltip=function(t){},u.gui.main.showFullDetails=function(t,o,i,e){if(0==m("#tombioOnsFullDetailsTemplate").length){var s="";s+='<template id="tombioOnsFullDetailsTemplate">',s+='<ons-page id="tombioOnsFullDetails">',s+="<ons-toolbar>",s+='<div class="left">',s+="<ons-back-button></ons-back-button>",s+="</div>",s+='<div id="tombioOnsFullDetailsTitle" class="center"></div>',s+="</ons-toolbar>",s+='<ons-tabbar id="tombioOnsFullDetailsTabBar" swipeable position="auto">',s+='<ons-tab page="tombioOnsFullDetailsTab1Template" label="Knowledge" icon="md-grid" active>',s+="</ons-tab>",s+='<ons-tab page="tombioOnsFullDetailsTab2Template" label="Images" icon="md-image">',s+="</ons-tab>",u.d.oCharacters.TVK&&(s+='<ons-tab page="tombioOnsFullDetailsTab3Template" label="NBN Atlas" icon="md-map">',s+="</ons-tab>"),s+='<ons-tab page="tombioOnsFullDetailsTab4Template" label="Info" icon="md-file-text">',s+="</ons-tab>",s+="</ons-tabbar>",s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab1Template">',s+='<ons-page id="tombioOnsFullDetailsTab1">',s+='<div id="tombioOnsFullDetailsTab1Content" style="margin: 1em"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab2Template">',s+='<ons-page id="tombioOnsFullDetailsTab2">',s+='<div id="tombioOnsFullDetailsTab2Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab3Template">',s+='<ons-page id="tombioOnsFullDetailsTab3">',s+='<div id="tombioOnsFullDetailsTab3Content"></div>',s+="</ons-page>",s+="</template>",s+='<template id="tombioOnsFullDetailsTab4Template">',s+='<ons-page id="tombioOnsFullDetailsTab4">',s+='<div id="tombioOnsFullDetailsTab4Content"></div>',s+="</ons-page>",s+="</template>",m("#tombioOns").append(m(s)),document.addEventListener("show",function(t){var o=document.querySelector("#tombioOnsNavigator").topPage.data.taxon,i=document.querySelector("#tombioOnsNavigator").topPage.data.tab;m("#tombioOnsFullDetailsTitle").html("<i>"+o+"</i>"),t.target.matches("#tombioOnsFullDetailsTab1")&&m("#tombioOnsFullDetailsTab1Content").html(u.f.getTaxonCharacterValues(u.d.oTaxa[o])),t.target.matches("#tombioOnsFullDetailsTab2")&&(m("#tombioOnsFullDetailsTab2Content").html(""),m("#tombioOnsFullDetailsTab2Content").attr("data-taxon",o),u.f.addTaxonImagesToContainer({taxon:o,container:m("#tombioOnsFullDetailsTab2Content"),height:m("#tombioOnsFullDetailsTab2").css("height")})),t.target.matches("#tombioOnsFullDetailsTab3")&&(m("#tombioOnsFullDetailsTab3Content").html(""),u.f.addNBNMapToContainer(u.d.oTaxa[o].TVK,m("#tombioOnsFullDetailsTab3Content")),m("#tombioNbnMapImage").css("height",m("#tombioOnsFullDetailsTab3").height()-10)),t.target.matches("#tombioOnsFullDetailsTab4")&&(m("#tombioOnsFullDetailsTab4Content").html(""),function(o,t){var i=m("<div>").css("margin","10px").appendTo(t),e=u.f.getTaxonHtmlFiles(o);if(0==e.length)i.text("No text information files (HTML) are specified in the knowledge-base for this taxon.");else{var n=m("<div>");1<e.length&&(s='<ons-select onchange="tombiovis.gui.main.textFileSelect(event)">',e.forEach(function(t,o){s+='<option value="'+o+'">',s+=t.Caption,s+="</option>"}),s+="</ons-select>",i.html(s)),n.appendTo(i),u.f.addTaxonHtmlToContainer(o,n,0),u.gui.main.textFileSelect=function(t){u.f.addTaxonHtmlToContainer(o,n,t.target.value)}}}(o,m("#tombioOnsFullDetailsTab4Content"))),t.target.matches("#tombioOnsFullDetails")&&i&&document.querySelector("#tombioOnsFullDetailsTabBar").setActiveTab(i)},!1)}document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsFullDetailsTemplate",{data:{taxon:t,tab:o}}).then(function(){})},u.gui.main.fn.toggleMenuPin=function(){(i=!i)?m("#tombioOnsMenu").removeAttr("collapse"):m("#tombioOnsMenu").attr("collapse",""),console.log("vis width",m("#tombioOnsVisDisplay").width()),m("#tombioOnsVisDisplay").width()<208?(m("#tombioOnsToolsRight").hide(),m("#tombioOnsToolsLeft").show()):(m("#tombioOnsToolsRight").show(),m("#tombioOnsToolsLeft").hide()),c(),u.f.refreshVisualisation()},u.gui.main.contextMenu={items:{},functions:{},visContexts:{},guiContexts:{}},u.gui.main.contextMenu.addItem=function(t,o,i,e,n){if(i&&t in u.gui.main.contextMenu.items&&(u.gui.main.contextMenu.items[t].remove(),delete u.gui.main.contextMenu.items[t],delete u.gui.main.contextMenu.functions[t],delete u.gui.main.contextMenu.visContexts[t],delete u.gui.main.contextMenu.guiContexts[t]),!(t in u.gui.main.contextMenu.items)){var s=m('<ons-list-item><div class="left"><ons-icon icon="md-caret-right" class="list-item__icon"></ons-icon></div>'+t+"</ons-list-item>");u.gui.main.contextMenu.items[t]=s,u.gui.main.contextMenu.visContexts[t]=e,u.gui.main.contextMenu.guiContexts[t]=n,u.gui.main.contextMenu.functions[t]=o}},u.gui.main.contextMenu.removeItem=function(t){t in u.gui.main.contextMenu.items&&(delete u.gui.main.contextMenu.items[t],delete u.gui.main.contextMenu.functions[t],delete u.gui.main.contextMenu.visContexts[t],delete u.gui.main.contextMenu.guiContexts[t])},u.gui.main.fn.requestFullscreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),m("#tombioUiFullscreenMenuButton").hide(),m("#tombioUiExitFullscreenMenuButton").show()},u.gui.main.fn.exitFullscreen=function(){console.log("exit fullscreen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),m("#tombioUiFullscreenMenuButton").show(),m("#tombioUiExitFullscreenMenuButton").hide()}}(jQuery,this.tombiovis);