if(function(n){"use strict";function s(){function u(n){if(n[Object.keys(n)[0]]!=""&&n[Object.keys(n)[0]].substr(0,1)!="#"){for(var t in n)n.hasOwnProperty(t)&&(n[t]=n[t]?n[t].trim():"",n[t]=="?"&&(n[t]=""));return n}return null}var r="none",i=[],t;return t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"taxa.csv?"+r,function(n){return u(n)},function(i){n.d.taxa=i;console.log("%cLoading - kb taxa loaded","color: blue");t()})}),i.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"characters.csv?"+r,function(n){return u(n)},function(i){n.d.characters=i;console.log("%cLoading - kb characters loaded","color: blue");t()})}),i.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"values.csv?"+r,function(n){return u(n)},function(i){n.d.values=i;console.log("%cLoading - kb values loaded","color: blue");t()})}),i.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"media.csv?"+r,function(n){return u(n)},function(i){n.d.media=i;console.log("%cLoading - kb media loaded","color: blue");t()})}),i.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"config.csv?"+r,function(n){return u(n)},function(i){n.d.config=i;n.d.kbconfig={};n.d.kbmetadata={};n.d.kbreleaseHistory=[];var r=[];i.forEach(function(t){var i;t.Type=="config"&&(n.d.kbconfig[t.Key]=t.Value);n.opts.selectedTool;t.Key=="excludedDefaultTools"&&t.Value.trim()!=""&&(i=t.Value.split(","),i.forEach(function(n){r.push(n.trim())}));t.Key=="otherIncludedTools"&&t.Value.trim()!=""&&(i=t.Value.split(","),i.forEach(function(t){n.v.includedVisualisations.push(t.trim())}));t.Type=="metadata"&&(n.d.kbmetadata[t.Key]=t.Value);t.Key=="release"&&n.d.kbreleaseHistory.push(t)});f.forEach(function(t){r.indexOf(t)==-1&&n.v.includedVisualisations.push(t)});n.opts.tools&&Array.isArray(n.opts.tools)&&n.opts.tools.length>0&&(n.v.includedVisualisations=n.opts.tools);console.log("%cLoading - kb config loaded","color: blue");t()})}),i.push(t),Promise.all(i).then(function(){console.log("%cKB is loaded!","color: blue")})}function o(t){if(n.opts.devel)return t;var i=t.lastIndexOf("."),u=t.substr(i+1),r=t.substr(0,i);return r.endsWith(".min")?t:r+".min."+u}function h(n){var t=n.split("/");return t[t.length-1]}function i(i,r){if(n.opts.toolconfig[i]||(n.opts.toolconfig[i]={}),t[i].requiresFirst||(t[i].requiresFirst=[]),r)n.opts.toolconfig[i].keyinput||(n.opts.toolconfig[i].keyinput=n.opts.toolconfig.defaultKeyinput?n.opts.toolconfig.defaultKeyinput:"keyInput"),t[i].requiresFirst.push(n.opts.toolconfig[i].keyinput)}var u,r,f,t,e;window.console||(window.console={log:function(){}});n.opts||(n.opts={});n.opts.toolconfig||(n.opts.toolconfig={});typeof tombiover!="undefined"&&(n.opts.tombiover=tombiover);typeof tombiopath!="undefined"&&(n.opts.tombiopath=tombiopath);typeof tombiokbpath!="undefined"&&(n.opts.tombiokbpath=tombiokbpath);u=new URLSearchParams(window.location.search);r=u.get("gui");r&&(n.opts.gui=r);n.f={};n.d={};n.d.nbnMapCache={};n.d.scoreColours=["#fc8d59","#ffffbf","#91bfdb"];n.v={};n.v.visualisations={};n.js={};n.gui={};n.gui.sharedKeyInput={};n.d.softwareMetadata={title:"FSC Identikit",year:"2018",authors:"Burkmar, R.",publisher:"Field Studies Council",location:"Shrewsbury, England",contact:"r.burkmar@field-studies-council.org",version:"1.7.1"};f=["vis1","vis2","vis5","vis4","vis3"];n.v.includedVisualisations=[];t=n.js.jsFiles={add:function(t,i,r){n.js.jsFiles[t]=Object.create(e);n.js.jsFiles[t].init(t,i,r)},asArray:function(){var t=[];for(var i in n.js.jsFiles)n.js.jsFiles.hasOwnProperty(i)&&t.push(n.js.jsFiles[i]);return t}};e={init:function(t,i,r){this.id=t;this.file=o(n.opts.tombiopath+i);this.requires=[];this.requiresFirst=[];this.css=[];this.toolName=r},addCSS:function(t){this.css.push(o(n.opts.tombiopath+t))},loadJs:function(n,i){var r,u,f;if(!this.p){r=this.id;u=[];this.requires.forEach(function(n){u.push(t[n].loadJs(r,!1))});f=[];this.requiresFirst.forEach(function(n){f.push(t[n].loadJs(r,!0))});var o=this.file,s=this.css,e=this.initF;this.p=Promise.all(f).then(function(){var t=new Promise(function(t,u){var f=document.createElement("script");f.src=o;f.onreadystatechange=f.onload=function(){if(!f.readyState||/loaded|complete/.test(f.readyState)){var o="";n&&(o=i?" (req before "+n+")":" (req by "+n+")");console.log("%cLoaded JS file for "+r+o,"color: blue");e&&e();s.forEach(function(n){var t=document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=n;document.querySelector("head").appendChild(t);console.log("%cLoaded CSS file "+h(n),"color: green")});t()}else console.log("%cFiled to load JS file for "+r,"color: red"),u()};document.querySelector("head").appendChild(f)});return u.push(t),Promise.all(u)})}return this.p}};n.f.showDownloadSpinner=function(){var n=document.createElement("div"),t,i,r;n.id="downloadspin";t=document.getElementById("tombiod3");t.insertBefore(n,t.firstChild);i={lines:13,length:28,width:14,radius:42,scale:.8,corners:1,color:"#000",opacity:.15,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"49%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};r=new Spinner(i).spin(n)};n.f.hideDownloadSpinner=function(){var n=document.getElementById("tombiod3"),t=document.getElementById("downloadspin");n.removeChild(t)};t.add("spinner","dependencies/spin.min.js");t.add("jquery","dependencies/jquery-3.1.1/jquery-3.1.1.min.js");t.add("d3","dependencies/d3-4.10.0/d3.v4.min.js");t.add("jqueryui","dependencies/jquery-ui-1.12.1/jquery-ui.min.js");t.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.min.css");t.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.theme.min.css");t.jqueryui.addCSS("css/jquery-ui-tombio.css");t.add("zoomMaster","dependencies/zoom-master/jquery.zoom.min.js");t.add("galleria","dependencies/galleria-1.5.7/galleria/galleria-1.5.7.min.js");t.galleria.addCSS("dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.css");t.galleria.initF=function(){Galleria.loadTheme(n.opts.tombiopath+"dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.min.js");Galleria.on("image",function(n){$(n.imageTarget).parent().zoom({on:"grab"})})};t.add("mousewheel","dependencies/jquery.mousewheel.min.js");t.add("hammer","dependencies/hammer.min.js");t.add("pqselect","dependencies/pqselect-1.3.2/pqselect.min.js");t.pqselect.addCSS("dependencies/pqselect-1.3.2/pqselect.min.css");t.pqselect.requiresFirst=["jqueryui"];t.add("pqgrid","dependencies/pqgrid-2.1.0/pqgrid.min.js");t.pqgrid.addCSS("dependencies/pqgrid-2.1.0/pqgrid.min.css");t.pqgrid.requiresFirst=["jqueryui"];t.add("keyinputTemplate","keyinputTemplate.js?ver="+n.opts.tombiover);t.add("keyInput","keyinput.js?ver="+n.opts.tombiover);t.keyInput.addCSS("css/keyinput.css");t.keyInput.requires=["pqselect","jqueryui"];t.add("keyInputBasic","keyinputBasic.js?ver="+n.opts.tombiover);t.keyInputBasic.addCSS("css/keyinputbasic.css");t.add("tombiovis","tombiovis.js?ver="+n.opts.tombiover);t.tombiovis.addCSS("css/tombiovis.css");t.tombiovis.requires=["kbchecks"];t.add("kbchecks","kbchecks.js?ver="+n.opts.tombiover);t.add("score","score.js?ver="+n.opts.tombiover);t.add("taxonselect","taxonselect.js?ver="+n.opts.tombiover);t.taxonselect.addCSS("css/taxonselect.css");t.taxonselect.requires=["jqueryui"];t.add("visP","visP.js?ver="+n.opts.tombiover);t.visP.requires=["mousewheel","galleria","zoomMaster"];t.add("guiTemplate","guiTemplate.js?ver="+n.opts.tombiover);t.add("guiLargeJqueryUi","guiLargeJqueryUi.js?ver="+n.opts.tombiover);t.guiLargeJqueryUi.addCSS("css/guiLargeJqueryUi.css");t.guiLargeJqueryUi.requires=["jqueryui"];t.add("guiLarge","guiLarge.js?ver="+n.opts.tombiover);t.guiLarge.addCSS("css/guiLarge.css");t.add("guiOnsenUi","guiOnsenUi.js?ver="+n.opts.tombiover);t.guiOnsenUi.addCSS("css/guiOnsenUi.css");t.guiOnsenUi.requiresFirst=["onsenui"];t.add("onsenui","dependencies/onsenui-2.10.3/js/onsenui.js");t.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsenui.css");t.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsen-css-components.min.css");t.onsenui.addCSS("dependencies/onsenui-2.10.3/css/onsenui-fonts.css");t.add("visTemplate","visTemplate/visTemplate.js?ver="+n.opts.tombiover);t.visTemplate.requiresFirst=["visP"];t.add("vis1","vis1/vis1.js?ver="+n.opts.tombiover,"Two-column key");t.vis1.addCSS("vis1/vis1.css");t.vis1.requiresFirst=["visP"];t.vis1.requires=["score"];i("vis1",!0);t.add("vis2","vis2/vis2.js?ver="+n.opts.tombiover,"Single-column key");t.vis2.addCSS("vis2/vis2.css");t.vis2.requiresFirst=["visP"];t.vis2.requires=["score"];i("vis2",!0);t.add("vis3","vis3/vis3.js?ver="+n.opts.tombiover,"Side by side comparison");t.vis3.addCSS("vis3/vis3.css");t.vis3.requiresFirst=["visP"];t.vis3.requires=["taxonselect","pqgrid","score"];i("vis3",!1);t.add("vis4","vis4/vis4.js?ver="+n.opts.tombiover,"Full taxon details");t.vis4.addCSS("vis4/vis4.css");t.vis4.requiresFirst=["visP"];t.vis4.requires=["taxonselect"];i("vis4",!1);t.add("vis5","vis5/vis5.js?ver="+n.opts.tombiover,"Circle-pack key");t.vis5.addCSS("vis5/vis5.css");t.vis5.requiresFirst=["visP"];t.vis5.requires=["score"];i("vis5",!0);t.add("visEarthworm2","visEarthworm2/visEarthworm2.js?ver="+n.opts.tombiover,"Bespoke earthworm key");t.visEarthworm2.addCSS("visEarthworm2/visEarthworm2.css");t.visEarthworm2.requiresFirst=["visP"];t.visEarthworm2.requires=["jqueryui","score"];n.f.startLoad=function(){t.spinner.loadJs().then(function(){return n.f.showDownloadSpinner(),Promise.all([t.d3.loadJs(),t.jquery.loadJs()])}).then(function(){return jQuery(document).ready(function(){jQuery("#tombiod3").append(jQuery('<div id="tombiod3vis">'))}),s()}).then(function(){return n.templates={gui:{main:{}}},n.templates.loading=!0,Promise.all([t.guiTemplate.loadJs(),t.visTemplate.loadJs(),t.keyinputTemplate.loadJs()])}).then(function(){n.templates.loading=!1}).then(function(){return Promise.all([t.tombiovis.loadJs()])}).then(function(){var i,r;i=n.opts.gui?n.opts.gui:"guiLargeJqueryUi";r=[t[i].loadJs()];Promise.all(r).then(function(){n.f.hideDownloadSpinner();n.f.loadcomplete()})})};n.opts.loadWait||n.f.startLoad()}(this.tombiovis?this.tombiovis:this.tombiovis={}),tombiovis.opts.devel)var v=tombiovis;