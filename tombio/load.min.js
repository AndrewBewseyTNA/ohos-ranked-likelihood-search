if(function(n){"use strict";function f(){function f(n){if(n[Object.keys(n)[0]]!=""&&n[Object.keys(n)[0]].substr(0,1)!="#"){for(var t in n)n.hasOwnProperty(t)&&(n[t]=n[t]?n[t].trim():"",n[t]=="?"&&(n[t]=""));return n}return null}var u="none",r=[],t;return t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"taxa.csv?"+u,function(n){return f(n)},function(i){n.d.taxa=i;console.log("%cLoading - kb taxa loaded","color: blue");t()})}),r.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"characters.csv?"+u,function(n){return f(n)},function(i){n.d.characters=i;console.log("%cLoading - kb characters loaded","color: blue");t()})}),r.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"values.csv?"+u,function(n){return f(n)},function(i){n.d.values=i;console.log("%cLoading - kb values loaded","color: blue");t()})}),r.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"media.csv?"+u,function(n){return f(n)},function(i){n.d.media=i;console.log("%cLoading - kb media loaded","color: blue");t()})}),r.push(t),t=new Promise(function(t){d3.csv(n.opts.tombiokbpath+"config.csv?"+u,function(n){return f(n)},function(r){n.d.config=r;n.d.kbconfig={};n.d.kbmetadata={};n.d.kbreleaseHistory=[];var u=[];r.forEach(function(t){var i;t.Type=="config"&&(n.d.kbconfig[t.Key]=t.Value);n.opts.selectedTool;t.Key=="excludedDefaultTools"&&t.Value.trim()!=""&&(i=t.Value.split(","),i.forEach(function(n){u.push(n.trim())}));t.Key=="otherIncludedTools"&&t.Value.trim()!=""&&(i=t.Value.split(","),i.forEach(function(t){n.v.includedVisualisations.push(t.trim())}));t.Type=="metadata"&&(n.d.kbmetadata[t.Key]=t.Value);t.Key=="release"&&n.d.kbreleaseHistory.push(t)});i.forEach(function(t){u.indexOf(t)==-1&&n.v.includedVisualisations.push(t)});n.opts.tools&&Array.isArray(n.opts.tools)&&n.opts.tools.length>0&&(n.v.includedVisualisations=n.opts.tools);console.log("%cLoading - kb config loaded","color: blue");t()})}),r.push(t),Promise.all(r).then(function(){console.log("%cKB is loaded!","color: blue")})}function u(t){if(n.opts.devel)return t;var i=t.lastIndexOf("."),u=t.substr(i+1),r=t.substr(0,i);return r.endsWith(".min")?t:r+".min."+u}function e(n){var t=n.split("/");return t[t.length-1]}var i,t,r;window.console||(window.console={log:function(){}});n.opts||(n.opts={});typeof tombiover!="undefined"&&(n.opts.tombiover=tombiover);typeof tombiopath!="undefined"&&(n.opts.tombiopath=tombiopath);typeof tombiokbpath!="undefined"&&(n.opts.tombiokbpath=tombiokbpath);n.f={};n.d={};n.v={};n.v.visualisations={};n.js={};n.gui={};n.d.softwareMetadata={title:"FSC Identikit",year:"2018",authors:"Burkmar, R.",publisher:"Field Studies Council",location:"Shrewsbury, England",contact:"r.burkmar@field-studies-council.org",version:"1.7.1"};i=["vis1","vis2","vis5","vis4","vis3"];n.v.includedVisualisations=[];t=n.js.jsFiles={add:function(t,i,u){n.js.jsFiles[t]=Object.create(r);n.js.jsFiles[t].init(t,i,u)},asArray:function(){var t=[];for(var i in n.js.jsFiles)n.js.jsFiles.hasOwnProperty(i)&&t.push(n.js.jsFiles[i]);return t}};r={init:function(t,i,r){this.id=t;this.file=u(n.opts.tombiopath+i);this.requires=[];this.requiresFirst=[];this.css=[];this.toolName=r},addCSS:function(t){this.css.push(u(n.opts.tombiopath+t))},loadJs:function(n,i){var r,u,f;if(!this.p){r=this.id;u=[];this.requires.forEach(function(n){u.push(t[n].loadJs(r,!1))});f=[];this.requiresFirst.forEach(function(n){f.push(t[n].loadJs(r,!0))});var s=this.file,h=this.css,o=this.initF;this.p=Promise.all(f).then(function(){var t=new Promise(function(t,u){var f=document.createElement("script");f.src=s;f.onreadystatechange=f.onload=function(){if(!f.readyState||/loaded|complete/.test(f.readyState)){var s="";n&&(s=i?" (req before "+n+")":" (req by "+n+")");console.log("%cLoaded JS file for "+r+s,"color: blue");o&&o();h.forEach(function(n){var t=document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=n;document.querySelector("head").appendChild(t);console.log("%cLoaded CSS file "+e(n),"color: green")});t()}else console.log("%cFiled to load JS file for "+r,"color: red"),u()};document.querySelector("head").appendChild(f)});return u.push(t),Promise.all(u)})}return this.p}};n.f.showDownloadSpinner=function(){var n=document.createElement("div"),t,i,r;n.id="downloadspin";t=document.getElementById("tombiod3");t.insertBefore(n,t.firstChild);i={lines:13,length:28,width:14,radius:42,scale:.8,corners:1,color:"#000",opacity:.15,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"49%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};r=new Spinner(i).spin(n)};n.f.hideDownloadSpinner=function(){var n=document.getElementById("tombiod3"),t=document.getElementById("downloadspin");n.removeChild(t)};t.add("spinner","dependencies/spin.min.js");t.add("jquery","dependencies/jquery-3.1.1/jquery-3.1.1.min.js");t.add("d3","dependencies/d3-4.10.0/d3.v4.min.js");t.add("jqueryui","dependencies/jquery-ui-1.12.1/jquery-ui.min.js");t.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.min.css");t.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.theme.min.css");t.jqueryui.addCSS("css/jquery-ui-tombio.css");t.add("zoomMaster","dependencies/zoom-master/jquery.zoom.min.js");t.add("galleria","dependencies/galleria-1.5.7/galleria/galleria-1.5.7.min.js");t.galleria.addCSS("dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.css");t.galleria.initF=function(){Galleria.loadTheme(n.opts.tombiopath+"dependencies/galleria-1.5.7/galleria/themes/classic/galleria.classic.min.js");Galleria.on("image",function(n){$(n.imageTarget).parent().zoom({on:"grab"})})};t.add("mousewheel","dependencies/jquery.mousewheel.min.js");t.add("hammer","dependencies/hammer.min.js");t.add("pqselect","dependencies/pqselect-1.3.2/pqselect.min.js");t.pqselect.addCSS("dependencies/pqselect-1.3.2/pqselect.min.css");t.pqselect.requiresFirst=["jqueryui"];t.add("pqgrid","dependencies/pqgrid-2.1.0/pqgrid.min.js");t.pqgrid.addCSS("dependencies/pqgrid-2.1.0/pqgrid.min.css");t.pqgrid.requiresFirst=["jqueryui"];t.add("keyinput","keyinput.js?ver="+n.opts.tombiover);t.keyinput.addCSS("css/keyinput.css");t.keyinput.requires=["pqselect","jqueryui"];t.add("keyinputbasic","keyinputBasic.js?ver="+n.opts.tombiover);t.keyinputbasic.addCSS("css/keyinputbasic.css");t.add("tombiovis","tombiovis.js?ver="+n.opts.tombiover);t.tombiovis.addCSS("css/tombiovis.css");t.tombiovis.requires=["kbchecks","keyinput","keyinputbasic","guiMain1"];t.add("kbchecks","kbchecks.js?ver="+n.opts.tombiover);t.add("score","score.js?ver="+n.opts.tombiover);t.add("taxonselect","taxonselect.js?ver="+n.opts.tombiover);t.taxonselect.addCSS("css/taxonselect.css");t.taxonselect.requires=["jqueryui"];t.add("visP","visP.js?ver="+n.opts.tombiover);t.visP.addCSS("css/visP.css");t.visP.requires=["mousewheel","hammer","galleria","zoomMaster"];t.add("visPjQueryUILargeFormat","visPjQueryUILargeFormat.js?ver="+n.opts.tombiover);t.visPjQueryUILargeFormat.addCSS("css/visp-jquery-ui-large-format.css");t.visPjQueryUILargeFormat.requiresFirst=["visP"];t.add("guiMain1","guiMain1.js?ver="+n.opts.tombiover);t.guiMain1.addCSS("css/guiMain1.css");t.guiMain1.requires=["jqueryui"];t.add("vis1","vis1/vis1.js?ver="+n.opts.tombiover,"Two-column key");t.vis1.addCSS("vis1/vis1.css");t.vis1.requiresFirst=["visPjQueryUILargeFormat"];t.vis1.requires=["jqueryui","score","keyinput"];t.add("vis2","vis2/vis2.js?ver="+n.opts.tombiover,"Single-column key");t.vis2.addCSS("vis2/vis2.css");t.vis2.requiresFirst=["visPjQueryUILargeFormat"];t.vis2.requires=["jqueryui","score","keyinput"];t.add("vis3","vis3/vis3.js?ver="+n.opts.tombiover,"Side by side comparison");t.vis3.addCSS("vis3/vis3.css");t.vis3.requiresFirst=["visPjQueryUILargeFormat"];t.vis3.requires=["jqueryui","taxonselect","pqgrid","score"];t.add("vis4","vis4/vis4.js?ver="+n.opts.tombiover,"Full taxon details");t.vis4.addCSS("vis4/vis4.css");t.vis4.requiresFirst=["visPjQueryUILargeFormat"];t.vis4.requires=["jqueryui","taxonselect"];t.add("vis5","vis5/vis5.js?ver="+n.opts.tombiover,"Circle-pack key");t.vis5.addCSS("vis5/vis5.css");t.vis5.requiresFirst=["visPjQueryUILargeFormat"];t.vis5.requires=["jqueryui","score","keyinput"];t.add("visEarthworm2","visEarthworm2/visEarthworm2.js?ver="+n.opts.tombiover,"Bespoke earthworm key");t.visEarthworm2.addCSS("visEarthworm2/visEarthworm2.css");t.visEarthworm2.requiresFirst=["visP"];t.visEarthworm2.requires=["jqueryui","score"];n.f.startLoad=function(){t.spinner.loadJs().then(function(){return n.f.showDownloadSpinner(),Promise.all([t.d3.loadJs(),t.jquery.loadJs()])}).then(function(){return jQuery(document).ready(function(){jQuery("#tombiod3").append(jQuery('<div id="tombiod3vis">'))}),f()}).then(function(){t.tombiovis.loadJs().then(function(){n.f.hideDownloadSpinner();n.f.loadcomplete()})})};n.opts.loadWait||n.f.startLoad()}(this.tombiovis?this.tombiovis:this.tombiovis={}),tombiovis.opts.devel)var v=tombiovis;